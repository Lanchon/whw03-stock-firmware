window.RAINIER=window.RAINIER||{};RAINIER.applets=RAINIER.applets||{};RAINIER.applets.wireless=RAINIER.applets.wireless||(function(){var b=["supportedBandSteeringModes","isBandSteeringSupported","combineNetworks"],A=["band","bssid","maxRADIUSSharedKeyLength","physicalRadioID","supportedChannels","supportedModes","supportedSecurityTypes","supportedWideChannels","supportedChannelsForChannelWidths","steeredModes","bandSteeringSettings","isSetToMixedMode","defaultMixedMode"],w=["isEnabled","mode","broadcastSSID","channelWidth","channel"],l=null,j=null;function p(D,E){var F=null;$.each(D.radios,function(H,G){if(G.radioID===E){F=G;return false}});return F}function m(G,E){var D=false,F=null;$.each(G.radios,function(I,H){F=p(E,H.radioID);if(F&&!$.compare(H,F)){D=true;return false}});return D}function v(I,G,E,F){var H=p(G,F),D=p(I,F);return !$.compare(H.settings[E],D.settings[E])}function x(){return RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP2"])}function g(D,F){var G=false,E=null;$.each(F.radios,function(I,H){E=p(D,H.radioID);if(E){G=H.settings.isEnabled&&E.settings.broadcastSSID!==H.settings.broadcastSSID;return false}});return G}function h(E,G,H){var D=false,F=null;var I=lodash.filter(G.radios,function(J){return J.band!=="6GHz"});$.each(I,function(K,J){if(RAINIER.applets.wireless.shouldFilterRadio(J,G)){F=p(E,J.radioID);if(F&&J.settings.isEnabled&&(H||J.settings.broadcastSSID)){D=true;return false}}});return D}function y(H,F,E,G){var I=true,D=false;$.each(H.radios,function(){if(this.settings.isEnabled&&this.settings.broadcastSSID){I=false}if(!this.settings.broadcastSSID){D=true}});if(F.wps&&F.wps.enabled){if(I){if(!RAINIER.applets.wireless.isWirelessAP2Supported()){E.find("#reboot-needed").show();E.find("#no-reboot-needed").hide()}else{E.find("#no-reboot-needed").show();E.find("#reboot-needed").hide()}return E}else{if(D){return G}}}return null}function z(D,E){var F=D.concat(E),G=[];F=F.filter(function(I,H,J){return H===J.indexOf(I)});$.each(F,function(H,I){if(D.indexOf(I)>-1&&E.indexOf(I)>-1){G.push(I)}});return G}function d(D){if(D.settings.wepSettings){var E=D.settings.wepSettings.txKey;D.settings.wepSettings.key=D.settings.wepSettings["key"+E]}}function f(H,F,D,G){var E=null,I=RAINIER.shared.util.getLabeledRadio(H,D);if(RAINIER.applets.wireless.shouldFilterRadio(I,H)){I.securityText=RAINIER.ui.common.strings.wirelessSecurity[I.settings.security];d(I,G,l);E=RAINIER.ui.template.createBlock(l,I,G);E.find(".warning-text, .wireless-hide-text").hide();if(I.settings.isEnabled){E.find("#disconnect-warning-wireless").show()}else{E.find("#disconnect-warning-wireless").hide()}if(I.settings.security==="WEP"){E.find("#disconnect-warning-key-row").show()}else{if(I.settings.security==="WPA-Enterprise"||I.settings.security==="WPA2-Enterprise"||I.settings.security==="WPA-Mixed-Enterprise"){E.find("#disconnect-warning-shared-key-row").show()}else{if(!RAINIER.util.isSecurityTypeOpen(I.settings.security)){E.find("#disconnect-warning-password-row").show()}}}if(!I.settings.broadcastSSID){E.find("#disablingghz-broadcastSSID-text").show()}RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-wireless").append(E)}}function e(E,D,F){RAINIER.ui.showWaiting();$.delAttr(D,b);E.add({action:RAINIER.jnapActions.setRadioSettings(),data:D,cb:function(G){if(typeof F==="function"){F(G,D)}}})}function t(G,T,R,P,L,K,I){var D=false,U=false,M=false,J=false,S=false,N=false,V=false,E=false,Q=false,H=false,F=symmetryUtil.wireless.has6GHzRadio(P.radios);var O=null;l=RAINIER.ui.template.createTemplate($("#radio-disconnect-warning-template > *"));RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-wireless").empty();RAINIER.connect.elDisconnectWarning().find(".warning-text, .wireless-hide-text").hide();$.each(T.radios,function(X,W){if(RAINIER.network.isBehindNode()&&window.location.hash!=="#casupport"&&(W.radioID==="RADIO_5GHz_2"||(T.combineNetworks&&["RADIO_5GHz"].indexOf(W.radioID)>-1))){return true}if(W.radioID==="RADIO_5GHz_2"){H=true}f(T,P,W.radioID,L);O=p(P,W.radioID);if(O){if(!W.settings.isEnabled){if(W.radioID==="RADIO_2.4GHz"){D=true}else{if(W.radioID==="RADIO_5GHz"){U=true}else{if(W.radioID==="RADIO_5GHz_2"){M=true}else{if(W.radioID==="RADIO_6GHz"){J=true}}}}}if(!W.settings.isEnabled&&O.settings.isEnabled){console.warn("radio being disabled",W.radioID);if(W.radioID==="RADIO_2.4GHz"){S=true}else{if(W.radioID==="RADIO_5GHz"){N=true}else{if(W.radioID==="RADIO_5GHz_2"){V=true}else{if(W.radioID==="RADIO_6GHz"){E=true}}}}}}});if(T.isBandSteeringEnabled&&U){M=true}if((S||N||V||E)&&(D&&U&&(!H||M)&&(!F||J))){Q=true}console.warn("confirmSetRadioSettings (radio24Disabled, radio50Disabled, radio502Disabled, has6GHzRadio, radio60Disabled, allRadiosBeingDisabled)",D,U,M,F,J,Q);RAINIER.connect.elDisconnectWarning().find(".submit").unbind("click");RAINIER.connect.elDisconnectWarning().find(".submit").click(function(){RAINIER.connect.disconnectWarningDialog.close();e(G,R,I);if(typeof K==="function"){K()}});RAINIER.network.areRadiosDisabledByWFS(function(W){if(W){RAINIER.connect.elDisconnectWarning().find("#disabled-radios-wireless-scheduler-enabled-text").show()}});if(Q){RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-wireless-networks-disabled-text").show()}else{RAINIER.connect.elDisconnectWarning().find("#disconnect-warning-default-text").show()}if(RAINIER.network.isGuestNetwork3Supported()){if(S&&N&&E){RAINIER.connect.elDisconnectWarning().find("#disabling-24-50-60ghz-disables-guest-access-text").show()}else{if(S&&N&&!F){if(P.supportedBandSteeringModes){RAINIER.connect.elDisconnectWarning().find("#disabling-24-50_1ghz-disables-guest-access-text").show()}else{RAINIER.connect.elDisconnectWarning().find("#disabling-24-50ghz-disables-guest-access-text").show()}}else{if(S){RAINIER.connect.elDisconnectWarning().find("#disabling-24ghz-disables-24guest-access-text").show()}if(N){if(P.supportedBandSteeringModes){RAINIER.connect.elDisconnectWarning().find("#disabling-50_1ghz-disables-50guest-access-text").show()}else{RAINIER.connect.elDisconnectWarning().find("#disabling-50ghz-disables-50guest-access-text").show()}}if(E){RAINIER.connect.elDisconnectWarning().find("#disabling-60ghz-disables-60guest-access-text").show()}}}}else{if(D){RAINIER.connect.elDisconnectWarning().find("#disabling-24ghz-disables-guest-access-text").show()}}RAINIER.connect.disconnectWarningDialog.show()}function r(R,G,L,P,H,O){var K=$.extend(true,{},G),E=K.bandSteeringMode!==L.bandSteeringMode,D=symmetryUtil.wireless.has6GHzRadio(G.radios),I=false,J=null,M=null,N=null,F=null,Q=RAINIER.network.isBehindNode()&&window.location.hash!=="#casupport";K.radios=[];if(!K.isBandSteeringEnabled){$.delAttr(K,"bandSteeringMode")}if(Q&&!D){if(K.combineNetworks){F=p(G,"RADIO_2.4GHz")}else{F=p(G,"RADIO_5GHz")}}$.each(G.radios,function(T,S){M=p(L,S.radioID);if(M){J=$.extend(true,{},S);I=!$.compare(S,M);$.delAttr(J,A);if(Q&&!D){if(S.band!=="2.4GHz"){J=$.extend(true,{},S,{settings:s(F.settings)});if(!$.compare(J,M)){$.delAttr(J,A);K.radios.push(J)}}else{if(I){K.radios.push(J)}}}else{if(I&&RAINIER.applets.wireless.shouldFilterRadio(S,K)){K.radios.push(J)}if(symmetryUtil.wireless.isPrimaryBandSteeredRadio(K,S)&&(I||E)){N=$.extend(true,{},J)}}}});if(K.radios.length>0||E){if(N){$.each(G.radios,function(T,S){if(RAINIER.applets.wireless.isSecondarySteeredBand(S,G)){N=$.extend(true,{},N,RAINIER.applets.wireless.getBandSteeringDefaults(S));$.delAttr(N,A);K.radios.push(N)}})}t(R,G,K,L,P,H,O)}else{RAINIER.ui.hideWaiting()}}function i(E,D){if(D&&D.bandSteeringMode==="TriBand"){return E.band==="5GHz"}return symmetryUtil.wireless.isSecondaryBandRadio(E)}function u(E,D){if(E&&D){return !D.isBandSteeringEnabled||symmetryUtil.wireless.isPrimaryBandSteeredRadio(D,E)||(D.bandSteeringMode==="Basic"&&E.radioID!=="RADIO_5GHz_2")}return false}function o(D){return _.find(symmetryUtil.wireless.getBandSteeringSettings().radioDefaults,{radioID:D.radioID})||{}}function C(J,E){var H=[],D,G,F;if(E==="WEP-64"){D=0;H=[];for(G=0;G<J.length;G++){D^=((J.charCodeAt(G))<<((G%4)*8))}for(G=0;G<4;G++){H[G]="";for(F=0;F<5;F++){D*=214013;D+=2531011;D&=4294967295;H[G]+=("0"+((D>>16)&255).toString(16)).slice(-2)}}}else{if(E==="WEP-128"){D="";for(G=0;G<64;G++){D+=J.charAt(G%J.length)}var I=calcMD5(D).slice(0,26);H.push(I);H.push(I);H.push(I);H.push(I)}}return H}function k(D){D.sort(function(F,E){return(F.radioID>E.radioID)?1:((F.radioID<E.radioID)?-1:0)})}function q(D){$.each(D.radios,function(F,E){$.delAttr(E,A)});$.delAttr(D,b)}function n(E){var D=s(E[0].settings);return E.every(function(G,F){return F===0||$.compare(D,s(G.settings))})}function c(F,E){var D=s(F[0].settings,E);return F.every(function(H,G){return G===0||$.compare(D,s(H.settings,E))})}function s(E,D){D=D||w;return _.omit(E,D)}function B(){return j}function a(){symmetryUtil.wireless.getWirelessSettings().success(function(D){j=D.supportedBandSteeringModes&&D.supportedBandSteeringModes.indexOf("TriBand")>-1})}return{initialize:a,getRadioFromSet:p,radiosHaveChanges:m,hasAttributeChanged:v,isWirelessAP2Supported:x,isSSIDBroadcastChanging:g,canEnableWPS:h,ssidBroadcastWPSWarning:y,getCommonChannels:z,shouldFilterRadio:u,isTriBandSteeringSupported:B,isSecondarySteeredBand:i,getBandSteeringDefaults:o,commitSettings:r,scrubForSave:q,setDisplayWepKey:d,generateWepKeys:C,sortRadios:k,areAllRadioSettingsIdentical:n,areRadioSettingsIdentical:c,prepareRadioSettings:s}}());