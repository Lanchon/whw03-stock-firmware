(function(a,b){if(typeof define==="function"&&define.amd){define(["lodash","./symmetry-jnap","./device-manager"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("lodash"),require("./symmetry-jnap"),require("./device-manager"))}else{a.utilNodes=b((a.lodash||a._),a.JNAP,a.deviceManager)}}}(this,function(p,m,i){var q;var k=["Master"],g=["Slave"];var s=[{model:"WHW03B",baseModel:"WHW03",isMeshRouter:false,pattern:/whw03b/i},{model:"WHW03",baseModel:"WHW03",isMeshRouter:false,pattern:/nd0001|nodes|whw0301|whw03|a03/i},{model:"WHW01P",baseModel:"WHW01",isMeshRouter:false,pattern:/whw01p/i},{model:"WHW01B",baseModel:"WHW01",isMeshRouter:false,pattern:/whw01b|vlp01b/i},{model:"WHW01",baseModel:"WHW01",isMeshRouter:false,pattern:/whw01|vlp01|a01/i},{model:"MR7350",baseModel:"MR7350",isMeshRouter:true,pattern:/mr7350/i},{model:"MR7350",baseModel:"MR7350",seriesModel:"MR7300",isMeshRouter:true,pattern:/^mr73/i},{model:"MR6350",baseModel:"MR6350",isMeshRouter:true,pattern:/mr6350|mr6320|mr6330|mr6340/i},{model:"MR8300",baseModel:"MR8300",isMeshRouter:true,pattern:/mr8300|mr8250|mr9000|mr8900|mr8950|mr9100/i},{model:"MR9600",baseModel:"MR9600",seriesModel:"MR9600",isMeshRouter:true,pattern:/mr9600/i},{model:"MR7500",baseModel:"MR7500",seriesModel:"MR7500",isMeshRouter:true,pattern:/^mr75/i},{model:"MR5500",baseModel:"MR5500",isMeshRouter:true,pattern:/mr5500/i},{model:"MR2000",baseModel:"MR2000",seriesModel:"MR2000",isMeshRouter:true,pattern:/^mr20/i},{model:"MX5300",baseModel:"MX5300",isMeshRouter:false,pattern:/mx5400|mx5300/i},{model:"MX4200",baseModel:"MX4200",seriesModel:"MX4000",isMeshRouter:false,pattern:/^mx42|mx4000/i},{model:"MX8500",baseModel:"MX8500",seriesModel:"MX8500",isMeshRouter:false,pattern:/^mx85/i},{model:"MX5500",baseModel:"MX5500",seriesModel:"MX5500",isMeshRouter:false,pattern:/mx5500/i},{model:"MX2000",baseModel:"MX2000",seriesModel:"MX2000",isMeshRouter:false,pattern:/^mx20/i},{model:"EA9350",hardwareVersions:["3"],baseModel:"EA9350",isMeshRouter:true,pattern:/ea9350/i},{model:"WHW03",baseModel:"WHW03",isMeshRouter:false,pattern:/^a|^mx|^whw|^vlp/i},{model:"MR8300",baseModel:"MR8300",isMeshRouter:true,pattern:/^mr/i}];function l(x,v,w,u){var t=p.result(p.find(s,function(z){var y=z.hardwareVersions||null;return z.pattern.test(x)&&(!y||y.indexOf(v)>-1)}),w,null);if(p.isString(u)&&!t){t=u}return t}function r(u,t){return l(u,t,"model")}function j(u,t){return l(u,t,"baseModel")}function n(u,t){return l(u,t,"seriesModel","")}function a(u,t){return !!r(u,t)}function o(u,t){return !!l(u,t,"isMeshRouter")}function e(t){m.send("/nodes/setup/GetSelectedChannels").success(function(u){if(u.output.isRunning){setTimeout(function(){console.warn("Polling GetSelectedChannels");e(t)},5000)}else{t.resolve(u.output)}}).fail(function(u){t.reject(u)})}function f(){var t=m.Deferred(),v=i.nodes.getSlaves(),u=45;v.forEach(function(w){if(w.isOnline){u+=60}});m.send("/nodes/setup/StartAutoChannelSelection",{},{timeoutDelayWirelessCheck:u*1000}).success(function(w){e(t)}).fail(function(w){t.reject(w)});return t}function c(v){var t=m.Deferred(),u=v?v:m;if(m.isServiceSupported("/nodes/smartmode/SmartMode2")){u.send("/nodes/smartmode/GetSupportedDeviceModes").success(function(w){var x=p.result(w,"output.supportedModes");console.warn("GetSupportedDeviceModes results:",x);t.resolve(x)}).fail(function(w){t.reject(w)})}else{t.resolve(p.union(k,g))}return t}function b(u){var t=m.Deferred();c(u).success(function(w){var v=p.isEqual(w,k);t.resolve(v)}).fail(function(v){t.reject(v)});return t}function d(u){var t=m.Deferred();c(u).success(function(w){var v=p.isEqual(w,g);t.resolve(v)}).fail(function(v){t.reject(v)});return t}function h(v){var t=m.Deferred(),u={supportedForCaching:{"/nodes/setup/GetNodesWirelessConnectionInfo":false}};m.send("/nodes/setup/GetNodesWirelessConnectionInfo",{deviceIDs:[v]},u).success(function(w){if(!w.output||!w.output.nodesWirelessConnectionInfo||!w.output.nodesWirelessConnectionInfo.length||!w.output.nodesWirelessConnectionInfo[0].bandwidth){t.reject("Unavailable")}else{var x={rangeIndicator:0,data:w.output};if(w.output.nodesWirelessConnectionInfo[0].rssi&&w.output.nodesWirelessConnectionInfo[0].rssi<0&&w.output.nodesWirelessConnectionInfo[0].rssi>-35){x.rangeIndicator=-1}else{if(w.output.nodesWirelessConnectionInfo[0].bandwidth<50){x.rangeIndicator=1}}t.resolve(x)}}).error(function(w){t.reject(w)});return t}q={baseModel:j,treatAsModel:r,seriesModel:n,isNodeModel:a,isMeshRouter:o,getSupportedDeviceModes:c,canOnlyBeMaster:b,canOnlyBeSlave:d,slaveSpotfinderRange:h,doAutoChannelSelection:f};return q}));