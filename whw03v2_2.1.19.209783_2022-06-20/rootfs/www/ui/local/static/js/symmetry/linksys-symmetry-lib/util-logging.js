(function(a,b){if(typeof define==="function"&&define.amd){define(["lodash"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("lodash"))}else{a.utilLogging=b((a.lodash||a._))}}}(this,function(k){var f;k.trimEnd=k.trimEnd||k.trimRight;var a=/(?: +at )?logMessage.+[\r\n](?: +at )?wrapper.+[\r\n]/;var h=/(?:@http|file):.+\/www\/| +at /g;var c=/^(?:r@|@?fire.*|http:|(?:wrapper@)?app\.js).+[\r\n]?/gm;var j=/^Error[\r\n]|^/;var d=[];function i(E,p,B,u){var m=k.drop(arguments,4),v=m[0],t=E+(k.endsWith(E," ")?"":" ")+u,F=", ",D=false,q=false,n=null;function x(I){return k.result(arguments,"callee"+k.repeat(".caller",I)+".name")}t+=m.length?" ":"";if(m.length===1&&k.isPlainObject(v)){if(v["do-trace"]){D=true;delete v["do-trace"];if(v["skip-thisFn"]){q=true;delete v["skip-thisFn"]}if(v["error-obj"]){n=v["error-obj"];delete v["error-obj"]}}if(v["log-keys"]){var l=k.size(v)-1,w=[];delete v["log-keys"];t+="(";k.each(v,function(J,I){w.push(J);t+=I+(w.length<l?F:"")});t+="): ";m=w}if(k.isEmpty(v)){delete m[0]}}m.forEach(function(I,J){t+=JSON.stringify(I,null,2);if(J<m.length-1){t+=F}});if(D){var z="\n\nCall Trace: ",r=z,y=true,G=n?n:new Error(),s=k.result(G,"stack","[no stack found]"),o=q?new RegExp("(?: +at )?.*"+x(3)+".+[\r\n]"):"",A=q?4:3;s=k.trim(s.replace(a,"").replace(o,"").replace(h,"@").replace(/^@+/gm,"").replace(c,""));t+="\n\n"+s.replace(j,"Stack Trace:\n\n");while(y){var H=x(A),C=!k.isEmpty(H);if(C&&H!=="wrapper"){r+=H+F}if(!C||A++>8){y=false}}if(r===z){r+="[no calls]"}else{r=k.trimEnd(r,F)}t+=r}t=t.replace(/\\n/g,"\n").replace(/\\t/g,"\t");console[B](t);if(p){d[E]+=(d[E].length?"\n":"")+t}}function e(m,l){if(l){g(m)}return k.partial(i,m,l)}function b(l){return d[l]||"[key not present]"}function g(l){d[l]=""}return function(l){f=l;return{setup:e,message:i,getLogKey:b,clearLogKey:g}}}));