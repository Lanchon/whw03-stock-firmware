(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","lodash","jnap-js/jnap"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("jquery"),require("lodash"),require("@linksys/jnap-js").JNAP)}else{a.sideEffectsManager=b(a.$,(a.lodash||a._),a.JNAP)}}}(this,function(h,w,p){var x,v=1000,q=60*v,j=3*q;var y={disablePause:true};window.CISCO=window.CISCO||{};function n(D,A,z,C,E,B){z=z||1000;C=C||(new Date()).getTime()+z*E+B;if(B){setTimeout(function(){n(D,A,z,C,E)},B);return}z-=1;D(function(F){if(F||z===0||(new Date()).getTime()>C){A(F)}else{setTimeout(function(){n(D,A,z,C,E)},E)}})}var s=null;function f(z){if(z&&z.skipWANReconnectPolling){s=(new Date()).getTime()-100*q}else{s=null}}function b(z){f(z);return function(A){p.send("/router/GetWANStatus",{},y).success(function(B){if(!s){s=(new Date()).getTime()}var C=B.output.wanStatus==="Connected"||B.output.wanIPv6Status==="Connected";var D=(new Date()).getTime()>s+60*v;A(C||D)}).error(function(){A(false)})}}function o(z){var A=b(z);return function(E){var C=p.cache.data["/core/GetDeviceInfo"].output.serialNumber;var B={supportedForCaching:{"/core/GetDeviceInfo":false}};var D=w.merge(y,B);p.send("/core/GetDeviceInfo",{},D).success(function(F){if(F.output.serialNumber===C){A(E)}else{E(false)}}).error(function(){E(false)})}}function d(A,E,z,C,D){var B=p.getOptions();return function(F){if(!F){if(B.uiRetryRouterConnectivity()){z.sideEffects=A;E(z,C,D);return}else{z.result="failed_to_reconnect_to_router"}}E(z,C,D);if(i()){l()}B.uiInterruptionFinished()}}function k(A,z){x.poll(o(z),A,null,(new Date()).getTime()+4*q,10*v,z.timeoutDelayRestartCheck)}function t(D,A,z){var C,B;C=A.auth||p.getAuth()||h.noop;B={headers:{},url:"/JNAP/"};C(B);if(z.indexOf("WirelessInterruption")>-1){x.poll(o(A),D,null,(new Date()).getTime()+2*q,10*v,A.timeoutDelayWirelessCheck)}else{x.poll(b(A),D,5,null,15*v,A.timeoutDelayWANCheck)}}function r(){var z={sideEffect:function(B,E,A,C,D){this.uiInterruptionStarted(B);if(B.indexOf("DeviceRestart")>-1){this.handleDeviceRestart(B,E,A,C,D)}else{this.handleInterruption(B,E,A,C,D)}},timeoutDelayWANCheck:5*v,timeoutDelayWirelessCheck:10*v,timeoutDelayRestartCheck:40*v,handleDeviceRestart:function(B,F,A,C,E){var D=this;c(D.uiRebootProgress);k(d.call(D,B,F,A,C,E),D)},handleInterruption:function(B,F,A,C,E){var D=this;t(d.call(D,B,F,A,C,E),D,B)},uiInterruptionStarted:h.noop,uiInterruptionFinished:h.noop,uiRebootProgress:h.noop,uiRetryRouterConnectivity:function(){return confirm("try again?")},connectToWiFiNetwork:null};p.setOptions(z)}var u=null,e,a,g;function m(A,z){if(i()){l()}e=A;a=z;g=0;u=setInterval(function(){if(g<a){g+=1000}e(g/a*100)},1000);e(0)}function c(z){m(z,j)}function l(){clearInterval(u);u=null}function i(){return u!==null}x={init:r,poll:n,getTestRouterReconnectedFunc:o,fakeProgress:{start:m,stop:l,isRunning:i},fakeRebootProgress:{start:c,stop:l,isRunning:i}};return x}));