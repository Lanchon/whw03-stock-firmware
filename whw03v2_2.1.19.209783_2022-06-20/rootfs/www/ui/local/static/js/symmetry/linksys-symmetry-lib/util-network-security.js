(function(a,b){if(typeof define==="function"&&define.amd){define(["lodash","./symmetry-jnap"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("lodash"),require("./symmetry-jnap"))}else{a.utilNetworkSecurity=b((a.lodash||a._),a.JNAP)}}}(this,function(r,k){var o;r.padStart=r.padStart||r.padLeft;var j={sunday:"111111111111111111111111111111111111111111111111",monday:"111111111111111111111111111111111111111111111111",tuesday:"111111111111111111111111111111111111111111111111",wednesday:"111111111111111111111111111111111111111111111111",thursday:"111111111111111111111111111111111111111111111111",friday:"111111111111111111111111111111111111111111111111",saturday:"111111111111111111111111111111111111111111111111"};var t="*.";var s=":00";var c=":30";var v=/(\d\d):(\d\d)/;var g=/\*\.(.+)/;function m(w,y){var x=w.engineConfigs.internetBlockScheduleExceptions.ignoreScheduleAndBlockMACAddresses;return x.indexOf(y)>-1}function i(w,x){var y=w.engineConfigs.internetBlockScheduleExceptions.ignoreScheduleAndAllowMACAddresses;return y.indexOf(x)>-1}function u(w,x){return r.result(r.find(w.supportedCategories,{categoryID:parseInt(x,10)}),"presetName")}function d(x,w){return r.result(r.find(x.engineConfigs.profiles.deviceSpecificProfiles,function(y){return y.macAddresses.indexOf(w)!==-1}),"internetBlockSchedule",null)}function n(w){return parseInt(w)>=30?1:0}function f(x){var B=x.startTime,w=x.endTime,C=B.replace(v,"$1"),A=B.replace(v,"$2"),z=w.replace(v,"$1"),y=w.replace(v,"$2");return{start:C*2+n(A),end:z*2+n(y)}}function l(w){var x=r.clone(j);r.each(w,function(y,z){var A,B;r.each(y,function(C){A=f(C);B=r.fill(x[z].split(""),"0",A.start,A.end);x[z]=B.join("")})});return x}function p(y,x,z,w){y[x].push({startTime:z,endTime:w})}function q(y){var w=o.parentalControls.getUniqueWeekRanges(y),x={};r.each(j,function(A,z){x[z]=[]});r.each(w,function(z){z.days.forEach(function(B){var C=r.padStart(z.startHour+(z.startMinutes?c:s),5,"0"),D=r.padStart(z.endHour+(z.endMinutes?c:s),5,"0"),A=D;if(z.endNextDay){A="24:00";p(x,o.time.getNextDay(B),"00:00",D)}p(x,B,C,A)});z.days.forEach(function(A){x[A]=r.sortBy(x[A],function(B){return B.startTime})})});return x}function b(x){var w=[];r.each(x,function(y){w.push(y.replace(g,"$1"))});return r.uniq(w)}function a(x){var w=k.Deferred(),y=x?x.add:k.send;y("/parentalcontrol/GetParentalControlSettings").success(function(z){var A=r.cloneDeep(z.output);A.engineConfigs.profiles.deviceSpecificProfiles.forEach(function(C){var B=C.urlWhiteBlackList;r.each(C.urlWhiteBlackList,function(E,D){B[D]=b(E)})});A.maxTotalAllowedURLs=Math.floor(A.maxTotalAllowedURLs/2);w.resolve(A)}).error(function(z){w.reject(z)});return w}function e(x){var w=[];r.each(x,function(y){w.push(y);if(r.isNaN(o.ip.ipToNum(y))){w.push(t+y)}});return w}function h(x,y){var w=k.Deferred(),A=r.cloneDeep(x),z=y?y.add:k.send;A.engineConfigs.profiles.deviceSpecificProfiles.forEach(function(C){var B=C.urlWhiteBlackList;r.each(C.urlWhiteBlackList,function(E,D){B[D]=e(E)})});z("/parentalcontrol/SetParentalControlSettings",A).success(function(){w.resolve(A)}).error(function(B){w.reject(B)});return w}return function(w){o=w;return{isAlwaysBlocked:m,isAlwaysUnblocked:i,getCategoryNameByID:u,getBlockScheduleByMACAddress:d,blockScheduleToGrid:l,gridToBlockSchedule:q,scrubListForDisplay:b,modListForSave:e,getNetworkSecuritySettings:a,setNetworkSecuritySettings:h}}}));