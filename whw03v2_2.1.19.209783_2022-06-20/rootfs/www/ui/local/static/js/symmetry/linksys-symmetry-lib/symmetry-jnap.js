(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","lodash","jnap-js/jnap","jnap-js/cloud-rest","./util-logging","./side-effects-manager","./cache-manager","./http-request-cordova"],b)}else{if(typeof module==="object"&&module.exports){module.exports=b(require("jquery"),require("lodash"),require("@linksys/jnap-js").JNAP,require("@linksys/jnap-js").CLOUD_REST,require("./util-logging"),require("./side-effects-manager"),require("./cache-manager"),require("./http-request-cordova"))}else{a.JNAP=b(a.$,(a.lodash||a._),a.JNAP,a.CLOUD_REST,a.utilLogging,a.sideEffectsManager,a.cacheManager,a.httpRequestCordova)}}}(this,function(g,t,o,n,e,d,j,a){var c=[];function s(u){this.name="SymLibException";this.message=t.isPlainObject(u)?u.message:u;if(t.result(u,"traces")){this.traces=u.traces}}function l(){return e?e(null):window.utilLogging(null)}function p(z,x,A,u,w){var y={action:z},v="You should use "+x+" in this call. Let JNAP.send() pick the best action supported by the router.";if(z===A){console.info(v,"- logData:",y)}if(z===x&&o.isServiceSupported(u,y,w)){return A}return null}function k(w,u,v){var x;v=v||o.cache.data;u=o.getOptions(u);if(u&&u.disableFeatureDetection){return w}x=t.curryRight(p)(v);return x(w,"/router/GetWANSettings","/router/GetWANSettings5","/router/Router10")||x(w,"/router/GetWANSettings","/router/GetWANSettings4","/router/Router8")||x(w,"/router/GetWANSettings","/router/GetWANSettings2","/router/Router3")||x(w,"/router/SetWANSettings","/router/SetWANSettings4","/router/Router8")||x(w,"/router/SetWANSettings","/router/SetWANSettings3","/router/Router4")||x(w,"/router/SetWANSettings","/router/SetWANSettings2","/router/Router3")||x(w,"/router/GetWANStatus","/router/GetWANStatus3","/router/Router5")||x(w,"/router/GetWANStatus","/router/GetWANStatus2","/router/Router3")||x(w,"/router/GetIPv6Settings","/router/GetIPv6Settings2","/router/Router5")||x(w,"/router/SetIPv6Settings","/router/SetIPv6Settings2","/router/Router5")||x(w,"/router/GetCTFSettings","/router/broadcom/GetCTFSettings","/router/broadcom/RouterBroadcom")||x(w,"/router/SetCTFSettings","/router/broadcom/SetCTFSettings","/router/broadcom/RouterBroadcom")||x(w,"/networkconnections/GetNetworkConnections","/networkconnections/GetNetworkConnections2","/networkconnections/NetworkConnections2")||x(w,"/wirelessap/GetRadioInfo","/wirelessap/GetRadioInfo3","/wirelessap/WirelessAP4")||x(w,"/wirelessap/GetRadioInfo","/wirelessap/GetRadioInfo2","/wirelessap/WirelessAP3")||x(w,"/wirelessap/SetRadioSettings","/wirelessap/SetRadioSettings3","/wirelessap/WirelessAP4")||x(w,"/wirelessap/SetRadioSettings","/wirelessap/SetRadioSettings2","/wirelessap/WirelessAP3")||x(w,"/ddns/GetDDNSStatus","/ddns/GetDDNSStatus2","/ddns/DDNS3")||x(w,"/routermanagement/GetManagementSettings","/routermanagement/GetManagementSettings2","/routermanagement/RouterManagement2")||x(w,"/routermanagement/SetManagementSettings","/routermanagement/SetManagementSettings2","/routermanagement/RouterManagement2")||x(w,"/vlantagging/GetVLANTaggingSettings","/vlantagging/GetVLANTaggingSettings2","/vlantagging/VLANTagging2")||x(w,"/vlantagging/SetVLANTaggingSettings","/vlantagging/SetVLANTaggingSettings2","/vlantagging/VLANTagging2")||x(w,"/core/CheckAdminPassword","/core/CheckAdminPassword3","/core/Core7")||x(w,"/core/SetAdminPassword","/core/SetAdminPassword3","/core/Core7")||x(w,"/core/SetAdminPassword","/core/SetAdminPassword2","/core/Core3")||x(w,"/nodes/setup/SetAdminPassword","/nodes/setup/SetAdminPassword2","/nodes/setup/Setup8")||x(w,"/qos/GetQoSSettings","/gamingprioritization/GetGamingPrioritizationSettings","/gamingprioritization/GamingPrioritization")||x(w,"/qos/SetQoSSettings","/gamingprioritization/SetGamingPrioritizationSettings","/gamingprioritization/GamingPrioritization")||x(w,"/guestnetwork/GetGuestNetworkSettings","/guestnetwork/GetGuestRadioSettings2","/guestnetwork/GuestNetwork4")||x(w,"/guestnetwork/SetGuestNetworkSettings","/guestnetwork/SetGuestRadioSettings2","/guestnetwork/GuestNetwork4")||x(w,"/guestnetwork/GetGuestNetworkSettings","/guestnetwork/GetGuestRadioSettings","/guestnetwork/GuestNetwork3")||x(w,"/guestnetwork/SetGuestNetworkSettings","/guestnetwork/SetGuestRadioSettings","/guestnetwork/GuestNetwork3")||x(w,"/storage/GetMountedPartitions","/storage/GetPartitions","/storage/Storage2")||x(w,"/devicelist/GetDevices","/devicelist/GetDevices3","/devicelist/DeviceList4")||x(w,"/nodes/healthcheck/GetHealthCheckStatus","/healthcheck/GetHealthCheckStatus","/healthcheck/HealthCheckManager")||x(w,"/nodes/healthcheck/GetHealthCheckResults","/healthcheck/GetHealthCheckResults","/healthcheck/HealthCheckManager")||x(w,"/nodes/healthcheck/RunHealthCheck","/healthcheck/RunHealthCheck","/healthcheck/HealthCheckManager")||x(w,"/nodes/healthcheck/StopHealthCheck","/healthcheck/StopHealthCheck","/healthcheck/HealthCheckManager")||x(w,"/nodes/healthcheck/GetSupportedHealthCheckModules","/healthcheck/GetSupportedHealthCheckModules","/healthcheck/HealthCheckManager")||x(w,"/networksecurity/GetNetworkSecuritySettings","/networksecurity/GetNetworkSecuritySettings2","/networksecurity/NetworkSecurity3")||x(w,"/networksecurity/SetNetworkSecuritySettings","/networksecurity/SetNetworkSecuritySettings2","/networksecurity/NetworkSecurity3")||w}o.actionSupportedByRouter=k;function f(u){return u.action.replace(o.getOptions().baseUrl,"")}function b(w,v,u){if(w==="/router/GetWANStatus"&&u&&u.result==="_ErrorUnexpected"&&u.error&&u.error.indexOf("invalid IPv6 address string")>-1){v.resolve({result:"OK",callUUID:u.callUUID,output:{supportedWANTypes:["DHCP"],isDetectingWANType:false,detectedWANType:"DHCP",wanStatus:"Connected",wanConnection:{wanType:"DHCP",ipAddress:"192.168.0.99"},macAddress:"00:00:00:99:99:99",ignoreFakeJNAPResponse:true}});return true}return false}function m(u,v){if(!t.isPlainObject(u)){u={response:u}}u.callUUID=o.getOptions(v).callUUID}function i(u){return function(y,x,w){var v=o.Deferred();if(!w){w={}}if(y==="/router/RenewDHCPWANLease"||y==="/router/RenewDHCPIPv6WANLease"){w.overrideJnapResult=function(z){z.sideEffects=z.sideEffects||["WANInterruption"];return z}}else{if(y==="/nodes/setup/StartAutoChannelSelection"){w.overrideJnapResult=function(z){z.sideEffects=z.sideEffects||["WirelessInterruption"];return z}}}u(y,x,w).success(function(z,A,B){m(z,w);v.resolve(z,A,B)}).error(function(z,A,B){m(z,w);if(!b(y,v,z)){v.reject(z,A,B)}});return v}}var r=o.resetOptions;var q=o.send;o.resetOptions=function(){r();o.setOptions({callUUID:"[none]",enableTraceLogging:false});o.unsubscribeAll();d.init();j.init(q);if(typeof cordova!=="undefined"){o.setOptions({httpRequest:a})}};o.send=i(function(A,z,x){var B=o.cache.data||{},u=x.noCaching?q:j.send;if(t.result(x,"cacheOverrides")){console.info("[setting JNAP caches to specified overrides]",x.cacheOverrides);x.supportedForCaching=x.supportedForCaching||{};t.keys(x.cacheOverrides).forEach(function(C){x.supportedForCaching[C]=true});B=x.cacheOverrides}var w=[];if(A==="/core/Transaction"){for(var y=0;y<z.length;y++){var v=f(z[y]);w.push({action:o.getOptions().baseUrl+v});v=k(v,x,B);z[y].action=o.getOptions().baseUrl+v}}return u(A,z,x,w).success(function(C,D,F){var E=[];if(A==="/core/Transaction"){z.forEach(function(G){E=t.union(E,t.filter(c,{call:f(G)}))})}else{E=t.filter(c,{call:A})}E.forEach(function(G){G.cb(C,D,F)})})});function h(w,v){v=v||o.cache.data;if(!v["/core/GetDeviceInfo"]||!v["/core/GetDeviceInfo"].output){var u="you need to run /core/GetDeviceInfo before you can use any other JNAP APIs (so we know what APIs are supported)";console.info(u,"- logData:",w);throw new s(u)}}o.isServiceSupported=function(u,w,v){v=v||o.cache.data;w=w||{service:u};h(w,v);return v["/core/GetDeviceInfo"].output.services.filter(function(x){x=x.replace("http://cisco.com/jnap","").replace("http://linksys.com/jnap","");return x===u}).length>0};o.isFeatureSupported=function(u,w){if(!w){h({feature:u});w=o.cache.data["/core/GetDeviceInfo"].output}if(["Node","Nodes"].indexOf(u)>-1){var v=t.find(w.services,function(x){return x.indexOf("/jnap/nodes/")!==-1});return !t.isEmpty(v)}else{if(u==="ExternalStorage"){return o.isServiceSupported("/storage/Storage")&&o.isServiceSupported("/storage/FTPServer")&&o.isServiceSupported("/storage/SMBServer")}else{if(u==="NodesExternalStorage"){return o.isServiceSupported("/nodes/storage/Storage")&&o.isServiceSupported("/nodes/storage/SMBServer")}}}throw new s("unknown feature "+u)};o.subscribe=function(v,u){var A=k(v);if(t.find(c,{call:A,cb:u})){var z={message:"Subscription already exists for passed in JNAP call and callback (call): "+A};if(o.getOptions().enableTraceLogging){var x="[ symmetry-jnap ]",w=l(),y=w.setup(x,true);y("warn","Current Traces",{"do-trace":true});z.traces=w.getLogKey(x)}throw new s(z)}c.push({call:A,cb:u})};o.unsubscribe=function(v,u){var x=k(v),w=t.findIndex(c,{call:x,cb:u});if(w!==-1){c.splice(w,1)}};o.unsubscribeAll=function(){c=[]};o.target=function(w,A,v,y,z){var x,u;function B(C,G,D,F){var E=t.merge(w,D||{});F=F||[];x=null;if(A||G){x=o.getAuth();if(A){o.setAuth(A)}else{o.setAuth(G)}F.push({auth:o.getAuth()})}F.push(E);u=C.apply(null,F);if(x){o.setAuth(x)}return u}return(function(){var C=v&&y&&z?n.setAuth(v,y,z):null;w=w||{};return{transaction:function(){var E=o.transaction(),D=E.send;E.send=function(F){return B(D,C,F)};return E},send:function(F,E,D){return B(o.send,C,D,[F,E])}}}())};o.resetOptions();return o}));