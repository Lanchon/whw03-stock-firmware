$(document).ready(function(){var q=$("body"),I=$("#username"),G=$("#password"),a=$("#global-balloon"),B=$("#adminPass"),w=$("#submit-login"),h=false,F=RAINIER.login.strings,k=0,i=0,m="",p=true,z=false,u=false,v=null;var l={username:RAINIER.ui.buildInputValidBalloon({els:I,isRequired:true}),password:RAINIER.ui.buildInputValidBalloon({els:G,isRequired:true})};var j={deviceMode:{},isAdminPasswordDefault:false,isAdminPasswordSetByUser:false};function t(M){var L=Math.floor(M%3600/60),K=M%60;return L+":"+lodash.padStart(K,2,"0")}function x(L){var K={timeRemaining:t(i)};if(z){K.attemptsRemaining=k}return L.formatObj(K)}function e(){var K=a.find("span.msg span");if(!q.hasClass("connection-local")){return}if(!z){var L=F.routerLoginDelay.remainingAttempts.formatObj({attemptsRemaining:k});K.text(L)}else{K.hide()}}function d(K){K=x(K);if(q.hasClass("connection-local")){RAINIER.ui.inputBalloon.message({els:B,message:K,preventAutoHide:true})}if(i===0){e();w.prop("disabled",false);p=false}}function y(){var L="";switch(k){case 0:L=F.routerLoginDelay.lockedOut;break;case 1:L=z?F.routerLoginDelay.remainingAttemptsWait5Minutes:F.routerLoginDelay.wait5minutes;break;default:L=z?F.routerLoginDelay.remainingAttemptsTryAgainIn:F.routerLoginDelay.tryAgainIn;break}if(k>0){if(!v&&p&&i>0){var K=L;v=setInterval(function(){if(--i<=0){clearInterval(v);v=null;i=0}d(K)},1000);w.prop("disabled",true)}L=x(L)}else{u=true;B.val("").attr("placeholder","").attr("disabled",true);if(q.hasClass("connection-local")){w.prop("disabled",true)}$(".passwordHintSection").hide()}setTimeout(function(){if(q.hasClass("connection-local")){RAINIER.ui.inputBalloon.message({els:B,message:L,preventAutoHide:true});if(k===0){a.find("a").on("click",function(){window.open("https://www.linksys.com/us/support-article?articleNum=318834")})}else{if(i===0||!p){e()}}}},100)}function c(){if(_.isNumber(k)&&k<5){B.off("focus").on("focus",function(){if(!v){y()}});if(v||u){w.prop("disabled",true)}y();B.blur();RAINIER.ui.hideWaiting()}}function r(K){var L=F.invalidAdminPassword;RAINIER.ui.hideWaiting();$("#login-failed-tip").hide();RAINIER.ui.inputBalloon.message({els:B,message:L,color:"red",preventAutoHide:true});B.blur();B.attr("disabled",true);w.prop("disabled",true);a.find("a").on("click",function(){RAINIER.shared.util.setCookie("reset-code","force-update",null,"/");RAINIER.shared.util.setCookie("admin-auth","Basic "+window.btoa("admin:"+K),null,"/");window.location.replace("change-admin-password.html")})}function o(){var L=B.val(),N=h?"/jnap/core/CheckAdminPassword3":"/jnap/core/CheckAdminPassword",M=h?{adminPassword:L}:{};if(w.prop("disabled")){return}if(!RAINIER.shared.util.isAdminPasswordValid(L)){RAINIER.ui.inputBalloon.message({els:B,message:F.invalidRouterPassword,autoHide:true});return}RAINIER.ui.wait();var K=true;RAINIER.jnap.send({action:N,data:M,cb:function(P,O){if(P.result==="OK"){$.cookie("admin-auth","Basic "+window.btoa("admin:"+L),{expires:null,path:"/"});$.cookie("user-auth-token",null,{path:"/"});$.cookie("current-network-id",null,{path:"/"});if(h&&!validation.checkRuleSet(validation.ruleSetInterop.adminPassword,L)){B.off("focus").on("focus",function(){r(L)});r(L)}else{RAINIER.network.setRemoteSetting(false,function(){window.location.replace("/ui/dynamic/index.html")})}}else{var Q="";switch(P.result){case"ErrorInvalidAdminPassword":case"ErrorPasswordCheckDelayed":case"ErrorAdminAccountLocked":p=true;z=false;k=lodash.result(P,"output.attemptsRemaining",0);i=lodash.result(P,"output.delayTimeRemaining",0);c();break;case"_ErrorUnauthorized":Q=F.invalidRouterPassword;break;case"_AjaxError":if(K){}else{Q=F.unexpectedError}break;default:Q=F.unexpectedError;break}if(Q){RAINIER.ui.wait(false);setTimeout(function(){RAINIER.ui.inputBalloon.message({els:B,message:Q,autoHide:true})},150);$("#login-failed-tip").show();return false}}return true},forceLocal:true,disableDefaultJnapErrHandler:true,useAdminAuth:true,adminPasswordOverride:"Basic "+window.btoa("admin:"+L)})}function H(){if(q.hasClass("connection-remote")){w.click(b)}else{if(q.hasClass("connection-local")){w.click(o);$(".showPasswordHint a").click(function(){f(true)});$(".hidePasswordHint a").click(function(){f(false)})}}}function f(K){if(K){$(".showPasswordHint").hide();$(".hidePasswordHint").show()}else{$(".showPasswordHint").show();$(".hidePasswordHint").hide()}}function n(K){if(!lodash.isEmpty(m)&&m!==K){RAINIER.ui.inputBalloon.reset();RAINIER.ui.inputBalloon.hide(null,true)}m=K;w.off("click");q.removeClass("connection-remote connection-local");if(K==="local"){if(h){c()}q.addClass("connection-local");B.blur().focus()}else{if(K==="remote"){w.prop("disabled",false);q.addClass("connection-remote");I.blur().focus()}}H()}function b(){var L=l.username.isValid(true);if(L){L=l.password.isValid(true)}if(!L){return}RAINIER.ui.wait();var M=$.trim(I.val()),K=$.trim(G.val());Account.onlineLogin(M,K)}function s(){if(!q.hasClass("embedded-ui-available")||q.hasClass("connection-remote")){RAINIER.ui.showSlides(RAINIER.ui.slideResources.captionLogin)}else{RAINIER.ui.showSlides(RAINIER.ui.slideResources.captionLocalLogin)}}function g(){RAINIER.ui.hideMasterWaiting();RAINIER.ui.showAppletContainer();RAINIER.ui.placeholders.init();if(RAINIER.network.uiLoadedFromCloud()){n("remote");if($.cookie("user-name")){I.val($.cookie("user-name"));$("#remember-me").attr("checked","checked");setTimeout(function(){G.click()},50)}}else{n("local");E()}$("#dialog-overlay").hide();RAINIER.event.fire("uiInitCompleted")}function E(){if(RAINIER.network.isBehindNode()){var K=RAINIER.jnap.Transaction({onComplete:function(L){if(L.result==="OK"){if(j.deviceMode.mode==="Slave"){$("#reset-password").hide()}else{if(!j.isAdminPasswordDefault&&!j.isAdminPasswordSetByUser){window.location.replace("/ui/dynamic/recovery-pin.html")}}}n("local");RAINIER.ui.hideWaiting()},useAdminAuth:true,forceLocal:true,disableDefaultJnapErrHandler:true});K.add({action:"/jnap/nodes/smartmode/GetDeviceMode",data:{},cb:function(L){if(L.result==="OK"){j.deviceMode=L.output||{}}}});K.add({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(L){if(L.result==="OK"){j.isAdminPasswordDefault=L.output.isAdminPasswordDefault}}});K.add({action:"/jnap/nodes/setup/IsAdminPasswordSetByUser",data:{},cb:function(L){if(L.result==="OK"){j.isAdminPasswordSetByUser=L.output.isAdminPasswordSetByUser}}});RAINIER.ui.showWaiting();K.send()}else{n("local")}}function D(){RAINIER.util.trapEnter("#adminPass",o,function(){RAINIER.ui.inputBalloon.hide(100)});RAINIER.util.trapEnter("#password",b,function(){RAINIER.ui.inputBalloon.hide(100)});$("#local-login").click(E);$("#remote-login").click(function(){n("remote")});RAINIER.ui.associateButtons("input[type=text], input[type=password]","#submit-login");RAINIER.event.connect("rainier.cloudDown",function(){if(!RAINIER.network.isBehindNode()||window.location.hash==="#casupport"){n("local")}else{$("#slide-show p + p").hide()}});RAINIER.event.connect("initialInternetCheckCompleted",g);window.onbeforeunload=function(){RAINIER.event.fire("rainier.preventDialogs");RAINIER.event.fire("router.interruptionStarted");if($.cookie("user-auth-token")&&$.cookie("admin-auth")){RAINIER.network.clearUIProxyPathCookie()}};RAINIER.ui.init(H)}function J(){function K(M){var L=M.passwordHint;if(L.length>0){$(".showPasswordHint").show();$("#passwordHint").text(L)}}if(RAINIER.shared.util.areServicesSupported(["/jnap/core/Core3"])){RAINIER.network.getPasswordHint(K)}}function A(){if(!RAINIER.network.isBehindNode()){RAINIER.jnap.send({action:"/jnap/core/IsAdminPasswordDefault",data:{},cb:function(K){if(K.output.isAdminPasswordDefault){RAINIER.network.checkIfSetupInProgress(D,"admin")}else{D()}},forceLocal:true,disableDefaultJnapErrHandler:true})}else{D()}}function C(){$.cookie("force-pw-update",null,{path:"/"});$.cookie("user-email",null,{path:"/"});RAINIER.event.connect("RAINIER.network.deviceInfoCache:Set",function(){if(JNAP.cache.data["/core/GetDeviceInfo"]){h=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core7"]);if(h){RAINIER.jnap.send({action:"/jnap/core/GetAdminPasswordAuthStatus",data:{},cb:function(K){k=lodash.result(K,"output.attemptsRemaining",0);if(k<5){z=true;i=lodash.result(K,"output.delayTimeRemaining",0);RAINIER.event.connect("initialInternetCheckCompleted",c)}A()},forceLocal:true,disableDefaultJnapErrHandler:true})}else{A()}}else{D()}RAINIER.ui.showLinksysAppContent();s()});RAINIER.network.getDeviceInfo(J)}C()});