$(document).ready(function(){var n=$("body"),a=$("#global-balloon"),i=$("#adminPass"),h=$("#submit-login"),u=false,o=RAINIER.login.strings,p=0,t=0,w=true,d=false,q=false,s=null;function m(A){var z=Math.floor(A%3600/60),y=A%60;return z+":"+lodash.padStart(y,2,"0")}function c(z){var y={timeRemaining:m(t)};if(d){y.attemptsRemaining=p}return z.formatObj(y)}function x(){var y=a.find("span.msg span");if(!d){var z=o.routerLoginDelay.remainingAttempts.formatObj({attemptsRemaining:p});y.text(z)}else{y.hide()}}function v(y){y=c(y);RAINIER.ui.inputBalloon.message({els:i,message:y,preventAutoHide:true});if(t===0){x();h.prop("disabled",false);w=false}}function e(){var z="";switch(p){case 0:z=o.routerLoginDelay.lockedOut;break;case 1:z=d?o.routerLoginDelay.remainingAttemptsWait5Minutes:o.routerLoginDelay.wait5minutes;break;default:z=d?o.routerLoginDelay.remainingAttemptsTryAgainIn:o.routerLoginDelay.tryAgainIn;break}if(p>0){if(!s&&w&&t>0){var y=z;s=setInterval(function(){if(--t<=0){clearInterval(s);s=null;t=0}v(y)},1000);h.prop("disabled",true)}z=c(z)}else{q=true;i.val("").attr("placeholder","").attr("disabled",true);h.prop("disabled",true);$(".passwordHintSection").hide()}setTimeout(function(){RAINIER.ui.inputBalloon.message({els:i,message:z,preventAutoHide:true});if(p===0){a.find("a").on("click",function(){window.open("https://www.linksys.com/us/support-article?articleNum=318834")})}else{if(t===0||!w){x()}}},100)}function l(){if(_.isNumber(p)&&p<5){if(s||q){h.prop("disabled",true)}e();i.blur();RAINIER.ui.hideWaiting()}}function g(y){var z=o.invalidAdminPassword;RAINIER.ui.hideWaiting();RAINIER.ui.inputBalloon.message({els:i,message:z,color:"red",preventAutoHide:true});i.blur();i.attr("disabled",true);h.prop("disabled",true);a.find("a").on("click",function(){RAINIER.shared.util.setCookie("reset-code","force-update-welcome",null,"/");RAINIER.shared.util.setCookie("admin-auth","Basic "+window.btoa("admin:"+y),null,"/");window.location.replace("change-admin-password.html")})}function k(){var y=$.trim(i.val());function A(C){var B=RAINIER.ui.build;RAINIER.ui.inputBalloon.add({els:i,balloonContent:B.DIV({"class":"flow"},[B.SPAN({"class":"icon warning"}),B.SPAN({"class":"msg"},C)])},true);RAINIER.ui.inputBalloon.hide(7000)}if(!RAINIER.shared.util.isAdminPasswordValid(y)){RAINIER.ui.inputBalloon.message({els:i,message:RAINIER.login.strings.invalidRouterPassword,autoHide:true});return}function z(B){RAINIER.jnap.send({action:"/jnap/ownednetwork/SetNetworkOwner",data:{ownerSessionToken:$.cookie("user-auth-token"),friendlyName:B.friendlyName},cb:function(E,D){if(lodash.result(E,"result")==="OK"){RAINIER.network.discoverAuthority(function(){if(RAINIER.network.isBehindAuthority()&&!RAINIER.network.getAuthorityNetworkID()){window.location.replace("/ui/dynamic/welcome.html")}else{RAINIER.network.setRemoteSetting(true,function(){window.location.replace("/")})}})}else{RAINIER.ui.wait(false);var F=RAINIER.login.strings.unexpectedError,C=RAINIER.util.parseJSON(D.responseText);if(C&&C.result){switch(C.result){case"ErrorCloudUnavailable":F=RAINIER.login.strings.cloudUnavailable;break;case"_ErrorUnauthorized":F=RAINIER.login.strings.invalidRouterPassword;break}}else{}A(F)}},disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true,useAdminAuth:true,adminPasswordOverride:"Basic "+window.btoa("admin:"+y)})}RAINIER.shared.util.checkAdminPassword(y,function(B){if(lodash.result(B,"result")==="OK"){if(u&&!validation.checkRuleSet(validation.ruleSetInterop.adminPassword,y)){i.off("focus").on("focus",function(){g(y)});g(y);return}RAINIER.shared.util.getCurrentAuthorityDevice(function(C){RAINIER.ui.inputBalloon.hide(null,true);i.blur();RAINIER.ui.wait();z(C)},y)}else{switch(B.result){case"ErrorInvalidAdminPassword":case"ErrorPasswordCheckDelayed":case"ErrorAdminAccountLocked":w=true;d=false;p=lodash.result(B,"output.attemptsRemaining",0);t=lodash.result(B,"output.delayTimeRemaining",0);l();break;default:A(RAINIER.login.strings.invalidRouterPassword);break}}})}function f(){function y(A){var z=A.passwordHint;if(z.length>0){$(".showPasswordHint").show();$("#passwordHint").text(z)}}RAINIER.network.getPasswordHint(y)}function j(y){if(y){$(".showPasswordHint").hide();$(".hidePasswordHint").show()}else{$(".showPasswordHint").show();$(".hidePasswordHint").hide()}}function b(){$("#applet-container").css("visibility","visible");h.click(k);i.focus();i.keydown(function(z){var y=z.keyCode||z.which;if(y===13){$.cancelEvents(z);k()}});RAINIER.ui.placeholders.init();RAINIER.ui.init()}function r(){if(!RAINIER.util.isNoE($.cookie("rp"))){k()}RAINIER.network.getDeviceInfo(function(){u=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core7"]);if(RAINIER.shared.util.areServicesSupported(["/jnap/core/Core3"])){$(".showPasswordHint a").click(function(){j(true)});$(".hidePasswordHint a").click(function(){j(false)});f()}if(u){RAINIER.jnap.send({action:"/jnap/core/GetAdminPasswordAuthStatus",data:{},cb:function(y){p=lodash.result(y,"output.attemptsRemaining",0);b();if(p<5){d=true;t=lodash.result(y,"output.delayTimeRemaining",0);l()}},forceLocal:true,disableDefaultJnapErrHandler:true})}else{b()}})}r()});