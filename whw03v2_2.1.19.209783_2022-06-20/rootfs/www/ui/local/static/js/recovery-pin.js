$(document).ready(function(){var n=RAINIER.ui.buildInputValidBalloon,h=RAINIER.login.strings,m=false,l=$("#recovery-pin"),d=l.find("#invalidResetCode"),q=l.find("#attemptsRemaining"),j=l.find("#retriesReached"),o=l.find("#lockoutExpirationTime");var k=/mx.+/i;function e(r,s){RAINIER.network.getRouterCurrentTime(function(v){var t=symmetryUtil.time.routerTimeToDate(v),x=symmetryUtil.time.routerTimeToDate(r),w=x.getTime()-t.getTime(),u=Math.ceil((w/(1000*60*60))%24);s(u)})}function f(r){RAINIER.ui.hideWaiting();switch(r){case"ErrorInvalidResetCode":j.addClass("hidden");o.addClass("hidden");d.removeClass("hidden");q.removeClass("hidden");break;case"ErrorConsecutiveInvalidResetCodeEntered":q.addClass("hidden");if(m){d.removeClass("hidden")}else{d.addClass("hidden");j.removeClass("hidden");o.removeClass("hidden")}break;default:l.find("label").addClass("hidden");break}}function b(r){f(r.result);d.html(h.nodesResetPin.accessLocked);d.find("a").on("click",function(){window.open("https://www.linksys.com/us/support-article?articleNum=318834")})}function i(){if(!a()){return}var s="/jnap/nodes/setup/VerifyRouterResetCode",r={resetCode:l.find("input").val()};RAINIER.ui.wait();RAINIER.jnap.send({action:s,data:r,cb:function(v,u){if(v&&v.result==="ErrorConsecutiveInvalidResetCodeEntered"){if(m){b(v)}else{e(v.output.lockoutExpirationTime,function(w){f(v.result);l.find("#lockoutExpirationTime span").text(w)})}}else{f(v.result);if(v&&v.result==="OK"){RAINIER.shared.util.setCookie("reset-code",r.resetCode,1,"/");window.location.href="/ui/dynamic/change-admin-password.html"}else{if(v&&v.result==="ErrorInvalidResetCode"){var t=lodash.result(v,"output.attemptsRemaining");l.find("#attemptsRemaining span").text(t);if(m){if(t===1){q.hide();d.html(h.nodesResetPin.accessWillBeLocked)}else{if(t===0){b(v)}}}}else{RAINIER.ajax().executeDefaultJnapErrorHandler(v,s)}}}},useAdminAuth:true,forceLocal:true,disableDefaultJnapErrHandler:true})}function c(r){return !r||RAINIER.ui.validation.tests.isLengthInRange(5,5,r)}function a(){var s={validCharSet:"numeric",whiteSpace:false,isRequired:true},r=n($.extend(true,{},s,{els:l.find("input"),errors:[{test:c,when:false,message:RAINIER.ui.validation.strings.digit5}]}));return r.isValid(true)}function g(){RAINIER.ui.wait();if(!RAINIER.network.uiLoadedFromCloud()){RAINIER.network.setRemoteSetting(true,function(){window.location.replace("/ui/dynamic/login.html")})}else{window.location.replace("/ui/dynamic/login.html")}}function p(){RAINIER.network.getDeviceInfo(function(){var v=JNAP.cache.data["/core/GetDeviceInfo"].output,u=RAINIER.network.getBaseNetworkModelNumber(),s=RAINIER.network.getCurrentNetworkHardwareVersion(),t="/ui/static/cache/images/recovery_pin/",r=t+u+".png";m=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core7"]);if(symmetryUtil.nodes.isMeshRouter(u,s)){r=t+"MRxxxx.png"}else{if(k.test(u)){r=t+"MXxxxx.png"}}l.find("#velop-img").attr("src",r);l.find("#submit").click(i);l.find("#remote-login").click(g);RAINIER.ui.associateButtons("input[type=text]","#submit");RAINIER.ui.placeholders.init();RAINIER.jnap.send({action:"/jnap/nodes/setup/IsAdminPasswordSetByUser",data:{},cb:function(w){RAINIER.ui.init();RAINIER.ui.showAppletContainer();if(w&&w.result==="OK"&&!w.output.isAdminPasswordSetByUser){l.find("header h4").removeClass("hidden")}},useAdminAuth:true,forceLocal:true})})}p()});