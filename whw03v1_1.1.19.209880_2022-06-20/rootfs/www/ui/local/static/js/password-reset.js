$(document).ready(function(){function a(f){RAINIER.ui.wait(false);try{if(JSON.parse(f.responseText).errors[0].error.code==="INVALID_CURRENT_PASSWORD"){RAINIER.ui.inputBalloon.message({message:RAINIER.ui.myAccountStrings.errorChangingPassword,els:$("#currentPassword"),autoHide:true});return true}}catch(g){}RAINIER.ui.alert(RAINIER.ui.myAccountStrings.couldNotSaveAccountModifications,RAINIER.ui.myAccountStrings.couldNotSaveAccountModificationsTitle);return true}function d(){$.cookie("user-auth-token",null,{path:"/"});$.cookie("user-email",null,{path:"/"})}function b(){var k=RAINIER.shared.util.getURLParameter("verificationToken");if(!k){var f=RAINIER.ui.buildInputValidBalloon({els:$("#username"),minLen:7,maxLen:254,whiteSpace:false,isRequired:true,validationType:"email"});$(".reset-step1").show();$("#submit-password-reset").click(function(){var m=f.isValid(true);if(!m){return}RAINIER.ui.wait();var n=$.trim($("#username").val());$.cookie("user-email",n,{path:"/"});RAINIER.cloud.send({url:"/cloud/user-service/rest/accounts/"+n+"/passwordresets",type:"POST",request:{},cb:function(){$("#password-reset-sent").show();$("#account-fields-container").hide();RAINIER.ui.wait(false)},cbError:Account.loginErrorHandler})})}else{var j=false;function e(){RAINIER.ui.dialog("#success-dialog",{onSubmit:function(){d();window.location.replace("login.html")}}).show()}$(".reset-step2").show();if(RAINIER.shared.util.getURLParameter("req")==="1"){j=true;$(".requireUpdate").show();$(".notRequireUpdate").hide()}$("#usernameHidden").val($.cookie("user-email"));var h=RAINIER.ui.buildInputValidBalloon,l="my-account-password",i=$("#password-reset-container");var g={currentPassword:h($.extend(true,{},{els:$("#currentPassword"),isBlankOnBlur:false},validation.ruleSet.cloudAccountPassword)),password:h($.extend(true,{},{els:$("#password"),validationType:"newCloudPassword",isChecklist:true,noWarnIcon:true,group:l},RAINIER.network.getCloudAccountNewPasswordOptions())),passwordConfirm:h({els:$("#passwordConfirm"),validationType:"confirmPassword",elCompareTo:$("#password"),group:l})};RAINIER.ui.associateButtons("input[type=password]","#submit-new-password");$("#submit-new-password").click(function(){var n=true;if(j){n=g.currentPassword.isValid(true);if(!n){$("#currentPassword").blur();$("#currentPassword").focus()}}if(n){n=g.password.isValid();if(!n){g.password.isValid(true);i.find("#password").blur();i.find("#password").focus()}}if(n){n=g.passwordConfirm.isValid(true);if(!n){$("#passwordConfirm").blur();$("#passwordConfirm").focus()}}if(!n){return}var o={parameter:{name:"password",value:i.find("#password").val()}};if(j){var m=RAINIER.shared.util.getURLParameter("verificationToken");$.cookie("user-auth-token",m,{path:"/"});RAINIER.cloud.send({url:"/cloud/user-service/rest/v2/accounts/self/passwordchanges",type:"POST",data:{passwordChange:{newPassword:$("#password").val(),currentPassword:$("#currentPassword").val()}},cb:function(q,p){if(p.status!==200){a(p)}else{RAINIER.network.deleteUserSession(e,m)}},cbError:a})}else{Account.validate(k,e,o)}})}}function c(){var e=RAINIER.shared.util.getURLParameter("lang");if(e){RAINIER.ui.language.compareLangParameter(e,b)}else{b()}RAINIER.ui.placeholders.init();RAINIER.ui.showAppletContainer();RAINIER.ui.showSlides();RAINIER.ui.showLinksysAppContent(RAINIER.ui.linksysAppResources.captionPasswordReset)}RAINIER.network.getDeviceInfo(function(){RAINIER.ui.init(c)})});$(window).bind("beforeunload",function(){$.cookie("user-auth-token",null,{path:"/"})});