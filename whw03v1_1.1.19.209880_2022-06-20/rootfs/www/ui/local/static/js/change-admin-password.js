$(document).ready(function(){var i=RAINIER.ui.buildInputValidBalloon,a=false,c=false,h=RAINIER.shared.util.getCookie("reset-code"),f=lodash.startsWith(h,"force-update"),j=h==="force-update-welcome",d;function g(){if(!b()){return}var m=c?"/jnap/nodes/setup/SetAdminPassword2":"/jnap/nodes/setup/SetAdminPassword";var l={resetCode:h,adminPassword:$("#routerPassword").val(),passwordHint:$("#passwordHint").val()};if(!l.resetCode){window.location.replace("/ui/dynamic/index.html");return}if(f){m=c?"/jnap/core/SetAdminPassword2":"/jnap/core/SetAdminPassword";$.delAttr(l,"resetCode");if(!a){$.delAttr(l,"passwordHint")}}RAINIER.ui.wait();RAINIER.jnap.send({action:m,data:l,cb:function(p,n){if(p&&p.result==="OK"){RAINIER.shared.util.deleteCookie("reset-code");if(j){RAINIER.shared.util.deleteCookie("admin-auth");RAINIER.network.setRemoteSetting(true,function(){window.location.replace("welcome.html")})}else{RAINIER.shared.util.setCookie("admin-auth","Basic "+window.btoa("admin:"+l.adminPassword),null,"/");RAINIER.shared.util.setCookie("admin-password-reset",true,null,"/");RAINIER.shared.util.deleteCookie("user-auth-token");RAINIER.shared.util.deleteCookie("current-network-id");RAINIER.network.setRemoteSetting(false,function(){window.location.replace("/")})}}},useAdminAuth:true,forceLocal:true})}function e(){d={password:i($.extend(true,{},{els:$("#routerPassword"),validationType:"newRouterPassword",isChecklist:true,noWarnIcon:true},RAINIER.network.getRouterPasswordOptions())),passwordVisible:i($.extend(true,{},{els:$("#routerPasswordText"),validationType:"newRouterPassword",isChecklist:true,noWarnIcon:true},RAINIER.network.getRouterPasswordOptions())),hint:i($.extend(true,{},{els:$("#passwordHint"),validationType:"routerPasswordHint",maxLen:512,elCompareTo:$("#routerPassword")}))}}function b(){var l=true;if($("#routerPassword").is(":visible")){l=d.password.isValid();if(!l){d.password.isValid(true);$("#routerPassword").blur().focus()}}else{l=d.passwordVisible.isValid();if(!l){d.password.isValid(true);$("#routerPasswordText").blur().focus()}}if(l){l=d.hint.isValid(true);if(!l){$("#passwordHint").blur().focus()}}return l}function k(){$("#applet-container").css("visibility","visible");window.onbeforeunload=function(){RAINIER.shared.util.deleteCookie("reset-code")};RAINIER.network.getDeviceInfo(function(){a=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core3"]);c=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core7"]);if(!a){$("#passwordHint").hide()}$("#submit").click(g);$("textarea").val("");RAINIER.ui.init();RAINIER.ui.associateButtons("#routerPassword, #passwordHint","#submit");e();RAINIER.ui.viewPassword($(".password-eye-box"))})}k()});