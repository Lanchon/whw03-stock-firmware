(function(){var ck=$("#connectivity-applet"),bc=ck.find("#basic"),ae=ck.find("#local-network"),ar=ck.find("#vlan-tagging"),b0=ck.find("#vlanProfiles"),b1=ck.find("#administration"),a7=ck.find("#advanced-routing"),bm=ck.find("#fw-update-form"),aD=ck.find("#pm-fw-update-form"),ba=ck.find("#static-list"),aA=RAINIER.applets.connectivity.sharedOptions,Y=RAINIER.applets.connectivity.sharedEvents,F=ae.find('div.ip-input:[name="lanSettings.ipAddress"]'),bk=ae.find('input[name="lanSettingsSetup.dhcpSettings.maxClients"]'),b3=ck.find("#firmware-auto-nodes"),X=b3.find("#fw-details-block"),M=RAINIER.ui.dialogWarning,a0=null,aQ=null,h=null,m=null,bb=null,bU=null,b5=null,x=null,ac=null,aa=RAINIER.ui.buildInputValidBalloon,bL=null,bh=null,cp=null,ab=0,a2=0,ax=false,b4=false,aL={name:"",settings:{"interface":"",destinationLAN:"",subnetMask:"",gateway:""}},u={name:"",settings:{"interface":"",destinationLAN:"0.0.0.0",subnetMask:"0.0.0.0",gateway:"0.0.0.0"}},o=/^([0-9]+)\.([0-9]+)\.([0-9]+)\.([0-9]+)$/,q=/^.*(FW_APM[0-9][0-9][0-9]_Annex_[A-Z]).+$/,A=/^.*FW_[^_]+_(\d+)\..+$/i,ct=null,aH=null,bu=null,b2=null,cb=null,ak=false,bz=false,cq=null,cd=false,Q=false,e=false,bd=false,bj=window.location.hash,aS=240*1000,aR=5*1000,bN=3*1000,s=3,bg=0,bx=false,t,aU,aw=[];var w=RAINIER.applets.connectivity.internetSettings;var c=[".bin",".img",".trx",".ssa"];var P=RAINIER.ui.template.createTemplate($("#templateStaticRow tr")),ch=RAINIER.ui.template.createTemplate(ck.find("#template-wireless-radios > *")),S=RAINIER.ui.template.createTemplate(ck.find("#template-nodes-fw-details > *"));var b={devices:[],wireless:{radios:[]},portlights:false,firmware:{},firmwareStatus:{},time:{},lanSettings:{},lanSettingsSetup:{},linkAggregation:{},connections:{},info:{},routing:{entries:[]},mgmt:{},upnp:{},isSIPEnabled:false,adminPwRestrictions:{},dhcpLease:{},guestSettings:{},isCTFEnabled:false,isExpressForwardingEnabled:false,vlanSettings:{},vlanSettingsSetup:{maxVLANTaggingRulesPerPort:5},openVpn:{},wan:{},DSLSettings:{},PowerModemStatus:{},passwordHint:"",isAllJoynEnabled:false};var br={adminpass:"",isPasswordCurrent:false,portlights:false,wireless:{radios:[]},setWireless:[],dhcp:{},time:{},firmware:{},routing:{entries:[]},isSIPEnabled:false,routingList:[],supportedTimeZones:[],maxDHCPReservationDescriptionLength:0,maxStaticRouteEntries:0,trans:{},fwLastSuccessfulCheckTime:null,isCTFEnabled:false,vlanSettings:{},isAllJoynEnabled:false};var b6={"linkAggregation.isEnabled":"boolean","wan.mtu":"number","wan.tpSettings.useStaticSettings":"boolean","wan.bridgeSettings.useStaticSettings":"boolean","wan.useStaticSettings":"boolean","wan.tpSettings.maxIdleMinutes":"number","wan.tpSettings.reconnectAfterSeconds":"number","wan.L2TPSettings.maxIdleMinutes":"number","wan.L2TPSettings.reconnectAfterSeconds":"number","wan.pppoeSettings.maxIdleMinutes":"number","wan.pppoeSettings.reconnectAfterSeconds":"number","lanSettings.dhcpSettings.leaseMinutes":"number","lanSettings.dhcpSettings.maxClients":"number","ipv6.ipv6rdTunnelSettings.prefixLength":"number","ipv6.ipv6rdTunnelSettings.borderRelayPrefixLength":"number","vlanSettings.isEnabled":"boolean",vlanID:"number",vlanPriority:"number","vlanSettings.profile.vlanTaggingSettings.wanSettings.vlanID":"number","vlanSettings.profile.vlanTaggingSettings.ipTVSettings.vlanID":"number","vlanSettings.profile.vlanTaggingSettings.voIPSettings.vlanID":"number","vlanSettings.profile.vlanTaggingSettings.wanSettings.vlanPriority":"number","routing.isDynamicRoutingEnabled":"boolean","labels.band":"display-only","labels.short":"display-only","labels.network":"display-only","labels.networkName":"display-only"};var bp=aA.checks;var bv={name:"Manual",vlanTaggingSettings:{wanSettings:{vlanID:0,vlanPriority:0,vlanStatus:"Tagged"},ipTVSettings:[],voIPSettings:[]}};var cl={onEditRoute:function(){var cv=this.index()-1,cw=$(this);cw.addClass("edit");cw.removeClass("hover");RAINIER.binder.toDom(br.routingList[cv],cw,{});av(cw)},onDelRoute:function(){var cv=this.index()-1;br.routingList.splice(cv,1);$(this).hide();$(this).remove()},onUpdRoute:function(){var cv=this.index()-1,cx=$(this),cw=RAINIER.binder.fromDom(cx,{});if(aK(cx)){br.routingList[cv]=cw;RAINIER.binder.toDom(cw,cx);if(cw.settings["interface"]==="LAN"){cx.find("#interface-lan").show();cx.find("#interface-internet").hide()}else{cx.find("#interface-internet").show();cx.find("#interface-lan").hide()}cx.removeClass("edit")}},onCancelRoute:function(){var cv=this.index()-1,cx=$(this),cw=br.routingList[cv];RAINIER.ui.inputBalloon.hide();RAINIER.ui.validation.removeInvalidMarks(cx);cx.removeClass("edit");if(b7(cw)){br.routingList.splice(cv,1);cx.remove()}else{RAINIER.binder.toDom(cw,cx)}},onAutoFirmwareUpdate:function(){M({msg:ck.find("#updateFwConfirm").html(),onSubmit:function(){$("#fw-installing").css("display","none");$("#fw-downloading").css("display","inline");ak=true;n()}})},onManualFirmwareUpdate:function(){console.warn("onManualFirmwareUpdate");if(a0&&a0.isShowing()){a0.close()}M({msg:ck.find("#updateFwConfirm").html(),onSubmit:function(){ak=false;N()}})},onManualPmFirmwareUpdate:function(){console.warn("onManualPmFirmwareUpdate");x=M({msg:ck.find("#updatePmFwConfirm").html(),onSubmit:function(){bz=false;bS()}})},onEnableVlanChange:function(cw){var cv=$(cw.target).is(":checked");b0.attr("disabled",!cv);RAINIER.ui.shield.toggle(ar.find(".highlighted.block-row"),!cv)},onVlanProfilesChange:function(){if(!bd){var cv=b0.val(),cw={vlanSettings:{}};if(cv!=="Manual"){$.each(aw,function(){if(this.name===cv){cw.vlanSettings.profile=this}})}else{RAINIER.ui.shield.toggle(ar.find(".highlighted.block-row"),false)}if(!cw.vlanSettings.profile&&b.vlanSettings.profile&&b.vlanSettings.profile.name!=="Manual"){cw.vlanSettings.profile=$.extend({},b.vlanSettings.profile);cw.vlanSettings.profile.name="Manual"}bF(cw)}},onClose:Y.onClose,onApply:function(){bt(false)},onSave:function(){bt(true)},onSaveComplete:Y.onSaveComplete};var aF={advancedrouting:false,vlantagging:false,administration:false,powerModem:false};var az={cutThroughForwarding:false,expressForwarding:false,passwordHint:false,allJoyn:false,router6:false,powerTable:false,core7:false};var aO={basic:ck.find("#basic-tab"),localNetwork:ck.find("#localnetwork-tab"),advancedrouting:ck.find("#advancedrouting-tab"),vlantagging:ck.find("#vlantagging-tab"),administration:ck.find("#administration-tab"),powerModem:ck.find("#powerModem-tab"),velopSimpleSetup:ck.find("#velopSimpleSetup-tab")};function bt(cw){var cv=false;aA.doClose=cw||false;aA.doSave=true;switch(b2){case"basic":if(T()){cv=true;if(bT()){au()}}break;case"internet-settings":cv=w.save();break;case"power-modem":if(w.powerModemHasChanges()){cv=true;w.pmSettingsSave()}break;case"local-network":if(ao()){cv=true;if(bX()){a3()}}break;case"advanced-routing":if(bi()){cv=true;if(aN()){bI()}}break;case"vlan-tagging":if(D()){cv=true;if(aT()){bn()}}break;case"administration":if(j()){cv=true;aM()}break}if(aA.doClose&&!cv){cl.onClose()}}function E(){var cv=false;switch(bu){case"basic":cv=T();break;case"internet-settings":cv=w.internetSettingsHasChanges();break;case"power-modem":cv=w.powerModemHasChanges();break;case"local-network":cv=ao();break;case"advanced-routing":cv=bi();break;case"vlan-tagging":cv=D();break;case"administration":cv=j();break}if(cv){b2=bu;ct.show()}return cv}function B(){bd=true;switch(b2){case"basic":aV();ah();bA();break;case"internet-settings":w.resetTabChanges();break;case"power-modem":w.resetPowerModemChanges();break;case"local-network":$.extend(true,b.lanSettingsSetup,b.lanSettings);aX();bK();break;case"advanced-routing":ap();break;case"vlan-tagging":bF();break;case"administration":r();break}bd=false}function bC(){w.pageLoad();w.internetSettingsAddEvents()}function ci(cv){cv.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(cw){if(cw.result==="OK"){b.wireless=cw.output||{};RAINIER.applets.wireless.sortRadios(b.wireless.radios);console.warn("getRadioInfo",RAINIER.jnapActions.getRadioInfo(),b.wireless)}else{}}});cv.add({action:"/jnap/locale/GetTimeSettings",data:{},cb:function(cw){b.time=cw.output||{};if(cw.result==="OK"){b.time.supportedTimeZones.sort(function(cy,cx){if(cy.description===cx.description){return 0}else{if(cy.description>cx.description){return 1}else{return -1}}});br.supportedTimeZones=b.time.supportedTimeZones;$.delAttr(b.time,"currentTime","supportedTimeZones")}else{}}});cv.add({action:"/jnap/routerleds/GetRouterLEDSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.portlights=cw.output.isSwitchportLEDEnabled}else{}}});cv.add({action:"/jnap/firmwareupdate/GetFirmwareUpdateSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.firmware=cw.output||{}}else{}}});cv.add({action:"/jnap/core/GetAdminPasswordRestrictions",data:{},cb:function(cw){if(cw.result==="OK"){b.adminPwRestrictions=cw.output||{}}else{}}});cv.add({action:"/jnap/core/GetDeviceInfo",data:{},cb:function(cw){if(cw.result==="OK"){b.info=cw.output||{}}else{}}});if(aF.powerModem){cv.add({action:"/jnap/powermodem/GetDSLSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.DSLSettings=cw.output||{}}}});cv.add({action:"/jnap/powermodem/GetPowerModemStatus",data:{},cb:function(cw){if(cw.result==="OK"){b.PowerModemStatus=cw.output||{};if(b.PowerModemStatus.status==="Found"){ad()}else{bc.find("#pm-fw-version").hide()}}}})}cv.add({action:RAINIER.jnapActions.getWANStatus(),data:{},cb:function(cw){if(cw.result==="OK"){if(cw.output){b.wan=cw.output}else{}}else{}}});RAINIER.applets.guestNetwork.getSettings(b.guestSettings,function(cw){b.guestSettings=$.extend({},cw)},cv);if(az.passwordHint){cv.add({action:"/jnap/core/GetAdminPasswordHint",data:{},cb:function(cw){if(cw.result==="OK"){b.passwordHint=cw.output||{}}else{}}})}if(RAINIER.shared.util.areServicesSupported(["/jnap/powertable/PowerTable"])){cv.add({action:"/jnap/powertable/GetPowerTableSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.powerTable=cw.output||{};az.powerTable=cw.output.isPowerTableSelectable}else{}}})}}function cs(){var cv=null,cw=null;bc.find("#basic-wireless-radios").empty();$.each(b.wireless.radios,function(cy,cx){if(RAINIER.applets.wireless.shouldFilterRadio(cx,b.wireless)){cw=RAINIER.shared.util.getLabeledRadio(b.wireless,cx.radioID);RAINIER.applets.wireless.setDisplayWepKey(cw);cv=RAINIER.ui.template.createBlock(ch,cw,b6);cv.prop("id",cx.radioID);if(RAINIER.network.isRadioLocked(cx.band)){cv.find(".row").hide();cv.find("#bridge-message").text(RAINIER.ui.strings.bridge.radioLocked);cv.find("#wireless-bridge").show()}else{ai(cv,cx)}cv.find("[tooltip]").each(function(){$(this).attr("tooltip",$(this).text())});bc.find("#basic-wireless-radios").append(cv);bB(bc.find("#"+RAINIER.ui.escapeId(cx.radioID)),cx)}});if(b.wireless.bandSteeringMode==="TriBand"){bc.find("#basic-wireless-enabled").addClass("triBandSteeringMode")}else{bc.find("#basic-wireless-enabled").removeClass("triBandSteeringMode")}bc.find("#basic-wireless-enabled").show();RAINIER.ui.tooltip.add("#basic-wireless-enabled [tooltip]")}function bO(){if(!az.passwordHint){return}if(b.passwordHint.passwordHint!==""){bc.find("#passwordHintLabel").text(b.passwordHint.passwordHint).show();bc.find("#noPasswordHintLabel").hide()}else{bc.find("#passwordHintLabel").hide();bc.find("#noPasswordHintLabel").show()}}function aV(){var cv=null;bc.find("#time-zone").empty();$.each(br.supportedTimeZones,function(){cv={timeZoneID:this.timeZoneID,description:RAINIER.ui.common.strings.timeZones[this.timeZoneID]||this.description};bc.find("#time-zone").append('<option value="{timeZoneID}">{description}</option>'.formatObj(cv))});bc.find("#auto-adj-dst").attr("disabled",b.time.timeZoneID.indexOf("NO-DST")>-1);RAINIER.binder.toDom(b,bc,b6);cs();bO();ck.find(".firmware-auto-update").attr("checked",(b.firmware.updatePolicy.indexOf("Automatically")===0));if($.cookie("user-auth-token")){ck.find("#firmware-manual #fw-update-user-auth-token, #pm-firmware-manual #pm-fw-update-user-auth-token").attr("value",$.cookie("user-auth-token"));ck.find("#firmware-manual #fw-update-admin-auth, #pm-firmware-manual #pm-fw-update-admin-auth").detach()}else{ck.find("#firmware-manual #fw-update-admin-auth, #pm-firmware-manual #pm-fw-update-admin-auth").attr("value",$.cookie("admin-auth"));ck.find("#firmware-manual #fw-update-user-auth-token, #pm-firmware-manual #pm-fw-update-user-auth-token").detach()}RAINIER.ui.fixIeForm("#basic-wireless-radios")}function p(){RAINIER.applets.connectivity.initializeDefaultMacAddressInputValues(bc);RAINIER.applets.connectivity.initializeGeneralInputValues(bc)}function C(){var cx=ck.find("#firmware-file").val().toLowerCase(),cw=RAINIER.network.getCurrentNetworkModelNumber().toLowerCase(),cv=RAINIER.network.getBaseNetworkModelNumber().toLowerCase(),cy=lodash.words(RAINIER.network.getCurrentNetworkHardwareVersion())[0];if($.grep(c,function(cz){return cx.indexOf(cz)===cx.length-4}).length===0){a0=M({msg:ck.find("#invalidFwExtension").html(),onSubmit:function(){cl.onManualFirmwareUpdate()}})}else{if((cx.indexOf(cw)===-1&&cx.indexOf(cv)===-1)||cy!==cx.replace(A,"$1")){a0=M({msg:ck.find("#invalidFwName").html(),onSubmit:function(){cl.onManualFirmwareUpdate()}})}else{if(cx!==""){cl.onManualFirmwareUpdate()}}}}function ah(){ck.find("#basic-wireless-enabled").removeClass("edit");ck.find("#edit-basic-wireless").show();ck.find("#edit-basic-wireless > a").removeClass("disabled").removeProp("disabled");aV()}function bA(){ck.find("#edit-router-password > a").removeClass("disabled").removeProp("disabled");ck.find("#edit-router-password").show();bc.find("#password-section .readOnly").show();bc.find("#update-password").hide();ck.find("#current-router-password").val("");ck.find("#router-password").val("");ck.find("#confirm-router-password").val("");ck.find("#router-password-hint input").val("").trigger("keyup").hide();ck.find('#router-password-hint input[type="password"]').show();RAINIER.ui.inputBalloon.hide();RAINIER.ui.validation.removeInvalidMarks("#update-password")}function cr(){RAINIER.util.trapEnter($("#basic-wireless-enabled, #password-section, #local-network, #internet-settings").find("input[type=text]"));if(!RAINIER.network.isAuthorityRemote()||RAINIER.shared.util.areServicesSupported(["/jnap/core/Core2"])){bc.find("#edit-router-password > a").click(function(){bc.find("#password-section .readOnly").hide();if(az.passwordHint){bc.find("#update-password .passwordHintSection").removeClass("hidden");bc.find("#update-password .noPasswordHintSection").hide()}bc.find("#update-password").css("display","block");ck.find("#edit-router-password > a").addClass("disabled").prop("disabled");RAINIER.ui.fixIeForm("#password-section")})}else{bc.find("#password-section").hide()}bc.find("#update-password .close-button").click(function(){bA()});RAINIER.ui.viewPassword(bc.find(".password-eye-box"));RAINIER.ui.tooltip.add(bc.find(".filename"),"top");RAINIER.ui.editFormClick($("#basic-wireless-enabled"),$("#edit-basic-wireless > a"));ck.find("#time-zone").change(function(){var cw=$(this).val();$.each(br.supportedTimeZones,function(){if(this.timeZoneID===cw){ck.find("#auto-adj-dst").attr("disabled",!this.observesDST);ck.find("#auto-adj-dst").attr("checked",this.observesDST);return}})});ck.find("#firmware-update .check-update").click(I);if(RAINIER.network.isBehindNode()){ck.find("#firmware-auto-nodes #start-updates button").click(cl.onAutoFirmwareUpdate);b3.find("#fw-details").click(function(){b3.removeClass("show-details");if(b3.hasClass("details")){b3.removeClass("details")}else{if(b3.hasClass("updating")){b3.removeClass("updating")}else{b3.addClass("show-details");if(t){b3.addClass("details")}else{b3.addClass("updating")}}}})}ck.find(".choose-file").click(function(cy){if(!$.browser.msie){var cx=$(cy.target),cw=cx.attr("id")==="pm-choose-file"?ck.find("#pm-firmware-file"):ck.find("#firmware-file");cw.click()}return false});if($.browser.msie){var cv=bc.find("#firmware-file, #pm-firmware-file");RAINIER.ui.tooltip.add(cv,"top");cv.hover(function(cw){$(cw.target).siblings(".choose-file").addClass("hover")},function(cw){$(cw.target).siblings(".choose-file").removeClass("hover")});cv.mousedown(function(cw){$(cw.target).siblings(".choose-file").addClass("active")});cv.mouseup(function(cw){$(cw.target).siblings(".choose-file").removeClass("active")});cv.mouseout(function(cw){$(cw.target).siblings(".choose-file").removeClass("active")})}else{ck.find("#filename, #pm-filename").click(function(cw){$(cw.target).siblings(".choose-file").click()})}ck.find("#firmware-file, #pm-firmware-file").change(function(cz){var cx=$(this).val(),cw=$(cz.target),cA=cw.siblings("label"),cy=cw.attr("id")==="pm-firmware-file"?ck.find("#pm-start-update"):ck.find("#start-update");var cB=cx.replace(/^.*[\\\/]/,"");cA.text(cB).attr("tooltip",cB);cw.attr("tooltip",cB);if(cx!==""){cy.removeAttr("disabled")}else{cy.attr("disabled",true)}});ck.find("#start-update").click(C);ck.find("#pm-start-update").click(bP);bm.submit(function(){if(cd){cd=false;return true}return false});aD.submit(function(){if(e){e=false;return true}return false})}function aW(){var cw={minLen:b.adminPwRestrictions.minLength,maxLen:b.adminPwRestrictions.maxLength,whiteSpace:false,isRequired:false,isBlankOnBlur:false,errors:[{test:new RegExp("^$|^["+RAINIER.ui.validation.concatAllowedCharRanges(b.adminPwRestrictions.allowedCharacters)+"]+$"),when:false,message:RAINIER.ui.validation.strings.invalidCharacters}]},cx={isBlankOnBlur:true,errors:[{test:RAINIER.ui.validation.tests.matchAnotherInput.curry($("#router-password")),when:false,message:RAINIER.ui.validation.strings.passwordDoesNotMatch}]},cv=bp.basic;cv.routerPW=aa($.extend(true,{},cw,{els:ck.find("#current-router-password")}));cv.newRouterPW=aa($.extend(true,{},{els:ck.find("#router-password"),validationType:"newRouterPassword",isChecklist:true,noWarnIcon:true},RAINIER.network.getRouterPasswordOptions()));cv.confirmRouterPW=aa($.extend(true,{},cw,cx,{els:ck.find("#confirm-router-password")}));if(az.passwordHint){cv.newRouterPWHidden=aa($.extend(true,{},{els:ck.find('#router-password-hint input[type="password"]'),validationType:"newRouterPassword",isChecklist:true,noWarnIcon:true},RAINIER.network.getRouterPasswordOptions()));cv.newRouterPWVisible=aa($.extend(true,{},{els:ck.find('#router-password-hint input[type="text"]'),validationType:"newRouterPassword",isChecklist:true,noWarnIcon:true},RAINIER.network.getRouterPasswordOptions()));cv.pwHint=aa($.extend(true,{},{els:ck.find("#password-hint"),validationType:"routerPasswordHint",maxLen:512,elCompareTo:ck.find('#router-password-hint input[type="password"]')}))}RAINIER.util.trapEnter("#router-password")}function bB(cx,cw){var cA=RAINIER.util.getObjVal(cw,"settings.wepSettings.encryption"),cv=bp.basic,cz={validCharSet:"ascii",maxLen:64,isRequired:true},cy={maxLen:26,validCharSet:"hex",whiteSpace:false,isRequired:true};cv[cw.radioID+"ssid"]=aa($.extend(true,{},aA.rules.ssid,{els:cx.find('input:[name="settings.ssid"]')}));cv[cw.radioID+"passPhrase"]=aa($.extend(true,{},aA.rules.password,{els:cx.find('input:[name="settings.wpaPersonalSettings.passphrase"]'),errors:[{test:RAINIER.ui.validation.tests.isWpaPassword,when:false,message:RAINIER.ui.validation.strings.invalidWpaPassword}]}));cv[cw.radioID+"wepKey"]=aa($.extend(true,{},cy,{els:cx.find('input:[name="settings.wepSettings.key"]'),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry($('<input value="{0}"></input>'.format(cA)),1,$('<input value="1"></input>')),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));cv[cw.radioID+"sharedKey"]=aa($.extend(true,{},cz,{els:cx.find('input:[name="settings.wpaEnterpriseSettings.sharedKey"]')}))}function bT(){var cw=bp.basic,cy=true;if(bc.find("#basic-wireless-enabled").is(":visible")){var cx=null;$.each(b.wireless.radios,function(cB,cA){cx=bc.find("#"+RAINIER.ui.escapeId(cA.radioID));if(cy&&cx.find('input:[name="settings.ssid"]').is(":visible")){cy=cw[cA.radioID+"ssid"].isValid(true)}if(cy&&cx.find('input:[name="settings.wpaPersonalSettings.passphrase"]').is(":visible")){cy=cw[cA.radioID+"passPhrase"].isValid(true)}if(cy&&cx.find('input:[name="settings.wepSettings.key"]').is(":visible")){cy=cw[cA.radioID+"wepKey"].isValid(true)}if(cy&&cx.find('input:[name="settings.wpaEnterpriseSettings.sharedKey"]').is(":visible")){cy=cw[cA.radioID+"sharedKey"].isValid(true)}});if(cy&&RAINIER.applets.guestNetwork.isGuestSSIDConflict(b.guestSettings,br.wireless.radios)){ac.show();cy=false}}if(bc.find("#update-password").is(":visible")){if(az.passwordHint){if(cy){var cv=bc.find('#router-password-hint input[type="password"]'),cz=bc.find('#router-password-hint input[type="text"]');if(cv.is(":visible")){cy=cw.newRouterPWHidden.isValid();if(!cy){cw.newRouterPWHidden.isValid(true);cv.blur().focus()}}else{cy=cw.newRouterPWVisible.isValid();if(!cy){cw.newRouterPWVisible.isValid(true);cz.blur().focus()}}if(!cy){bc.find(".password-eye-box").addClass("invalid")}else{bc.find(".password-eye-box").removeClass("invalid")}if(cy){cy=cw.pwHint.isValid(true)}}}else{if(cy){cy=cw.routerPW.isValid(true)}if(cy){cy=cw.newRouterPW.isValid(true)}if(cy){cy=cw.confirmRouterPW.isValid(true)}}}return cy}function bf(){if(az.powerTable){RAINIER.shared.ui.populateRegions(b.powerTable.supportedCountries,bc.find("#region-select")[0]);bc.find("#power-table").removeClass("hidden")}aV();cr();aW();if(aF.powerModem){aE()}else{bc.find("#pm-firmware-update").remove()}if(az.passwordHint){bc.find(".passwordHintSection").removeClass("hidden")}if(bj==="#casupport"){bc.find("#firmware-manual").removeClass("showForLinksysRouters")}}function ai(cv,cw){if(cw.settings.security==="None"){cv.find("#basic-wep-password").hide();cv.find("#basic-wpa-password").hide();cv.find("#basic-no-security").show();cv.find("#basic-wpa-enterprise-key").hide()}else{if(cw.settings.security==="WEP"){cv.find("#basic-wep-password").show();cv.find("#basic-wpa-password").hide();cv.find("#basic-no-security").hide();cv.find("#basic-wpa-enterprise-key").hide()}else{if(cw.settings.security==="WPA-Enterprise"||cw.settings.security==="WPA2-Enterprise"||cw.settings.security==="WPA-Mixed-Enterprise"){cv.find("#basic-wep-password").hide();cv.find("#basic-wpa-password").hide();cv.find("#basic-no-security").hide();cv.find("#basic-wpa-enterprise-key").show()}else{cv.find("#basic-wep-password").hide();cv.find("#basic-wpa-password").show();cv.find("#basic-no-security").hide();cv.find("#basic-wpa-enterprise-key").hide()}}}}function aZ(cv){var cx=cv.settings.security;if(!RAINIER.util.isSecurityTypeWep(cx)){delete cv.settings.wepSettings}else{delete cv.settings.wepSettings.passphrase;var cw=cv.settings.wepSettings.txKey;cv.settings.wepSettings["key"+cw]=cv.settings.wepSettings.key;delete cv.settings.wepSettings.key}if(!RAINIER.util.isSecurityTypeWpaPersonal(cx)){delete cv.settings.wpaPersonalSettings}if(!RAINIER.util.isSecurityTypeWpaEnterprise(cx)){delete cv.settings.wpaEnterpriseSettings}return cv}function ad(){RAINIER.jnap.send({action:"/jnap/powermodem/GetPowerModemFirmwareVersion",data:{},cb:function(cv){if(cv.result==="OK"){bc.find('[name="pmFirmwareVersion.firmwareVersion"]').html(cv.output.firmwareVersion)}},disableDefaultJnapErrHandler:true})}function L(){var cv=$.Deferred();function cx(cy){if(cy.result==="OK"){br.isPasswordCurrent=true}else{br.isPasswordCurrent=false}cv.resolve("CheckAdminPassword complete")}if(RAINIER.network.uiLoadedFromCloud()||RAINIER.shared.util.areServicesSupported(["/jnap/core/Core7"])){cx({result:"OK"});return}else{if(RAINIER.shared.util.areServicesSupported(["/jnap/core/Core2"])){var cw={adminPassword:br.currentAdminpass};RAINIER.jnap.send({action:"/jnap/core/CheckAdminPassword2",data:cw,cb:cx,disableDefaultJnapErrHandler:true})}else{RAINIER.jnap.send({action:"/jnap/core/CheckAdminPassword",data:{},cb:cx,disableDefaultJnapErrHandler:true,useAdminAuth:true,adminPasswordOverride:"Basic "+window.btoa("admin:"+br.currentAdminpass)})}}return cv}function W(){ck.find("#firmware-update #check-progress").removeClass("show");ck.find("#firmware-update #no-update").removeClass("show");ck.find("#firmware-update #server-unavailable").removeClass("show");ck.find("#firmware-update #firmware-download").removeClass("show")}function v(){ck.find("#firmware-auto-nodes-header").removeClass("alert");ck.find("#firmware-auto-nodes-header").removeClass("check");ck.find("#firmware-auto-nodes-header #time-to-update").removeClass("show");ck.find("#firmware-auto-nodes-header #up-to-date").removeClass("show");ck.find("#firmware-auto-nodes-header #no-internet-detected").removeClass("show");ck.find("#firmware-auto-nodes-header #cannot-reach-server").removeClass("show")}function ca(cv,cw){console.warn("updateNodesFwVersions",cw);t=cw;bo()}function J(){if(t){X.find(".node-details").each(function(cx,cy){var cw=$(cy),cA=cw.data("id"),cz=_.result(_.find(aU.output.firmwareUpdateStatus,{deviceUUID:cA}),"availableUpdate");console.warn("updateNodesFwDetails",cz);cw.find(".checking-fw, .available-fw, .up-to-date-fw").removeClass("show");if(cz){var cv=RAINIER.ui.common.strings.firmwareUpdate.AvailableVersion.format(cz.firmwareVersion);cw.find(".info-badge").attr("tooltip",cv);cw.find(".device-icon").addClass("update-available");cw.find(".available-fw").addClass("show")}else{cw.find(".device-icon").addClass("up-to-date");cw.find(".up-to-date-fw").addClass("show")}})}}function bo(){console.warn("populateNodesFwDetails",t);X.find(".node-details").remove();_.each(t,function(cv){var cy,cx=cv.deviceID,cw=RAINIER.network.getSeriesModel(cv.model);if(cw){cv.model=cw}cy=RAINIER.ui.template.createBlock(S,cv);cy.data("id",cx);cy.find(".device-icon").addClass(cv.deviceIcon);cy.find(".checking-fw").addClass("show");cy.find('span[name="deviceName"]').attr("tooltip",cv.deviceName);X.append(cy)});RAINIER.ui.tooltip.add(X.find("[tooltip]"),"top");if(b3.hasClass("updating")){b3.removeClass("updating");b3.addClass("details")}if(aU){J();if(t.length>aU.output.firmwareUpdateStatus.length){I()}}}function ay(){ck.find("#firmware-auto-nodes-header").addClass("check");RAINIER.ui.spinner.build("#spinner-section-nodes",18).spin("#spinner-section-nodes")}function I(){console.warn("[chkFwUpdate]");RAINIER.event.fire("rainier.firmwareCheckInitiated");ck.find("#firmware-update .check-update").attr("disabled","true");if(RAINIER.network.isBehindNode()){v();ay();RAINIER.network.checkNodesFwUpdate(aB,function(cv){aB({output:{firmwareUpdateStatus:[{lastOperationFailure:{error:"Error"}}]}})})}else{W();ck.find("#firmware-update #check-progress").addClass("show");RAINIER.ui.spinner.build("#spinner-section",18).spin("#spinner-section");a2=0;bV(function(){br.fwLastSuccessfulCheckTime=b.firmwareStatus.lastSuccessfulCheckTime;RAINIER.jnap.send({action:"/jnap/firmwareupdate/UpdateFirmwareNow",data:{onlyCheck:true},cb:function(cv){if(cv&&cv.result==="OK"){setTimeout(function(){bV(ce)},2500)}else{if(cv&&cv.result==="_ErrorTargetUnreachable"){ck.find("#firmware-update #server-unavailable").addClass("show")}else{}}}})})}}function ce(){var cv=(b.firmwareStatus.lastSuccessfulCheckTime!==br.fwLastSuccessfulCheckTime),cw=(!b.firmwareStatus.pendingOperation||b.firmwareStatus.pendingOperation.operation!=="Checking");if(b.firmwareStatus.availableUpdate||(cv&&cw)||a2>15){cu()}else{a2++;setTimeout(function(){bV(ce)},2500)}}function aC(cw){if(cw>100){clearInterval(bh)}else{var cv=$("#firmware-progress");if(Q){cv=$("#pm-firmware-progress")}RAINIER.ui.progressBar.update({element:cv.find("div.progress-bar"),percent:cw})}}function bR(){RAINIER.ui.showMasterWaiting();RAINIER.event.disconnect("dialog.routerRebootClosed",bR)}function cn(){ax=false;b4=false;cq=(new Date()).getTime();console.warn("Firmware Update starting - "+cq);aC(0);if(Q){bb.show()}else{m.show()}RAINIER.event.connect("dialog.routerRebootClosed",bR)}function bS(){Q=true;e=true;aJ("manualPmFwUpdate",aD)}function N(){cd=true;aJ("manualFwUpdate",bm)}function aJ(cx,cw){var cA=0;function cy(){if(!bh){bh=setInterval(function(){aC(++cA)},665)}}function cv(cB){if(cB.lengthComputable){cA=((cB.loaded/cB.total)/2)*100;console.warn("FW Upload progress - {0} of {1} [{2}%]".format(cB.loaded,cB.total,cA));if(cA>=49.5||cB.loaded===cB.total){cy()}else{aC(cA)}}else{aC(++cA)}}RAINIER.event.fire("router.interruptionStarted");console.warn("["+cx+" - Submitting Image]");cn();if(window.FormData){var cz=new FormData(cw[0]);$.ajax({url:cw.attr("action"),type:"POST",data:cz,cache:false,contentType:false,processData:false,timeout:aS,xhr:function(){var cB=$.ajaxSettings.xhr();if(cB.upload){cB.upload.addEventListener("progress",cv,false);cB.upload.addEventListener("load",cy,false)}else{cy()}return cB},success:function(cE){var cC=cE?cE:"[no response]",cD=RAINIER.util.parseJSON(cC),cB="2123";if(cD){cB=cD.result}console.warn(["JCGI call complete - ms elapsed: ",((new Date()).getTime()-cq)]);console.warn("Response: "+cC);if(cB==="OK"){b4=true;bL=setTimeout(function(){y(bE)},4000);cy()}else{bY("Done - JCGI return: "+cC)}},error:function(cB,cD,cC){bY("Fail - JCGI return: {0} - {1}".format(cD,cC))}})}else{$("#form-target").load(function(){try{var cD=this.contentWindow?this.contentWindow.document.body.innerHTML:null,cC=$(cD),cF=cC?cC.text():"[no response]",cG=RAINIER.util.parseJSON(cF),cB="2123";if(cG){cB=cG.result}console.warn(["JCGI call complete - ms elapsed: ",((new Date()).getTime()-cq)]);console.warn("Response: "+cF);if(cB==="OK"){b4=true;bL=setTimeout(function(){y(bE)},4000)}else{bY("JCGI submit failed (response): "+cF)}}catch(cE){bY("JCGI submit failed (exception): "+cE)}});cw.submit();cy()}cp=setTimeout(bY,60*7*1000)}function n(){console.warn("[getFwUpdate - Retrieving Firmware update]");RAINIER.event.fire("router.interruptionStarted");cn();if(RAINIER.network.isBehindNode()){console.info("Starting Nodes FW update via lib");symmetryUtil.firmwareUpdate.update({success:function(cv){if(sessionStorage){sessionStorage.setItem("nodesFWUpdateStatus",JSON.stringify(cv))}K(true)},error:function(cv){var cx=lodash.result(cv,"output.firmwareUpdateStatus"),cw=lodash.result(_.find(cx,"lastOperationFailure"),"lastOperationFailure","UpdateFailed");m.close();K(false,cw)},progress:V,progressOffset:2,pollingTimeout:1500})}else{RAINIER.jnap.send({action:"/jnap/firmwareupdate/UpdateFirmwareNow",data:{onlyCheck:false},cb:function(cv){if(cv.result==="OK"){ck.find("#firmware-update #firmware-download").removeClass("show");bL=setTimeout(function(){y(bE)},aR)}else{m.close();I(false)}}})}return true}function aB(cv){console.warn("[updateNodesFwInfo]",cv);v();b.firmwareStatus=_.find(cv.output.firmwareUpdateStatus,"availableUpdate");aU=RAINIER.network.getNodesAvailableUpdates();if(!b.firmwareStatus){b.firmwareStatus=_.find(cv.output.firmwareUpdateStatus,"lastOperationFailure")}else{ck.find("#firmware-auto-nodes-header").addClass("alert");ck.find("#firmware-auto-nodes-header #time-to-update").addClass("show");b3.addClass("install");J()}if(!b.firmwareStatus){ck.find("#firmware-auto-nodes-header #up-to-date").addClass("show");b.firmwareStatus=cv.output.firmwareUpdateStatus[0];J()}cu()}function cu(){console.warn("[updateFwInfo]");var cv=b.firmwareStatus.availableUpdate;RAINIER.ui.spinner.stop("#spinner-section");W();if(cv){var cw=RAINIER.ui.common.strings.firmwareUpdate.UpdateAvailable.format(cv.firmwareVersion);ck.find("#firmware-auto #firmware-download").html(cw);ck.find("#firmware-auto #firmware-download a").click(cl.onAutoFirmwareUpdate);ck.find("#firmware-auto #firmware-download").addClass("show")}else{if(b.firmwareStatus.lastOperationFailure){if(RAINIER.network.isBehindNode()){v();ck.find("#firmware-auto-nodes-header #cannot-reach-server").addClass("show")}else{ck.find("#firmware-update #server-unavailable").addClass("show")}}else{ck.find("#firmware-update #no-update").addClass("show")}}ck.find("#firmware-update .check-update").removeAttr("disabled")}function aI(){if(bh){clearInterval(bh);bh=null}if(bL){clearTimeout(bL);bL=null}if(cp){clearTimeout(cp);cp=null}}function bY(cv){if(Q){console.warn("[PowerModem - chkCancelManualUpdate]")}else{console.warn("[chkCancelManualUpdate]")}console.warn(["[isFirmwareDownloaded, ms elapsed]",b4,((new Date()).getTime()-cq)]);aI();if(!b4){if(Q){bb.close();a8(false,cv)}else{m.close();K(false,cv)}console.warn('FW Update: 7 min Timer expired or JCGI did not respond "OK" - Update cancelled')}}function bV(cv){var cw=null;RAINIER.jnap.send({action:"/jnap/firmwareupdate/GetFirmwareUpdateStatus",data:{},cb:function(cx){if(cx&&cx.result){if(cx.result==="OK"){b.firmwareStatus=cx.output||{}}else{cw=cx.result}}else{cw="_ErrorNotReady"}if(typeof cv==="function"){cv(cw)}},disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true,timeoutMs:10000})}function a1(){if(!ax){console.warn(["router rebooting - ms elapsed:",((new Date()).getTime()-cq)]);ax=true;aC(100);setTimeout(function(){m.close();if(RAINIER.network.isBehindNode()){RAINIER.connect.routerRebootDialog.show()}else{RAINIER.connect.handleSideEffects(["DeviceRestart"])}},250)}b.firmwareStatus="_Rebooting"}function V(cw,cv){cw=cw.toFixed(2);if(cv==="Rebooting"){a1()}else{if(cv==="Installing"){$("#fw-installing").css("display","inline");$("#fw-downloading").css("display","none")}aC(cw*1.5)}}function y(cv){console.warn(["[chkFwUpdateStatus - ms elapsed]",((new Date()).getTime()-cq)]);bV(function(cy){var cw=b.firmwareStatus.lastOperationFailure,cx=b.firmwareStatus.pendingOperation;if(ak&&cw){console.warn("cache.firmwareStatus.lastOperationFailure is present: "+cw);m.close();K(false);return}else{if((ak&&cx&&cx.operation==="Rebooting")||cy==="_AjaxError"||cy==="_ErrorNotReady"||cy==="_ErrorUnknownSession"){a1()}}if(typeof cv==="function"){cv()}})}function k(cv){setTimeout(function(){RAINIER.network.handleFirmwareUpdate(function(cw){K(cw,null,true)})},cv)}function bH(){RAINIER.network.checkInternetConnection(function(cv){if(!cv){setTimeout(bH,4000)}else{k(aR)}},true)}function bE(){console.warn(["updateFwDlStatus",b.firmwareStatus]);console.warn(JSON.stringify(b.firmwareStatus));if(ax&&b.firmwareStatus!=="_Rebooting"){console.warn("[Fw update complete]");ax=false;if(RAINIER.connect.isOrWasWanConnected()){bH()}else{k(aR)}return}else{if(b.firmwareStatus.pendingOperation){var cv=b.firmwareStatus.pendingOperation;if(cv.operation==="Downloading"){ab=cv.progressPercent/2}else{if(cv.operation==="Installing"){$("#fw-installing").css("display","inline");$("#fw-downloading").css("display","none");ab=50+(cv.progressPercent/2)}else{if(cv.operation==="Rebooting"){ab=100}}}aC(ab)}else{console.warn("[no pendingOperation]")}}bL=setTimeout(function(){y(bE)},aR)}function K(cw,cv,cx){console.warn("checkFwUpdate",cw,cv,cx);aI();RAINIER.event.disconnect("dialog.routerRebootClosed",bR);aC(0);if(RAINIER.network.isBehindNode()){if(RAINIER.connect.routerRebootDialog.isShowing()){RAINIER.connect.routerRebootDialog.close()}RAINIER.ui.showMasterWaiting()}if(cw){if(Q){Q=false;b5.show()}else{setTimeout(aj,10000)}}else{if(cx&&bg<s){bg++;k(bN)}else{if(cv&&cv.indexOf("ErrorSignatureCheckFailed")>-1){M({msg:ck.find("#invalidFwFile").html(),cancel:RAINIER.ui.button.strings.close,hideSubmit:true})}else{if(cv&&cv.indexOf("ErrorCannotInstallRetailImage")>-1){M({msg:ck.find("#invalidRetailFwFile").html(),cancel:RAINIER.ui.button.strings.close,hideSubmit:true})}else{if(!cv||cv!=="ConnectivityFailure"){RAINIER.ui.dialogError({result:RAINIER.ui.validation.strings.errors.FirmwareUpdateFailed,action:cv})}else{RAINIER.ui.hideMasterWaiting()}}}RAINIER.event.fire("router.interruptionCompleted")}}}function a8(cw,cv){console.warn("checkPmFwUpdate",cw,cv);aI();RAINIER.ui.showWaiting();bb.close();aC(0);if(cw){if(RAINIER.connect.isOrWasWanConnected()){bH()}else{Q=false;setTimeout(function(){b5.show()},10000)}}else{Q=false;aQ=RAINIER.ui.dialog("#pmFirmwareUpgradeError",{onSubmit:function(){if(aQ&&aQ.isShowing()){aQ.close()}RAINIER.event.fire("router.interruptionCompleted");RAINIER.event.fire("connection.enableCheck")}});setTimeout(function(){aQ.show()},1000)}}function aj(){W();bU.show()}function G(){RAINIER.ui.tooltip.add(bc.find("#pm-firmware-manual .shield"),"top");RAINIER.ui.tooltip.add(bc.find("#pm-filename"),"top")}function bP(){var cv=ck.find("#pm-firmware-file").val();if(cv.match(q)){$("#pm-firmware-version").val(cv.replace(/^.*[\\\/]/,""));cl.onManualPmFirmwareUpdate()}else{if(cv!==""){h=RAINIER.ui.dialog("#invalidPmFwFile",{onSubmit:function(){h.close()}});h.show()}}}function aE(){bc.find("#pm-firmware-update").show();if(!b.DSLSettings.isPowerModemEnabled){bc.find("#pm-firmware-manual .shield").show()}else{bc.find("#pm-firmware-manual .shield").hide()}G();bP();$(".generic-error-technical-support").unbind("click");$(".generic-error-technical-support").click(function(){window.open("http://support.linksys.com/en-us/support")})}function i(){var cw=RAINIER.binder.fromDom(bc,b6),cv=null;$.extend(true,br,cw);br.firmware=$.extend(true,{},b.firmware);if(RAINIER.network.isBehindNode()){br.firmware.updatePolicy=ck.find("#auto-update-nodes").is(":checked")?"AutomaticallyCheckAndInstall":"Manual"}else{br.firmware.updatePolicy=ck.find("#auto-update").is(":checked")?"AutomaticallyCheckAndInstall":"Manual"}br.wireless=$.extend(true,{},b.wireless);br.wireless.radios=[];$.each(b.wireless.radios,function(cy,cx){cv=$.extend(true,{},cx,RAINIER.binder.fromDom(bc.find("#"+RAINIER.ui.escapeId(cx.radioID)),b6));cv=aZ(cv);br.wireless.radios.push(cv)});$.delAttr(br.wireless,"supportedBandSteeringModes");br.currentAdminpass=ck.find("#current-router-password").val();if(az.passwordHint){br.adminpass=bc.find("#router-password-hint input:visible").val()}else{br.adminpass=ck.find("#router-password").val()}console.warn(["basicFromDom (store.wireless, cache.wireless)",br.wireless,b.wireless])}function T(){var cv=false;i();var cw=$.extend(true,{},b.wireless);$.delAttr(cw,"supportedBandSteeringModes");if(az.powerTable){}if(!$.compare(br.wireless,cw)||!$.compare(br.firmware,b.firmware)||!$.compare(br.time,b.time)||br.portlights!==b.portlights||(az.powerTable&&!$.compare(br.powerTable.country,b.powerTable.country))||bc.find("#update-password").is(":visible")){cv=true}return cv}function au(){br.trans=RAINIER.jnap.Transaction({onComplete:cl.onSaveComplete});if(br.adminpass&&(br.currentAdminpass||az.passwordHint)){var cv=L();RAINIER.ui.showWaiting();$.when(cv).then(function(){if(br.isPasswordCurrent||az.passwordHint){var cy=RAINIER.jnapActions.setAdminPassword(),cx={adminPassword:br.adminpass};if(az.passwordHint){cx.passwordHint=br.passwordHint.passwordHint}M({msg:ck.find("#password-warning-dialog").html(),onSubmit:function(){br.trans.add({action:cy,data:cx,cb:function(cz){if(cz.result==="OK"){if(!RAINIER.network.uiLoadedFromCloud()){$.cookie("admin-auth","Basic "+window.btoa("admin:"+br.adminpass),{expires:null,path:"/"});if(RAINIER.network.isBehindNode()){JNAP.setAuth($.cookie("admin-auth"))}}$.extend(true,b.passwordHint,br.passwordHint);bO();bA()}else{aA.doSave=false}}});bl()},onCancel:function(){bA();if(T()){bt(aA.doClose)}else{if(aA.doTabChange){aA.destinationTab.click()}}}})}else{var cw=RAINIER.ui.build;RAINIER.ui.wait(false);RAINIER.ui.inputBalloon.add({els:$("#current-router-password"),balloonContent:cw.DIV({"class":"flow"},[cw.SPAN({"class":"icon warning"}),cw.SPAN({"class":"msg"},RAINIER.ui.validation.strings.mustMatchCurrentPassword)])},true);return false}})}else{bl()}}function Z(cv){if(cv.result==="OK"){$.each(br.wireless.radios,function(cx,cw){$.each(b.wireless.radios,function(cy,cz){if(cw.radioID===cz.radioID){cz=$.extend(true,cz,cw)}})});ah();RAINIER.event.fire("wireless.updated",b.wireless)}else{aA.doSave=false}}function bl(){var cv=false,cw=false,cx=RAINIER.ui.dialog("#powerTableRestartWarning",{onSubmit:cy});function cy(){RAINIER.ui.showWaiting();br.trans.send()}if(br.firmware.updatePolicy!==b.firmware.updatePolicy){br.trans.add({action:"/jnap/firmwareupdate/SetFirmwareUpdateSettings",data:br.firmware,cb:function(cz){if(cz.result==="OK"){$.extend(true,b.firmware,br.firmware)}else{aA.doSave=false}}})}else{}if(!$.compare(b.time,br.time)){br.trans.add({action:"/jnap/locale/SetTimeSettings",data:br.time,cb:function(cz){if(cz.result==="OK"){$.extend(true,b.time,br.time)}else{aA.doSave=false}}})}else{}if(br.portlights!==b.portlights){br.trans.add({action:"/jnap/routerleds/SetRouterLEDSettings",data:{isSwitchportLEDEnabled:br.portlights},cb:function(cz){if(cz.result==="OK"){b.portlights=br.portlights}else{aA.doSave=false}}})}else{}if(az.powerTable&&!$.compare(b.powerTable.country,br.powerTable.country)){if(!b.wireless.isBandSteeringEnabled){cv=b.wireless.radios.some(function(cz){return cz.settings.channel!==0||cz.settings.channelWidth!=="Auto"})}if(RAINIER.network.isBehindNode()){cw=true}br.trans.add({action:"/jnap/powertable/SetPowerTableSettings",data:{country:br.powerTable.country},cb:function(cz){if(cz.result==="OK"){$.extend(true,b.powerTable,br.powerTable)}else{aA.doSave=false}}})}else{}if(cv){RAINIER.ui.dialog("#powerTableConfirm",{onSubmit:function(){if(cw){cx.show()}else{cy()}}}).show()}else{if(cw){cx.show()}else{if(RAINIER.applets.wireless.radiosHaveChanges(br.wireless,b.wireless)){RAINIER.applets.wireless.commitSettings(br.trans,br.wireless,b.wireless,b6,cy,Z)}else{console.warn("[Basic: No change in radios]");cy()}}}}function bG(){RAINIER.applets.dhcpReservations.openDHCPReservations()}function cj(){if(ae.find('input[type="checkbox"]').is(":checked")){if(bX()){if(ao()){var cv=RAINIER.ui.dialog($("#promptsavedhcpreservation"),{onSubmit:function(){var cw="/jnap/router/SetLANSettings";RAINIER.ui.showWaiting();RAINIER.applets.dhcpReservations.stripDefaultIPValues(br);RAINIER.applets.dhcpReservations.scrubInvalidDHCPReservations(br.lanSettings.dhcpSettings.reservations);RAINIER.jnap.send({action:cw,data:br.lanSettings,cb:function(cx){if(cx.result==="OK"){$.extend(true,b.lanSettings,br.lanSettings);$.extend(true,b.lanSettingsSetup,b.lanSettings);aX();bK();bG()}else{if(cx.result!=="_AjaxError"){if(RAINIER.ui.validation.strings.errors[cx.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[cx.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(cx,cw)}}}}})}});cv.show()}else{bG()}}}}function cm(cv){cv.add({action:"/jnap/router/GetLANSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.lanSettings=cw.output||{};b.lanSettingsSetup=$.extend(true,{},b.lanSettings);$.delAttr(b.lanSettings,["minNetworkPrefixLength","maxNetworkPrefixLength","maxDHCPReservationDescriptionLength","minAllowedDHCPLeaseMinutes","maxAllowedDHCPLeaseMinutes"])}else{}}});if(RAINIER.network.isOpenVPNSupported()){cv.add({action:"/jnap/openvpn/GetOpenVPNSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.openVpn=$.extend(true,{},cw.output||{});if(!cw.output){}}else{}}})}if(RAINIER.shared.util.areServicesSupported(["/jnap/linkaggregation/LinkAggregation"])){cv.add({action:"/jnap/linkaggregation/GetLinkAggregationSettings",data:{},cb:function(cx){var cw=ae.find("#link-aggregation-ports");if(cx.result==="OK"){b.linkAggregation=$.extend(true,{},cx.output||{});cw.text(cw.text().replace("{firstPortNumber}",b.linkAggregation.aggregatedPorts[0]+1).replace("{secondPortNumber}",b.linkAggregation.aggregatedPorts[1]+1));$.delAttr(b.linkAggregation,"aggregatedPorts");if(!cx.output){}}else{}}});ae.find("#link-aggregation-form").css("display","block")}if(RAINIER.network.isIPTVPresent()){cv.add({action:"/jnap/iptv/GetIPTVSettings",data:{},cb:function(cw){if(cw.result==="OK"){bx=cw.output.isEnabled}}})}}function aP(){var cv=RAINIER.util.dot2num(F),cx=RAINIER.util.dot2num(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]')),cw=cx+parseInt(bk.val(),10)-1;return cv>=cx&&cv<=cw}function bZ(){var cv=RAINIER.util.dot2num(b.lanSettings.ipAddress),cx=RAINIER.util.dot2num(b.lanSettingsSetup.dhcpSettings.firstClientIPAddress),cw=RAINIER.util.dot2num(b.lanSettingsSetup.dhcpSettings.lastClientIPAddress);if(cv<cx||cv>cw){return cw-cx+1}else{return cw-cx}}function a6(cy,cB){var cA=RAINIER.util.fromSubnetToPrefixLength(cy),cx=Math.pow(2,32-cA),cw=RAINIER.util.dot2num(cy),cB=RAINIER.util.dot2num(cB),cv=cB.toString(2),cz=parseInt(cw.toString(2).substring(0,cA)+cv.substring(cv.length-(32-cA),cv.length),2)-cw;if(aP()){cx--}return cx-cz-1}function bD(){b.lanSettingsSetup.dhcpSettings.maxClients=bZ();b.lanSettingsSetup.dhcpSettings.maxUsers=a6(b.lanSettingsSetup.subnetMask,b.lanSettingsSetup.dhcpSettings.firstClientIPAddress)}function aX(){b.lanSettingsSetup.ipAddress=b.lanSettings.ipAddress;b.lanSettingsSetup.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(b.lanSettings.networkPrefixLength);var cx=ae.find('div.ip-input[name="lanSettingsSetup.subnetMask"]').children(":not(span)"),cw=ae.find('div.ip-input.edit[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]').children(":not(span)");for(var cv=0;cv<b.lanSettingsSetup.minNetworkPrefixLength/8;cv++){if($(cx[cv]).is("input")){$(cx[cv]).replaceWith('<label style="padding-right:5px;"></label>')}if($(cw[cv]).is("input")){$(cw[cv]).replaceWith("<label/>")}}am();if(b.lanSettings.isDHCPEnabled){bD()}RAINIER.binder.toDom(b,ae,b6);d();RAINIER.applets.connectivity.bridge.redirectUrlToDom({hostName:b.lanSettings.hostName,domain:"local"});RAINIER.applets.dhcpReservations.init()}function bQ(){RAINIER.applets.connectivity.initializeDefaultMacAddressInputValues(ae);RAINIER.applets.connectivity.initializeGeneralInputValues(ae)}function bK(){var cv=ck.find("#local-network-fieldset");cv.removeClass("edit");ae.find("#edit-local-network > a").removeClass("disabled");ae.find("#edit-local-network > a").removeProp("disabled");ae.find("#edit-local-network").show();RAINIER.binder.toDom(b,cv,b6)}function d(){var cy=ae.find("#dhcp-form"),cz=ae.find("#dhcp-enabled").is(":checked");if(!cz){var cw={lanSettingsSetup:null,lanSettings:null};cw.lanSettingsSetup=$.extend(true,{},b.lanSettingsSetup);cw.lanSettings=$.extend(true,{},b.lanSettings);cw.lanSettings.isDHCPEnabled=false;RAINIER.binder.toDom(cw,cy,b6);RAINIER.ui.validation.removeInvalidMarks(cy)}else{if(ae.find('[name="lanSettingsSetup.dhcpSettings.maxClients"]').val()===""){var cx=50,cv=a6(b.lanSettingsSetup.subnetMask,b.lanSettingsSetup.dhcpSettings.firstClientIPAddress);if(cv<cx){cx=cv}b.lanSettings.dhcpSettings={leaseMinutes:1440};b.lanSettingsSetup.dhcpSettings.maxClients=cx;b.lanSettingsSetup.dhcpSettings.maxUsers=cv;RAINIER.binder.toDom(b,ae,{});ae.find("#dhcp-enabled").attr("checked","checked")}}cy.find('input:not(input[type="checkbox"])').prop("disabled",!cz);ae.find("#dhcp-reservation > button").prop("disabled",!cz)}function a5(){RAINIER.ui.editFormClick(ck.find("#local-network-fieldset"),ck.find("#edit-local-network > a"),null,true);function cw(){if(bp.localNetwork.routerIPAddress.isValid()&&bp.localNetwork.startIpAddress.isValid()){var cC=RAINIER.binder.fromDom(ae,b6);$.extend(true,b.lanSettingsSetup,cC.lanSettingsSetup);b.lanSettingsSetup.dhcpSettings.maxUsers=a6(cC.lanSettingsSetup.subnetMask,cC.lanSettingsSetup.dhcpSettings.firstClientIPAddress);RAINIER.binder.toDom(b,ae.find('span[name="lanSettingsSetup.dhcpSettings.maxUsers"]').parent(),b6);if(bp.localNetwork.maxUsers.isValid()){var cA=ae.find('div.edit[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),cx=RAINIER.util.dot2num(b.lanSettings.ipAddress);b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=RAINIER.util.getObjVal(RAINIER.binder.fromDom(cA.parent()),cA.attr("name"));var cz=RAINIER.util.dot2num(b.lanSettingsSetup.dhcpSettings.firstClientIPAddress),cy=cz+parseInt(bk.val(),10)-1;b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=RAINIER.util.num2dot(cy);if(cx>=cz&&cx<=cy){b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=RAINIER.util.num2dot(cy+1)}b.lanSettingsSetup.dhcpSettings.maxClients=bk.val()}var cB={lanSettingsSetup:b.lanSettingsSetup};RAINIER.binder.toDom(cB,ae,b6)}}function cv(){if(bp.localNetwork.routerIPAddress.isValid()){var cA=RAINIER.binder.fromDom(ae,b6),cx=b.lanSettingsSetup.minNetworkPrefixLength/8,cy=cA.lanSettings.ipAddress.split(".");$.extend(true,b.lanSettingsSetup,cA.lanSettingsSetup);if(cx===1){b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress.replace(o,cy[0]+".$2.$3.$4");b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress.replace(o,cy[0]+".$2.$3.$4")}else{if(cx===2){b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress.replace(o,cy[0]+"."+cy[1]+".$3.$4");b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress.replace(o,cy[0]+"."+cy[1]+".$3.$4")}else{b.lanSettingsSetup.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress.replace(o,cy[0]+"."+cy[1]+"."+cy[2]+".$4");b.lanSettingsSetup.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress.replace(o,cy[0]+"."+cy[1]+"."+cy[2]+".$4")}}var cz={lanSettingsSetup:b.lanSettingsSetup};RAINIER.binder.toDom(cz,ae,b6)}}ae.find('div[name="lanSettings.ipAddress"]').change(function(){cv();cw()});ae.find('div.edit[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"] > input:text, input[name="lanSettingsSetup.dhcpSettings.maxClients"], div[name="lanSettingsSetup.subnetMask"]').change(function(){cw()});ae.find("#dhcp-reservation > button").click(function(){cj()});ae.find("#dhcp-enabled").click(function(){d()});ae.find("#enable-link-aggregation").trigger("change")}function g(){function cz(cL){return(cL>0)&&(cL<=parseInt($('[name="lanSettingsSetup.dhcpSettings.maxUsers"]').text(),10))}function cE(){var cO=RAINIER.util.dot2num(F),cM=RAINIER.util.dot2num(cJ),cQ=(cO&cM)>>>0,cN=(~cM|cQ)>>>0,cP=RAINIER.util.num2dot(cQ+1),cL=RAINIER.util.num2dot(cN-1);return RAINIER.ui.validation.strings.invalidIPAddressSubnet+" ["+cP+"-"+cL+"]"}function cD(){var cL=RAINIER.util.dot2num(F),cM=RAINIER.util.dot2num(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'));return cL===cM}function cI(){var cM=RAINIER.util.dot2num(F),cL=RAINIER.util.dot2num(b.openVpn.clientIPStartAddress),cN=cL+b.openVpn.maxConcurrentConnections-1;return cM>=cL&&cM<=cN}function cB(){var cN=RAINIER.util.dot2num(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]')),cL=RAINIER.util.dot2num(b.openVpn.clientIPStartAddress),cM=cL+b.openVpn.maxConcurrentConnections-1;return cN>=cL&&cN<=cM}var cw={minLen:1,maxLen:15,validationType:"hostName",whiteSpace:false,isRequired:true},cv={validCharSet:"numeric",minLen:1,maxLen:Math.pow(2,32-b.lanSettingsSetup.minNetworkPrefixLength).toString().length,whiteSpace:false,isRequired:true,isBlankOnBlur:false},cH={validCharSet:"numeric",minLen:1,maxLen:b.lanSettingsSetup.maxAllowedDHCPLeaseMinutes.toString().length,minVal:b.lanSettingsSetup.minAllowedDHCPLeaseMinutes,maxVal:b.lanSettingsSetup.maxAllowedDHCPLeaseMinutes,whiteSpace:false,isRequired:true},cG={maxLen:3,validationType:"ipAddress",validCharSet:"numeric",isComposite:true,isBlankOnBlur:false},cC={validCharSet:"numeric",maxLen:3,validationType:"routerIPAddress",isComposite:true,isBlankOkOnBlur:false},cA={validationType:"subnetMask",maxLen:3,isComposite:true,isBlankOkOnBlur:false},cx={},cJ=ae.find('div.ip-input[name="lanSettingsSetup.subnetMask"]');var cK=$.extend(true,{},cC,{elContainer:F,elInputSubnetMask:cJ}),cy=$.extend(true,{},{validCharSet:"numeric",isComposite:true,isBlankOnBlur:false},{elContainer:ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),elInputSubnetMask:cJ,elInputRouterIPAddress:F,errors:[{test:RAINIER.ui.validation.tests.isIPAddress.curry(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),false),when:false,message:RAINIER.ui.validation.strings.invalidIPAddress},{test:RAINIER.ui.validation.tests.isHostValidForGivenRouterIPAddressAndSubnetMask.curry(ae.find('div.edit:[name="lanSettingsSetup.dhcpSettings.firstClientIPAddress"]'),F,cJ),when:false,message:function(){return cE()}},{test:cD,when:true,message:RAINIER.ui.validation.strings.invalidIPAddress}]});if(b.openVpn.isOpenVPNEnabled){cK.errors=[{test:cI,when:true,message:RAINIER.ui.validation.strings.invalidIPAddress}];cy.errors.push({test:cB,when:true,message:RAINIER.ui.validation.strings.invalidIPAddress})}cx.routerIPAddress=aa(cK);cx.startIpAddress=aa(cy);cx.hostName=aa($.extend(true,{},cw,{els:ae.find('input:[name="lanSettings.hostName"]')}));cx.subnetMask=aa($.extend(true,{},cA,{elContainer:ae.find('div.ip-input:[name="lanSettingsSetup.subnetMask"]'),minNetworkPrefixLength:b.lanSettingsSetup.minNetworkPrefixLength,maxNetworkPrefixLength:b.lanSettingsSetup.maxNetworkPrefixLength}));cx.maxUsers=aa($.extend(true,{},cv,{els:ae.find('input:[name="lanSettingsSetup.dhcpSettings.maxClients"]'),errors:[{test:cz,when:false,message:RAINIER.ui.validation.strings.connectivity.invalidNumberOfUsers}]}));cx.clientLeaseTime=aa($.extend(true,{},cH,{els:ae.find('input:[name="lanSettings.dhcpSettings.leaseMinutes"]')}));function cF(cL,cM){return aa($.extend(true,{},cG,{elContainer:ae.find(cL),allowZeroes:!!cM.allowZeroes}))}cx.dnsServer1=cF('div:[name="lanSettings.dhcpSettings.dnsServer1"]',{allowZeroes:true});cx.dnsServer2=cF('div:[name="lanSettings.dhcpSettings.dnsServer2"]',{allowZeroes:true});cx.dnsServer3=cF('div:[name="lanSettings.dhcpSettings.dnsServer3"]',{allowZeroes:true});cx.winsServer=cF('div:[name="lanSettings.dhcpSettings.winsServer"]',{allowZeroes:true});ae.find('input[name="lanSettingsSetup.dhcpSettings.maxClients"]').focus(function(){bp.localNetwork.maxUsers.isValid(true)});bp.localNetwork=cx}function bX(){var cv=true;cv=bp.localNetwork.hostName.isValid(true)&&bp.localNetwork.routerIPAddress.isValid(true)&&bp.localNetwork.subnetMask.isValid(true);if(cv&&ae.find('input[type="checkbox"]').is(":checked")){cv=bp.localNetwork.startIpAddress.isValid(true)&&bp.localNetwork.maxUsers.isValid(true)&&bp.localNetwork.clientLeaseTime.isValid(true)&&bp.localNetwork.dnsServer1.isValid(true)&&bp.localNetwork.dnsServer2.isValid(true)&&bp.localNetwork.dnsServer3.isValid(true)&&bp.localNetwork.winsServer.isValid(true)}return cv}function bM(){aX();a5();g()}function l(){var cv=RAINIER.binder.fromDom(ae,b6);$.extend(true,br,cv);br.lanSettings.dhcpSettings.firstClientIPAddress=b.lanSettingsSetup.dhcpSettings.firstClientIPAddress;br.lanSettings.dhcpSettings.lastClientIPAddress=b.lanSettingsSetup.dhcpSettings.lastClientIPAddress;if(br.lanSettings.ipAddress!==b.lanSettings.ipAddress){br.lanSettings.dhcpSettings.reservations=[]}else{br.lanSettings.dhcpSettings.reservations=RAINIER.applets.dhcpReservations.dhcpReservationsFromDom()}if(RAINIER.applets.dhcpReservations.isDHCPEnabled()){b.lanSettings.dhcpSettings.reservations=br.lanSettings.dhcpSettings.reservations}br.lanSettings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(br.lanSettingsSetup.subnetMask)}function ao(){var cv=false;l();if(!$.compare(br.lanSettings,b.lanSettings)||(br.lanSettings.isDHCPEnabled&&!bp.localNetwork.maxUsers.isValid(true))||(br.lanSettings.isDHCPEnabled&&!bp.localNetwork.startIpAddress.isValid(true))||(RAINIER.shared.util.areServicesSupported(["/jnap/linkaggregation/LinkAggregation"])&&!$.compare(br.linkAggregation,b.linkAggregation))){cv=true}return cv}function am(){["dnsServer1","dnsServer2","dnsServer3","winsServer"].forEach(function(cv){if(!b.lanSettings.dhcpSettings[cv]){b.lanSettings.dhcpSettings[cv]="0.0.0.0"}})}function a3(cv){var cy="/jnap/router/SetLANSettings",cw=RAINIER.jnap.Transaction();function cx(cz){var cB=[{err:"ErrorInvalidPrimaryDNSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.dnsServer1},{err:"ErrorInvalidSecondaryDNSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.dnsServer2},{err:"ErrorInvalidTertiaryDNSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.dnsServer3},{err:"ErrorInvalidWINSServer",msg:RAINIER.ui.validation.strings.invalidIPAddress,els:bp.localNetwork.winsServer}];for(var cA=0;cA<cB.length;cA++){if(cz===cB[cA].err){return cB[cA]}}}if(bx&&br.lanSettings.ipAddress!=="192.168.10.1"&&!cv){RAINIER.ui.dialog($("#iptv-warning-dialog"),{onSubmit:function(){a3(true)}}).show();return}RAINIER.ui.showWaiting();RAINIER.applets.dhcpReservations.stripDefaultIPValues(br);if(RAINIER.shared.util.areServicesSupported(["/jnap/linkaggregation/LinkAggregation"])){cw.add({action:"/jnap/linkaggregation/SetLinkAggregationSettings",data:br.linkAggregation,cb:function(cz){if(cz.result==="OK"){b.linkAggregation=$.extend(true,{},br.linkAggregation);$.delAttr(b.linkAggregation,"aggregatedPorts");console.warn(["Updated cache.linkAggregation:",b.linkAggregation])}else{}}})}cw.add({action:cy,data:br.lanSettings,cb:function(cA){if(cA.result==="OK"){b.lanSettings.dhcpSettings=$.extend(true,{},br.lanSettings.dhcpSettings);$.extend(true,b.lanSettings,br.lanSettings);$.extend(true,b.lanSettingsSetup,b.lanSettings);aX();bK();cl.onSaveComplete()}else{if(cA.result!=="_AjaxError"){var cz=cx(cA.result);if(cz){RAINIER.ui.wait(false);RAINIER.ui.inputBalloon.message({els:cz.els.elContainer,message:cz.msg,hasErrors:true})}else{if(RAINIER.ui.validation.strings.errors[cA.result]){RAINIER.ui.alert("",RAINIER.ui.validation.strings.errors[cA.result])}else{RAINIER.ajax().executeDefaultJnapErrorHandler(cA,cy)}}}}},disableDefaultJnapErrHandler:true});cw.send()}function a4(cv){cv.add({action:RAINIER.jnapActions.getRoutingSettings(),data:{},cb:function(cw){if(cw.result==="OK"){b.routing=$.extend(true,{},cw.output||{});br.maxStaticRouteEntries=b.routing.maxStaticRouteEntries;br.routing.isDynamicRoutingEnabled=b.routing.isDynamicRoutingEnabled;$.delAttr(b.routing,"maxStaticRouteEntries");br.routing=$.extend(true,{},b.routing);if(!cw.output){}}else{}}})}function aq(cw,cv){var cx=RAINIER.ui.template.createBlock(P,cw);if(cv){cx.addClass("edit")}RAINIER.binder.toDom(cw,cx);if(cw.settings["interface"]==="LAN"){cx.find("#interface-lan").show()}else{cx.find("#interface-internet").show()}av(cx);RAINIER.util.trapEnter(cx);cx.find("td").hover(function(){var cy=$(this).parent();if(!cy.hasClass("edit")){cy.addClass("hover")}},function(){$(this).parent().removeClass("hover")});cx.find("#edit-route").click(cl.onEditRoute.bind(cx));cx.find("#cancel").click(cl.onCancelRoute.bind(cx));cx.find("#delete-route").click(cl.onDelRoute.bind(cx));cx.find("#save-route").click(cl.onUpdRoute.bind(cx));if($.compare(cw,aL)){ba.find("tr:first-child").after(cx)}else{ba.append(cx)}RAINIER.util.trapEnter(cx.find("input[type=text]"))}function ap(){RAINIER.ui.clearTbl(ba);RAINIER.binder.toDom(b,a7);br.routingList.length=0;$.each(b.routing.entries,function(){if(this.settings.networkPrefixLength){this.settings.subnetMask=RAINIER.util.fromPrefixLengthToSubnet(this.settings.networkPrefixLength);delete this.settings.networkPrefixLength}br.routingList.push(this);aq(this)})}function ag(){ck.find("#add-route").click(function(){var cv=$.extend({},aL);br.routingList.unshift(cv);aq(cv,true)})}function aN(){var cv=ck.find("#advanced-routing .edit");for(var cw=0;cw<cv.length;cw++){var cx=$(cv[cw]);if(!aK(cx)){return false}else{cx.find("#save-route").click()}}return true}function av(cz){var cx={minLen:1,maxLen:25,validCharSet:"ascii",whiteSpace:false,isRequired:true},cy={maxLen:3,validationType:"ipAddress",validCharSet:"numeric",isComposite:true,isBlankOnBlur:false},cv={maxLen:3,validationType:"subnetMask",isRequired:true,isComposite:true},cw={};cw.name=aa($.extend(true,{},cx,{els:cz.find('input:[name="name"]')}));cw.destinationLAN=aa($.extend(true,{},cy,{elContainer:cz.find('div:[name="settings.destinationLAN"]'),allowZeroes:false}));cw.subnetMask=aa($.extend(true,{},cv,{elContainer:cz.find('div:[name="settings.subnetMask"]'),minNetworkPrefixLength:b.lanSettingsSetup.minNetworkPrefixLength,maxNetworkPrefixLength:b.lanSettingsSetup.maxNetworkPrefixLength}));cw.gateway=aa($.extend(true,{},cy,{elContainer:cz.find('.spEdit > div[name="settings.gateway"]'),allowZeroes:true,errors:[{test:RAINIER.applets.connectivity.isStaticRouteGatewayValid.curry(cz.find('.spEdit > select:[name="settings.interface"]'),cz.find('.spEdit > div:[name="settings.gateway"]'),b.lanSettings.ipAddress,b.lanSettingsSetup.subnetMask),when:false,message:RAINIER.ui.validation.strings.errors.ErrorInvalidGateway}]}));cz.data(cw)}function aK(cw){var cv=cw.data();return cv.name.isValid(true)&&cv.destinationLAN.isValid(true)&&cv.subnetMask.isValid(true)&&cv.gateway.isValid(true)}function b7(cv){var cw=false;if(cv.name===""&&((cv.settings.destinationLAN==="0.0.0.0"&&cv.settings.gateway==="0.0.0.0"&&cv.settings.subnetMask==="0.0.0.0")||(cv.settings.destinationLAN===""&&cv.settings.gateway===""&&cv.settings.subnetMask===""))){cw=true}return cw}function f(){ap();ag()}function bs(){var cv=RAINIER.binder.fromDom(a7,b6);cv.routing.isNATEnabled=!cv.routing.isDynamicRoutingEnabled;$.extend(true,br,cv);br.routing.entries=br.routingList.filter(function(cw){return(!$.compare(cw,aL)&&!$.compare(cw,u))});console.warn(["advancedroutingFromDom",br,b])}function bi(){var cv=false;if(aN()){bs()}if(a7.find("#save-route:visible").length>0||!$.compare(b.routing,br.routing)){cv=true}return cv}function af(){var cv=$.extend(true,{},br.routing);cv.entries.forEach(function(cw){cw.settings.networkPrefixLength=RAINIER.util.fromSubnetToPrefixLength(cw.settings.subnetMask);delete cw.settings.subnetMask});return cv}function bI(){if(!$.compare(b.routing,br.routing)){RAINIER.ui.showWaiting();var cv=af();RAINIER.jnap.send({action:RAINIER.jnapActions.setRoutingSettings(),data:cv,cb:function(cw){if(cw.result==="OK"){$.extend(b.routing,br.routing);b.routing.entries=br.routing.entries.clone()}else{aA.doSave=false}cl.onSaveComplete()}})}return true}function bn(){var cv=RAINIER.jnap.Transaction({onComplete:cl.onSaveComplete});cv.add({action:RAINIER.jnapActions.setVLANTaggingSettings(),data:br.vlanSettings,cb:function(cw){if(cw.result==="OK"){b.vlanSettings=$.extend(true,{},br.vlanSettings);bF()}else{aA.doSave=false}}});RAINIER.ui.showWaiting();cv.send()}function a9(cv){cv.add({action:RAINIER.jnapActions.getVLANTaggingSettings(),data:{},cb:function(cw){if(cw.result==="OK"){b.vlanSettings=cw.output;b.vlanSettingsSetup=$.extend(true,{},b.vlanSettings);$.delAttr(b.vlanSettings,["maxVLANTaggingRulesPerPort","isVLANPrioritySupported","vlanPortNumbers"])}else{}}});cv.add({action:"/jnap/vlantagging/GetProfiles",data:{},cb:function(cw){if(cw.result==="OK"){aw=cw.output.profiles}else{}}})}function z(){var cv=b.vlanSettingsSetup.vlanPortNumbers;if(cv){ar.find(".vlanPort1").removeClass("port3").addClass("port"+cv[0]);ar.find(".vlanPort2").removeClass("port4").addClass("port"+cv[1])}}function cg(){var cv=false;aG();bF();an();RAINIER.util.trapEnter(ar.find("input"));if(RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging2"])||RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging3"])){cv=true;if(RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging3"])){z()}}if(cv&&!b.vlanSettingsSetup.isVLANPrioritySupported){ck.find(".vlan-priority").remove()}}function aT(){if(!ar.find("#enableVlan").is(":checked")){return true}return bp.vlanTagging.vlanWanSettingsRules.isValid(true)&&bp.vlanTagging.vlanLANSettingsRules.isValid(true)}function U(){function cA(cB){return parseInt(cx.val(),10)===parseInt(cB,10)}var cx=ar.find('#vlanWanSettings input[type="text"]:enabled'),cy=ar.find('#ethernetPorts input[type="text"]:enabled'),cz=cy.filter(function(){return parseInt(this.value)!==0&&this.value!==""}),cw={validCharSet:"numeric",whiteSpace:false,minLen:1,maxLen:4,minVal:3,maxVal:4094,isRequired:true},cv={};cv.vlanWanSettingsRules=aa($.extend(true,{},cw,{els:ar.find('#vlanWanSettings input[type="text"]:enabled')}));cv.vlanLANSettingsRules=aa($.extend(true,{},cw,{els:cz,errors:[{test:cA,when:true,message:RAINIER.ui.validation.strings.connectivity.vlanIdDuplicated}]}));bp.vlanTagging=cv;cy.unbind("keyup focus blur").keyup(O).blur(b9)}function D(){bw();var cv=$.compare(br.vlanSettings,b.vlanSettings);return !cv}function cc(cv){if(cv){ar.find(".vlanTaggingSettings").addClass("readOnly");ar.find(".vlanTaggingSettings .toggle-edit label").each(function(){$(this).attr("tooltip",$(this).text())})}else{ar.find(".vlanTaggingSettings").removeClass("readOnly")}}function aG(){var cv={Manual:RAINIER.ui.common.strings.vlanProfiles.Manual,"Unifi (@ Home)":RAINIER.ui.common.strings.vlanProfiles["Unifi-Home"],"Unifi (@ Business)":RAINIER.ui.common.strings.vlanProfiles["Unifi-Business"],"Singtel (mio TV)":RAINIER.ui.common.strings.vlanProfiles["Singtel-MIO"],"Singtel (other)":RAINIER.ui.common.strings.vlanProfiles["Singtel-Other"],"M1 (Fibre)":RAINIER.ui.common.strings.vlanProfiles["M1-Fibre"],"Maxis (Fibre)":RAINIER.ui.common.strings.vlanProfiles["Maxis-Fibre"],"Maxis (Fibre special)":RAINIER.ui.common.strings.vlanProfiles["Maxis-Fibre-Special"],StarHub:RAINIER.ui.common.strings.vlanProfiles["Star-Hub"]},cx='<option value="{profileId}">{profileName}</option>',cw;if(RAINIER.ui.getDirection()==="rtl"){cx='<option value="{profileId}">{profileName}&#x200E;</option>'}b0.empty();b0.append(cx.formatObj({profileId:"Manual",profileName:cv.Manual}));aw.sort(function(cz,cy){return(cz.name>cy.name)?1:((cz.name<cy.name)?-1:0)});$.each(aw,function(){if(cv[this.name]){cw={profileId:this.name,profileName:cv[this.name]};b0.append(cx.formatObj(cw))}})}function al(cx,cv,cw){cx.find('option[value="Tagged"]').text(RAINIER.ui.common.strings.vlanStatus.Tagged);cx.find('option[value="Untagged"]').text(RAINIER.ui.common.strings.vlanStatus.Untagged);cv.text(RAINIER.ui.common.strings.vlanStatus[cw.vlanStatus])}function bF(cw){function cB(cD,cC){$.each(cD,function(cE,cF){at(cC,cF,cE===cD.length-1&&cD.length===b.vlanSettingsSetup.maxVLANTaggingRulesPerPort,false)})}function cv(cC,cD){if(cC.length){cB(cC,cD.find("table"));cD.show()}else{if(cA.vlanSettings.profile.name!=="Manual"){cD.hide()}else{if(cA.vlanSettings.profile.name==="Manual"){cD.find("tbody tr").remove();at(cD.find("table"),{vlanID:0},false,false)}}}}var cA=cw||$.extend(true,{},b);if(!cA.vlanSettings.profile){cA.vlanSettings.profile=$.extend({},bv)}var cz=cA.vlanSettings.profile.vlanTaggingSettings.ipTVSettings,cy=cA.vlanSettings.profile.vlanTaggingSettings.voIPSettings,cx=cA.vlanSettings.profile.vlanTaggingSettings.wanSettings;if(cA.vlanSettings.profile.name==="Manual"){ar.find(".showForManual").show();ar.find(".hideForManual").hide()}else{ar.find(".showForManual").hide();ar.find(".hideForManual").show()}ar.find("#ipTVSettings tbody tr, #voIPSettings tbody tr").remove();RAINIER.binder.toDom(cA,ar,b6);al(ar.find("#vlanWanSettings select.vlanTag"),ar.find('#vlanWanSettings label[name="vlanSettings.profile.vlanTaggingSettings.wanSettings.vlanStatus"]'),cx);if(cA.vlanSettings.profile.name!=="Manual"&&!cz.length&&!cy.length){ar.find("#ethernetPorts").hide()}else{ar.find("#ethernetPorts").show();ar.find("#ipTVSettings").show();ar.find("#voIPSettings").show()}cv(cz,ar.find("#ipTVSettings"));cv(cy,ar.find("#voIPSettings"));cc(cA.vlanSettings.profile.name!=="Manual")}function bw(){var cx=RAINIER.binder.fromDom(ar,b6),cv=ar.find("#ipTVSettings tbody tr"),cw=ar.find("#voIPSettings tbody tr");function cy(cB,cA){var cz=0;$.each(cA,function(cC,cG){var cE=$(cG),cF=cE.find("input").val();if(!cE.hasClass("disabled")&&parseInt(cF)!==0&&cF!==""){var cD=RAINIER.binder.fromDom(cE,b6);cB[cz]=cD;cz++}})}$.extend(true,br,cx);br.vlanSettings.profile.vlanTaggingSettings.ipTVSettings=[];br.vlanSettings.profile.vlanTaggingSettings.voIPSettings=[];if(ar.find("#ipTVSettings").is(":visible")){cy(br.vlanSettings.profile.vlanTaggingSettings.ipTVSettings,cv)}if(ar.find("#voIPSettings").is(":visible")){cy(br.vlanSettings.profile.vlanTaggingSettings.voIPSettings,cw)}if(!br.vlanSettings.isEnabled&&br.vlanSettings.profile.name==="Manual"){if(!bp.vlanTagging.vlanWanSettingsRules.isValid()||!bp.vlanTagging.vlanLANSettingsRules.isValid()){br.vlanSettings=$.extend({},b.vlanSettings);br.vlanSettings.isEnabled=false;if(br.vlanSettings.profile){br.vlanSettings.profile.name="Manual"}}}}function be(cw,cv){cw.find("input, select").attr("disabled",!cv);if(cv){cw.removeClass("disabled")}else{cw.addClass("disabled")}}function at(cy,cz,cC,cw){var cB=ar.find("#vlanRowTemplate tr"),cx=RAINIER.ui.template.createBlock(cB,cz),cv=cx.find("label"),cA=cx.find('select[name="vlanStatus"]');al(cA,cx.find('label[name="vlanStatus"]'),cz);cv.attr("tooltip",cv.text());RAINIER.util.trapEnter(cx.find("input"));if(cw){cx.insertBefore(cy.find("tbody tr:last-child"))}else{cy.append(cx)}if(cy.find("tbody tr").length===b.vlanSettingsSetup.maxVLANTaggingRulesPerPort){be(cx,true)}cx.find("input").keyup(O).trigger("keyup").blur(b9).trigger("blur");cx.find('select[name="vlanPriority"]').change(b9)}function b9(){function cw(cy){var cx=$(cy[0]),cz=cx.parents("tr").find('select[name="vlanPriority"]');$.each(cy,function(){var cA=$(this),cB=cA.parents("tr").find('select[name="vlanPriority"]');if(cA.attr("disabled")!=="disabled"){cB.attr("disabled",false)}if(parseInt(cA.val())===parseInt(cx.val())){cB.val(cz.val()).attr("disabled",true)}});cz.attr("disabled",false)}var cv=ar.find("#ethernetPorts input:not(:disabled)");$.each(cv,function(){var cx=$(this),cz=parseInt(cx.val()),cy=$("#ethernetPorts input").filter(function(){return parseInt(this.value)===cz});if(cz>2&&cz<4095){cx.parents("tr").find('select[name="vlanPriority"]').attr("disabled",false);if(cy.length>1){cw(cy)}}})}function O(cx){var cv=$(cx.target),cw=cv.parents("tr").find("select");cw.attr("disabled",parseInt(cv.val())===0);U();RAINIER.ui.inputBalloon.hide();RAINIER.ui.inputBalloon.reset()}function an(){ar.find("#enableVlan").change(cl.onEnableVlanChange);b0.change(cl.onVlanProfilesChange);ar.find("#enableVlan").trigger("change")}function bq(cv){cv.add({action:RAINIER.jnapActions.getManagementSettings(),data:{},cb:function(cw){if(cw.result==="OK"){b.mgmt=cw.output}else{}}});cv.add({action:"/jnap/routerupnp/GetUPnPSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.upnp=cw.output||{}}else{}}});cv.add({action:"/jnap/firewall/GetALGSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.isSIPEnabled=cw.output.isSIPEnabled}else{}}});if(az.cutThroughForwarding){cv.add({action:RAINIER.jnapActions.getCTFSettings(),data:{},cb:function(cw){if(cw.result==="OK"){b.isCTFEnabled=cw.output.isCTFEnabled}else{}}})}if(az.router6){cv.add({action:RAINIER.jnapActions.getExpressForwardingSettings(),data:{},cb:function(cw){if(cw.result==="OK"){az.expressForwarding=cw.output.isExpressForwardingSupported;if(az.expressForwarding){b.isExpressForwardingEnabled=cw.output.isExpressForwardingEnabled}}else{}}})}if(az.allJoyn){cv.add({action:"/jnap/alljoyn/GetAllJoynSettings",data:{},cb:function(cw){if(cw.result==="OK"){b.isAllJoynEnabled=cw.output.isEnabled}else{}}})}}function r(){if(az.cutThroughForwarding){b1.find("#administration-ctf").show()}if(az.router6&&az.expressForwarding){b1.find("#administration-expressforwarding").show()}RAINIER.binder.toDom(b,b1)}function H(){}function by(){if(!RAINIER.network.uiLoadedFromCloud()){$("#allow-remote-access").hide()}if(az.allJoyn){b1.find("#alljoyn").removeClass("hidden")}if(RAINIER.shared.util.areServicesSupported(["/jnap/routermanagement/RouterManagement2"])&&!b.mgmt.isManageWirelesslySupported){b1.find("#wireless-access-block").remove()}if(az.core7){b1.find("#http-wrapper").hide();b1.find("#https-enabled").prop("disabled",true)}$.delAttr(b.mgmt,"isManageWirelesslySupported");r();H()}function bJ(){var cv=RAINIER.binder.fromDom(b1,b6);$.extend(br,cv);br.mgmt=$.extend({},b.mgmt,br.mgmt)}function j(){var cv=false;bJ();if(az.cutThroughForwarding){}if(az.allJoyn){}if(!$.compare(br.mgmt,b.mgmt)||!$.compare(br.upnp,b.upnp)||br.isSIPEnabled!==b.isSIPEnabled||(az.cutThroughForwarding&&br.isCTFEnabled!==b.isCTFEnabled)||(az.router6&&az.expressForwarding&&br.isExpressForwardingEnabled!==b.isExpressForwardingEnabled)||(az.allJoyn&&br.isAllJoynEnabled!==b.isAllJoynEnabled)){cv=true}return cv}function aM(){var cv=RAINIER.jnap.Transaction({onComplete:cl.onSaveComplete});if(!$.compare(b.mgmt,br.mgmt)){cv.add({action:RAINIER.jnapActions.setManagementSettings(),data:br.mgmt,cb:function(cw){if(cw.result==="OK"){$.extend(true,b.mgmt,br.mgmt)}else{aA.doSave=false}}})}if(!$.compare(b.upnp,br.upnp)){cv.add({action:"/jnap/routerupnp/SetUPnPSettings",data:br.upnp,cb:function(cw){if(cw.result==="OK"){$.extend(true,b.upnp,br.upnp)}else{aA.doSave=false}}})}if(b.isSIPEnabled!==br.isSIPEnabled){cv.add({action:"/jnap/firewall/SetALGSettings",data:{isSIPEnabled:br.isSIPEnabled},cb:function(cw){if(cw.result==="OK"){b.isSIPEnabled=br.isSIPEnabled}else{aA.doSave=false}}})}if(az.cutThroughForwarding&&b.isCTFEnabled!==br.isCTFEnabled){cv.add({action:RAINIER.jnapActions.setCTFSettings(),data:{isCTFEnabled:br.isCTFEnabled},cb:function(cw){if(cw.result==="OK"){b.isCTFEnabled=br.isCTFEnabled}else{aA.doSave=false}}})}if(az.router6&&az.expressForwarding&&b.isExpressForwardingEnabled!==br.isExpressForwardingEnabled){cv.add({action:RAINIER.jnapActions.setExpressForwardingSettings(),data:{isExpressForwardingEnabled:br.isExpressForwardingEnabled},cb:function(cw){if(cw.result==="OK"){b.isExpressForwardingEnabled=br.isExpressForwardingEnabled}else{aA.doSave=false}}})}if(az.allJoyn&&b.isAllJoynEnabled!==br.isAllJoynEnabled){cv.add({action:"/jnap/alljoyn/SetAllJoynSettings",data:{isEnabled:br.isAllJoynEnabled},cb:function(cw){if(cw.result==="OK"){b.isAllJoynEnabled=br.isAllJoynEnabled}else{aA.doSave=false}}})}RAINIER.ui.showWaiting();cv.send()}function b8(){var cB=ck.find("#velop-simpleSetup"),cx="admin",cA="Node1",cE=["2.4GHz","5GHz"],cC=["userDeviceName","userDeviceLocation"],cz,cy,cH,cv="/jnap/nodes/smartconnect/SetWiredAutoOnboardingSettings";if(RAINIER.shared.util.areServicesSupported(["/jnap/nodes/autoonboarding/AutoOnboarding"])){cv="/jnap/nodes/autoonboarding/SetWiredAutoOnboardingSettings"}else{cB.find("#startBTOnboarding").hide();cB.find("#autoonboarding-notavailable").show()}function cI(cO){if(cO.result==="OK"){console.warn("Setup complete");setTimeout(function(){cB.find(".unconfigured-block").hide();cB.find("#ssidTxt").text(cB.find("#ssid").val());cB.find("#pwTxt").text(cB.find("#password").val());cB.find(".ssid-block").show();cB.find(".configured-block").show()},20*1000)}else{}}function cD(cP,cO){var cQ={action:cv,data:{isAutoOnboardingEnabled:true},cb:function(cR){if(cR.result==="OK"){if(typeof cO==="function"){cO()}}else{}},disableDefaultAjaxErrHandler:true};if(cP){cP.add(cQ)}else{RAINIER.jnap.send(cQ)}}function cw(cP,cO){var cQ={action:cv,data:{isAutoOnboardingEnabled:false},cb:function(cR){if(cR.result==="OK"){if(typeof cO==="function"){cO()}}else{}},disableDefaultAjaxErrHandler:true};if(cP){cP.add(cQ)}else{RAINIER.jnap.send(cQ)}}function cM(){var cP={action:"/jnap/nodes/autoonboarding/SetBluetoothAutoOnboardingSettings",data:{isAutoOnboardingEnabled:true},cb:function(cQ){if(cQ.result==="OK"){setTimeout(cO,500)}else{}},disableDefaultAjaxErrHandler:true};function cO(){RAINIER.jnap.send({action:"/jnap/nodes/autoonboarding/StartBluetoothAutoOnboarding",data:{},cb:function(cQ){if(cQ.result==="OK"){setTimeout(function(){cB.find("#startBTOnboarding").removeProp("disabled");cB.find("#stopOnboarding").removeProp("disabled")},10000)}else{}},disableDefaultAjaxErrHandler:true})}RAINIER.jnap.send(cP)}function cK(){var cO={action:"/jnap/nodes/autoonboarding/SetBluetoothAutoOnboardingSettings",data:{isAutoOnboardingEnabled:false},cb:function(cP){if(cP.result==="OK"){console.warn("BTOnboarding stopped")}else{}},disableDefaultAjaxErrHandler:true};RAINIER.jnap.send(cO)}function cF(){if(cy&&cH){var cO=_.find(cy,{isAuthority:true});if(cO){cz=cO.deviceID;console.warn("Found Authority",cz)}cH.updatePolicy="AutomaticallyCheckAndInstall";cB.find("#setupNode").click(function(){var cT=[],cP=[],cU=cB.find("#ssid").val(),cS=cB.find("#password").val();var cR="WPA2-Personal";cB.find("#setupNode").prop("disabled","disabled");if(symmetryUtil.wireless.has6GHzRadio(b.wireless.radios)){cE.push("6GHz")}_.map(cE,function(cX){var cV=RAINIER.applets.wireless.getRadioFromSet(b.wireless,"RADIO_"+cX),cW=symmetryUtil.wireless.getNodesPreferredSecurityType(cR,cV);cT.push({band:cX,ssid:cU,security:cW,passphrase:cS})});_.map(cC,function(cV){cP.push({name:cV,value:cA})});var cQ=RAINIER.jnap.Transaction({onComplete:cI,timeoutMs:45*1000,disableDefaultJnapErrHandler:true,disableDefaultAjaxErrHandler:true});cQ.add("/jnap/nodes/smartmode/SetDeviceMode",{mode:"Master"});cQ.add({action:"/jnap/nodes/setup/SetSimpleWiFiSettings",data:{simpleWiFiSettings:cT},cb:function(cV){if(cV.result!=="OK"){cB.find("#setupNode").removeProp("disabled");console.warn("err",cV.result);if(cV.result==="ErrorInvalidSSID"){cJ("ssidInputValidation",true,RAINIER.ui.validation.strings.connectivity.inputInvalid)}else{cG("ssidInputValidation")}if(cV.result==="ErrorInvalidPassphrase"){cJ("passwordInputValidation",true,RAINIER.ui.validation.strings.connectivity.inputInvalid)}else{cG("passwordInputValidation")}}else{cG("ssidInputValidation");cG("passwordInputValidation")}}});if(!RAINIER.shared.util.areServicesSupported(["/jnap/core/Core7"])){cQ.add("/jnap/core/SetAdminPassword2",{adminPassword:cx})}cQ.add("/jnap/devicelist/SetDeviceProperties",{deviceID:cz,propertiesToModify:cP});cQ.add("/jnap/firmwareupdate/SetFirmwareUpdateSettings",cH);cQ.send()});cB.find("#setupNode").removeProp("disabled")}else{}cB.find(".unconfigured-block").show()}function cL(){var cO=RAINIER.jnap.Transaction({onComplete:cF,timeoutMs:30*1000,disableDefaultJnapErrHandler:true});cO.add({action:"/jnap/devicelist/GetDevices",data:{},cb:function(cP){if(cP.result==="OK"){cy=cP.output.devices}else{}}});cO.add({action:"/jnap/firmwareupdate/GetFirmwareUpdateSettings",data:{},cb:function(cP){if(cP.result==="OK"){cH=cP.output}else{}}});cO.send();$(".unconfigured-block").show()}function cN(){var cO="/jnap/nodes/smartconnect/GetWiredAutoOnboardingSettings";if(RAINIER.shared.util.areServicesSupported(["/jnap/nodes/autoonboarding/AutoOnboarding"])){cO="/jnap/nodes/autoonboarding/GetWiredAutoOnboardingSettings"}RAINIER.jnap.send({action:cO,data:{},cb:function(cP){if(cP.result==="OK"){var cQ=cP.output;if(cQ.isAutoOnboardingEnabled){cB.find("#startOnboarding").prop("disabled","disabled");cB.find("#stopOnboarding").removeProp("disabled")}cB.find(".configured-block").show()}else{}}})}function cJ(cP,cS,cQ){var cR=cB.find("#"+cP),cT=cR.find(".inputValidationBox"),cO=cR.find("inputField");cT.addClass("inputError");if(cS){cT.removeClass("showInputValidationMessage");var cU=cT.find(".inputValidationErrorMessage");if(cU.length>0){console.warn(cU);if(cQ&&cQ.length>0){cU.html(cQ)}}else{return}}else{cT.addClass("showInputValidationMessage")}if(cO){cO.focus()}}function cG(cO){var cP=cB.find("#"+cO),cQ=cP.find(".inputValidationBox");cQ.removeClass("inputError")}cB.find("#startOnboarding").click(function(){$(this).prop("disabled","disabled");cD(null,function(){cB.find("#stopOnboarding").removeProp("disabled")})});cB.find("#stopOnboarding").click(function(){$(this).prop("disabled","disabled");cw(null,function(){cB.find("#startOnboarding").removeProp("disabled")});cK()});cB.find("#startBTOnboarding").click(function(){$(this).prop("disabled","disabled");cM()});RAINIER.jnap.send({action:"/jnap/nodes/smartmode/GetDeviceMode",data:{},cb:function(cO){console.warn("GetDeviceMode",cO);if(cO.result==="OK"){switch(cO.output.mode){case"Unconfigured":cL();break;case"Master":cN();break}}else{}},disableDefaultAjaxErrHandler:true})}function R(cv){ci(cv);w.internetSettingsPreInit(cv);cm(cv);if(aF.advancedrouting){a4(cv)}if(aF.vlantagging){a9(cv)}if(aF.administration){bq(cv)}}function a(){bf();w.internetSettingsInit();bM();if(aF.advancedrouting){f()}if(aF.vlantagging){cg()}if(aF.administration){by()}if(bj==="#casupport"&&aF.velopSimpleSetup){b8()}RAINIER.ui.textAreaPlaceholder.init();RAINIER.event.fire("applet.loaded");if(RAINIER.network.isBehindNode()){t=RAINIER.network.getNodesCurrentFirmwareVersions();console.warn("nodesCurent",t);if(!t){RAINIER.event.connect("nodes-current-fw-versions",ca)}else{bo()}aU=RAINIER.network.getNodesAvailableUpdates();if(!aU){I()}else{aB(aU)}if($.cookie("app-flag")==="update-firmware"){setTimeout(function(){cl.onAutoFirmwareUpdate()},500)}}else{if($.cookie("app-flag")==="check-firmware"){setTimeout(function(){ck.find(".check-update").click()},500)}}}function cf(){ck.find(".tabs").prepend(aO.basic);if(bj==="#casupport"&&aF.velopSimpleSetup){ck.find("#internetSettingsTab").after(aO.velopSimpleSetup)}if(aF.administration){ck.find("#internetSettingsTab").after(aO.administration)}if(aF.vlantagging){ck.find("#internetSettingsTab").after(aO.vlantagging)}else{ar.remove()}if(aF.advancedrouting){ck.find("#internetSettingsTab").after(aO.advancedrouting)}ck.find("#internetSettingsTab").after(aO.localNetwork);if(aF.powerModem){ck.find("#internetSettingsTab").after(aO.powerModem)}else{ck.find("#power-modem").remove()}}function bW(cv){aF.advancedrouting=true;aF.administration=RAINIER.shared.util.areServicesSupported(["/jnap/firewall/Firewall","/jnap/routerupnp/RouterUPnP","/jnap/routermanagement/RouterManagement"]);aF.powerModem=RAINIER.network.isPowerModemSupported();aF.vlantagging=(RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging"])||RAINIER.shared.util.areServicesSupported(["/jnap/vlantagging/VLANTagging2"]))&&!RAINIER.network.isBridgeMode();az.cutThroughForwarding=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router2"])||RAINIER.shared.util.areServicesSupported(["/jnap/router/broadcom/RouterBroadcom"]);az.passwordHint=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core3"]);az.allJoyn=RAINIER.shared.util.areServicesSupported(["/jnap/alljoyn/AllJoyn"]);az.router6=RAINIER.shared.util.areServicesSupported(["/jnap/router/Router6"]);az.core7=RAINIER.shared.util.areServicesSupported(["/jnap/core/Core7"]);aF.velopSimpleSetup=RAINIER.network.isBehindNode()&&cv;cf()}function aY(){p();w.initializeInternetSettingsDefaultInputValues();bQ()}function co(cv){RAINIER.applets.connectivity.resetSharedOptions();RAINIER.deviceManager.getDevices(function(cx){b.devices=cx});RAINIER.ui.progressBar.build("updateFwProgress div.progress-bar");RAINIER.ui.progressBar.build("updatePmFwProgress div.progress-bar");ct=RAINIER.ui.dialog($("#dialog-tabchange"),{onSubmit:function(){aA.doTabChange=true;bt(false)}});$("#dialog-tabchange #no-save").unbind("click");$("#dialog-tabchange #no-save").click(function(){ct.close();B();aA.destinationTab.click()});m=RAINIER.ui.dialog("#updateFwProgress",{});bb=RAINIER.ui.dialog("#updatePmFwProgress",{});bU=RAINIER.ui.dialog("#updateFwComplete",{cancelClose:true,onSubmit:function(){window.location.replace("/ui/dynamic/home.html")}});b5=RAINIER.ui.dialog("#updatePmFwComplete",{cancelClose:true,onSubmit:function(){window.location.replace("/ui/dynamic/home.html")}});ac=RAINIER.ui.dialog("#guest-ssid-conflict");bC();aY();bW(typeof cv==="boolean"?!cv:true);aH=RAINIER.ui.tabs.init({fireEvents:true,initialTab:$.cookie("initial-tab")});aH.connect(function(cy,cx){if(cx.type==="tab"){bu=cx.srcTabId;b2=cx.destTabId;if(cx.srcIdx>-1){aA.destinationTab=cx.destTab;if(E()){cy.cancelEvent=true}}else{bu=b2}}else{cb=cx.destTabId;if(!RAINIER.network.isBridgeMode()&&(cb==="ip-v4"||cb==="ip-v6")){ck.find("div#ipv4-ipv6-common").toggleClass("ipv6",cb==="ip-v6")}else{cy.cancelEvent=true}}});aH.fireInit();var cw=RAINIER.jnap.Transaction({onComplete:a});R(cw);cw.send();ck.find("footer .cancel").click(cl.onClose);ck.find("footer .submit").click(cl.onSave);ck.find("footer .apply").click(cl.onApply);RAINIER.event.connect("tab.changed",function(cx,cy){switch(cy.destTabId){case"internet-settings":case"ip-v6":case"local-network":RAINIER.ui.fixIeForm("#"+cy.destTabId);break}})}if(RAINIER.network.isBehindNode()){symmetryUtil.nodes.canOnlyBeSlave().always(co)}else{co()}}());