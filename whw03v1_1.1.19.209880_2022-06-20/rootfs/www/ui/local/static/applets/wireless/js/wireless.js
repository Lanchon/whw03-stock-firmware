(function(){var aw=$("#wireless-applet"),d=aw.find("#wireless"),bv=aw.find("#filter-list"),S=aw.find("#wps"),x=aw.find("#scheduler"),aK=x.find(".currentTime span"),D=aw.find("#ssid-broadcast-warning"),bu=aw.find("#no-ssid-broadcast-warning"),Y=aw.find("#wps-popup"),aF=aw.find("#advanced"),r=null,bo=null,ac=false,bh={macAddress:""},u=32,ag=5*1000,bx=null,a9=null,bm=null,N=null,M=null,aA=null,k=null,az=null,l=false,g=true,v=true,q=null,a0=500,ai=null,bc=null,aP=false,au=false,m=false,av=false,bl=false,bj=false,E=true,C=RAINIER.ui.buildInputValidBalloon,aT=RAINIER.network.isBehindNode(),ab=aT&&window.location.hash!=="#casupport";var H=/RADIO_(.+GHz).*/;var aC={serverAvailable:true};var af=RAINIER.ui.template.createTemplate(aw.find("#templateFilterRow tr")),P=RAINIER.ui.template.createTemplate(aw.find("#template-radio-config-box > div")),be="div.radio-config-box";var ah={firewall:{},wireless:{radios:[]},wps:{},clientPIN:"",serverPIN:"",filters:[],guestSettings:{},simpletap:{},wan:{},scheduler:{},atf:{},dfs:{},topologyOptimization:{},iptv:{},homeKitSettings:{}};var bd={firewall:{},wireless:{radios:[]},setWireless:[],filters:[],filterList:[],simpletap:{},scheduler:{},atf:{},dfs:{},topologyOptimization:{},iptv:{}};var c=["Auto","Standard","Wide","Wide80"];var by={"wan.tpSettings.useStaticSettings":"boolean","wan.bridgeSettings.useStaticSettings":"boolean","wan.useStaticSettings":"boolean","wan.tpSettings.maxIdleMinutes":"number","wan.tpSettings.reconnectAfterSeconds":"number","wan.L2TPSettings.maxIdleMinutes":"number","wan.L2TPSettings.reconnectAfterSeconds":"number","wan.pppoeSettings.maxIdleMinutes":"number","wan.pppoeSettings.reconnectAfterSeconds":"number","settings.broadcastSSID":"boolean","settings.channel":"number","settings.wpaEnterpriseSettings.radiusPort":"number","settings.wepSettings.txKey":"number","wps.enabled":"boolean","simpletap.isSetupVAPEnabled":"boolean","labels.short":"display-only","labels.band":"display-only","labels.network":"display-only","labels.networkName":"display-only","labels.wirelessSettings":"display-only","wireless.combineNetworks":"boolean","topologyOptimization.isClientSteeringEnabled":"boolean","topologyOptimization.isNodeSteeringEnabled":"boolean","iptv.isEnabled":"boolean"};var an={};var Q={onToggleWidget:function(){RAINIER.connect.AppletManager.toggleWidgetShowState("7B1F462B-1A78-4AF6-8FBB-0C221703BEA4","7C8E2909-A0EF-48E7-A7BD-F615059F510C")},onEditFilter:function(bz){var bA=$(bz);$(this).parents("tr").addClass("edit");$(this).parents("tr").removeClass("hover");bA.find(".text-mac").val(bA.find(".mac").text());a4(bA)},onDelFilter:function(bA){var bz=bA.index()-1;bd.filterList.splice(bz,1);$(bA).hide();$(bA).remove();bs()},onUpdFilter:function(bA){var bz=bA.index()-1,bB=$(bA),bC=$.trim(bB.find(".text-mac").val());if(i(bA)){if(bC){bd.filterList[bz]=bC;bB.find(".mac").text(bC);bB.removeClass("edit")}else{bd.filterList.splice(bz,1);bB.remove()}}},onCancelFilter:function(bA){var bz=bA.index()-1,bB=bd.filterList[bz];$(bA).removeClass("edit");if(bB===""){bd.filterList.splice(bz,1);$(bA).hide();$(bA).remove()}else{$(bA).find(".mac").text(bB)}RAINIER.ui.inputBalloon.hide()},onClose:function(){RAINIER.ui.MainMenu.closeApplet()},onApply:function(){U(false)},onSave:function(){U(true)},onSaveComplete:function(bz){if(bz===undefined){bz=true}if(bz){RAINIER.ui.hideWaiting()}if(v){if(g){Q.onClose()}else{if(l){az.click()}}}}};var w={macfiltering:false,simpletap:false,scheduler:false};var aD={macfiltering:aw.find("#wireless-disabled-features #mac-filtering-tab"),simpletap:aw.find("#wireless-disabled-features #simpletap-tab"),scheduler:aw.find("#wireless-disabled-features #scheduler-tab"),advanced:aw.find("#wireless-disabled-features #advanced-tab")};var aI={macfiltering:aw.find("#wireless-disabled-features #mac-filtering"),simpletap:aw.find("#wireless-disabled-features #simpletap"),scheduler:aw.find("#wireless-disabled-features #scheduler"),advanced:aw.find("#wireless-disabled-features #advanced")};function U(bB){var bz=false;g=bB||false;v=true;switch(aA){case"wireless":if(a7()){bz=true;if(ay()){return aW()}}break;case"mac-filtering":if(am()){bz=true;if(aN()){bg()}}break;case"wps":if(O()){bz=true;e()}break;case"simpletap":if(I()){bz=true;if(aR()){aB()}}break;case"scheduler":if(aj()){bz=true;RAINIER.network.getRouterCurrentTime(function(bC){var bD=RAINIER.blockScheduler.getCurrentTimeCell(bC);if(bD.className==="checked"){RAINIER.ui.dialogWarning({msg:aw.find("#confirm-wireless-scheduler-disabled").text(),onSubmit:aY})}else{aY()}})}break;case"advanced":if(j()){bz=true;if(bf()){if(p()){if(bd.dfs.isDFSEnabled){var bA=$("#confirm-turning-dfs-on-warning");bA.find(".emLink em").unbind("click").click(function(){window.open("https://www.linksys.com/us/support-article?articleNum=316762","_blank")});RAINIER.ui.dialog(bA,{onSubmit:aJ}).show()}else{RAINIER.ui.dialog("#confirm-turning-dfs-off-warning",{onSubmit:aJ}).show()}}else{aJ()}}}break}if(g&&!bz){Q.onClose()}return true}function aH(){var bz=false;switch(M){case"wireless":bz=a7();break;case"mac-filtering":bz=am();break;case"wps":bz=O();break;case"simpletap":bz=I();break;case"scheduler":bz=aj();break;case"advanced":bz=j();break}if(bz){aA=M;bm.show()}return bz}function A(){switch(aA){case"wireless":W();break;case"mac-filtering":a2();break;case"wps":bb();break;case"simpletap":ar();break;case"scheduler":aM();break;case"advanced":aL();break}}function Z(bz){var bA=false;$.each(bz.supportedModes,function(bB,bC){if(bC.indexOf("ac")!==-1){bA=true;return false}});return bA}function al(bB,bz){var bA={"802.11a":"#wireless-mode-a","802.11an":"#wireless-mode-an","802.11anac":"#wireless-mode-anac","802.11anacax":"#wireless-mode-anacax","802.11b":"#wireless-mode-b","802.11bg":"#wireless-mode-bg","802.11bgn":"#wireless-mode-bgn","802.11bgnax":"#wireless-mode-bgnax","802.11g":"#wireless-mode-g","802.11n":"#wireless-mode-n","802.11ac":"#wireless-mode-ac","802.11mixed":"#wireless-mode-mixed"};if(symmetryUtil.wireless.isMixedMode(bB,bz)){return'<option value="'+bB+'">'+aw.find("#wireless-mode-mixed").text()+"</option>"}if(!bA[bB]){return'<option value="'+bB+'">'+bB+"</option>"}return'<option value="'+bB+'">'+aw.find(bA[bB]).text()+"</option>"}function aa(bA,bz){if(ab){bA.append(al("802.11mixed",bz));return}$.each(bz.supportedModes.reverse(),function(bB,bC){bA.append(al(bC,bz))})}function bi(bA,bz){$.each(bz.supportedSecurityTypes,function(bB,bC){bA.append('<option value="'+bC+'">'+RAINIER.ui.common.strings.wirelessSecurity[bC]+"</option>")})}function T(bz,bA){function bB(bD){var bC=null;switch(bD){case"Auto":bC=aw.find("#channel-width-auto").text();break;case"Standard":bC=aw.find("#channel-width-standard").text();break;case"Wide":bC=aw.find("#channel-width-wide").text();break;case"Wide80":bC=aw.find("#channel-width-wide80").text();break;case"Wide160c":bC=aw.find("#channel-width-wide160c").text();break;case"Wide160nc":bC=aw.find("#channel-width-wide160nc").text();break;default:bC="Not Found";break}return bC}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){$.each(bA.supportedChannelsForChannelWidths,function(){bz.append('<option value="'+this.channelWidth+'">'+bB(this.channelWidth)+"</option>")})}else{$.each(c,function(bC,bD){if(bA.band==="2.4GHz"&&bD.indexOf("Wide")!==-1){return}if(bA.band==="5GHz"&&!Z(bA)&&bD==="Wide80"){return}bz.append('<option value="'+bD+'">'+bB(bD)+"</option>")})}}function at(bz){bz.add({action:RAINIER.jnapActions.getRadioInfo(),data:{},cb:function(bB){var bA=d.find("#radio-list");ah.radio=bB.output||{};if(bB.result==="OK"){ah.wireless=ah.radio;bd.wireless=$.extend(true,{},ah.wireless);bA.empty();RAINIER.applets.wireless.sortRadios(ah.wireless.radios);bj=symmetryUtil.wireless.has6GHzRadio(ah.wireless.radios);$.each(ah.wireless.radios,function(){var bC=RAINIER.shared.util.getLabeledRadio(ah.wireless,this.radioID),bD;bC.supportedSecurityTypes=symmetryUtil.wireless.getSecurityTypeOrder(bC.supportedSecurityTypes);bD=RAINIER.ui.template.createBlock(P,bC,by);bD.attr("id",bC.radioID);bD.addClass(bC.band);bD.data("jnap",bC);aa(bD.find(".w-network-mode"),bC);bi(bD.find(".w-security"),bC);aG(bD.find(".w-channel"),bC);T(bD.find(".w-channel-width"),bC);if(bC.band==="5GHz"&&ah.wireless.isBandSteeringEnabled){bD.find(".w-channel-label, .w-channel-width-label, .w-network-mode-label").text(RAINIER.ui.common.strings.auto)}aX(bD);RAINIER.ui.viewPassword(bD.find(".password-eye-box"));bA.append(bD)});if(ah.wireless.supportedBandSteeringModes&&ah.wireless.radios.length>1){aw.find("#band-steering-selection").show();aw.find("#band-steering-selection .w-steering-basic span").html(RAINIER.ui.shared.strings.bandSteering.Basic["short"]);aw.find(".w-band-steer-only, .w-no-band-steer-only").hide()}else{aw.find(".w-band-steer-only").hide()}if(RAINIER.applets.wireless.isTriBandSteeringSupported()){aw.find("#band-steering-selection").addClass("triBandSteeringSupported");aw.find("#band-steering-selection .w-steering-triBand span").html(RAINIER.ui.shared.strings.bandSteering.TriBand["short"]);aw.find(".triBandSteering").show()}if(ab){ah.wireless.combineNetworks=RAINIER.applets.wireless.areAllRadioSettingsIdentical(ah.wireless.radios);bA.find("#RADIO_5GHz_2").hide()}if(window.location.hash==="#casupport"){d.find(".showForLinksysRouters").removeClass("showForLinksysRouters");d.find(".showForNodes").hide()}}}});bz.add({action:RAINIER.jnapActions.getWANStatus(),data:{},cb:function(bA){if(bA.result==="OK"){if(bA.output){ah.wan=bA.output}else{}}else{}}});bz.add({action:RAINIER.jnapActions.getWANSettings(),data:{},cb:function(bA){if(bA.result==="OK"){ah.wanSettings=bA.output}else{}}});RAINIER.applets.guestNetwork.getSettings(ah.guestSettings,function(bA){ah.guestSettings=$.extend({},bA)},bz);if(RAINIER.shared.util.areServicesSupported(["/jnap/homekit/HomeKit"])){bz.add({action:"/jnap/homekit/GetHomeKitSettings",data:{},cb:function(bA){if(bA.result==="OK"){ah.homeKitSettings=bA.output||{}}else{}}})}}function F(bz){if(bz.combineNetworks){d.find('h2[name="labels.band"]').hide();d.find("h2.tri-band").show();d.find("#RADIO_5GHz").hide();if(ah.homeKitSettings.isPaired){d.find("#homekit-combine-radios-note").show()}else{d.find("#show-more").show()}}else{d.find('h2[name="labels.band"]').show();d.find("h2.tri-band").hide();d.find("#RADIO_5GHz, #RADIO_6GHz").show();if(!bj){d.find("#make-all-the-same").show()}}}function W(){var bA=null,bz=$.extend(true,{},ah.wireless);if(ab){d.find(".radio-link").hide();if(!bj){var bB=d.find("#velop-content");F(bz);RAINIER.binder.toDom({wireless:bz},bB,by)}}if(RAINIER.network.getCurrentWanType()==="WirelessBridge"){if(ah.wanSettings.wirelessModeSettings.band==="5GHz"){d.find("#band-steering-selection").hide()}else{d.find(".triBandSteering").hide()}}$.each(ah.wireless.radios,function(){var bC=this;bA=d.find("#"+RAINIER.ui.escapeId(bC.radioID));bC=RAINIER.shared.util.getLabeledRadio(bz,bC.radioID);bA.data("jnap",bC);RAINIER.binder.toDom(bC,bA,by);if(RAINIER.network.isRadioLocked(bC.band)){bA.find(".radio-blocked").show();bA.find(".radio-settings").hide()}G(bA,true);s.call(bA);if(ah.homeKitSettings.isPaired){bA.find(".w-security, .w-network-mode").prop("disabled",true)}});if(ah.wireless.supportedBandSteeringModes&&!ah.wireless.isBandSteeringEnabled){ah.wireless.bandSteeringMode="Off"}RAINIER.binder.toDom(ah,d,by);E=false}function bp(){var bA=null;RAINIER.util.trapEnter(d.find("input[type=text]"));d.find(".w-wep-generate-keys").click(z);if(ah.wireless.supportedBandSteeringModes){aw.find("#band-steering-selection input").change(function(){if($(this).is(":checked")){var bB=$.extend(true,{},ah.wireless);bB.bandSteeringMode=$(this).val();aw.find(".w-network-mode.val-el").each(function(){s.call(this)});ay();bB.isBandSteeringEnabled=ah.wireless.supportedBandSteeringModes.indexOf(bB.bandSteeringMode)>-1;if(!bB.isBandSteeringEnabled){$.delAttr(bB,"bandSteeringMode")}function bC(bE,bG){var bF=RAINIER.shared.util.getLabeledRadio(bB,bG),bD={labels:bF.labels};if(bB.isBandSteeringEnabled&&symmetryUtil.wireless.isPrimaryBandSteeredRadio(bB,bF)){bE.find(".w-band-steer-only").show();bE.find(".w-no-band-steer-only").hide();bE.find(".w-channel-label, .w-channel-width-label, .w-network-mode-label").text(RAINIER.ui.common.strings.auto);bD.settings=RAINIER.applets.wireless.getBandSteeringDefaults(bF).settings}else{bE.find(".w-band-steer-only").hide();bE.find(".w-no-band-steer-only").show()}RAINIER.binder.toDom(bD,bE,by);if(bB.bandSteeringMode==="TriBand"){bE.find('h2[name="labels.band"]').hide();bE.find("h2.tri-band").show();bE.find('.radio-label[name="labels.band"]').hide();bE.find(".radio-label.tri-band").show()}else{bE.find('h2[name="labels.band"]').show();bE.find("h2.tri-band").hide();bE.find('.radio-label[name="labels.band"]').show();bE.find(".radio-label.tri-band").hide()}}$.each(ah.wireless.radios,function(){var bD=d.find("#"+RAINIER.ui.escapeId(this.radioID));if(RAINIER.applets.wireless.shouldFilterRadio(this,bB)){bC(bD,this.radioID);bD.show()}else{bD.hide()}})}})}aw.find("select.w-channel").change(function(bD){if(bD.originalEvent){var bE=$(this).parents(".radio-config-box").attr("id").replace(H,"$1"),bC=symmetryUtil.wireless.lookupChannelDataByChannel(this.value,bE);function bB(){if(av&&bC.dfs){RAINIER.ui.dialog("#confirm-turning-dfs-on-wireless-tab",{onSubmit:U,onCancel:W}).show()}}if(lodash.includes(bC.unii,4)){RAINIER.ui.dialog("#confirm-to-change-unii4-channel",{onSubmit:bB,onCancel:W}).show()}else{bB()}}});if(ab){function bz(bC){var bB=$.extend(true,{},ah.wireless),bD=d.find("#velop-content");if(bj){bC=false}bB.combineNetworks=bC;RAINIER.binder.toDom({wireless:bB},bD,by);F(bB);if(bC){d.find("#RADIO_5GHz, .radio-link").hide();d.find("#show-more").show()}else{d.find(".radio-link").hide();d.find("#RADIO_5GHz, #RADIO_6GHz").show();if(!bj){d.find("#show-less").show()}}$.each(ah.wireless.radios,function(){var bF=d.find("#"+RAINIER.ui.escapeId(this.radioID)),bG=RAINIER.shared.util.getLabeledRadio(bB,this.radioID),bE={labels:bG.labels};RAINIER.binder.toDom(bE,bF,by)})}aw.find("#show-less, #make-all-the-same").click(function(){bz(true)});aw.find("#show-more").click(function(){bz(false)})}aw.find("#band-steering-selection input").change();$.each(ah.wireless.radios,function(){var bB=d.find("#"+RAINIER.ui.escapeId(this.radioID));bB.find(".w-security").change(function(bC){if(bC.originalEvent){G(bB)}})})}function s(){var bz={"settings.security":["settings.mode","settings.channelWidth","settings.channel"],"settings.mode":["settings.security","settings.channelWidth","settings.channel"],"settings.channelWidth":["settings.channel","settings.security","settings.mode"],"settings.channel":["settings.security","settings.mode","settings.channelWidth"]},bB={"settings.security":function(){var bK=$(this),bF=bK.parents(be),bI=bF.find(".w-network-mode"),bL=bI.val(),bG=bF.find(".w-channel-width"),bJ=bG.val(),bH=RAINIER.shared.util.getLabeledRadio(ah.wireless,bF.attr("id")),bE=d.find('input[name="wireless.bandSteeringMode"]:checked').val()||ah.wireless.bandSteeringMode;$.each(bK.find("option"),function(){var bM=$(this);bM.removeClass();bM.removeData("why-invalid");bM.removeData("why-invalid-el");if((bL.indexOf("n")>-1||bL.indexOf("ac")>-1)&&$.inArray(bM.attr("value"),["WEP","WPA-Mixed-Personal","WPA-Mixed-Enterprise"])>-1){if(!symmetryUtil.wireless.isMixedMode(bL,RAINIER.applets.wireless.getRadioFromSet(ah.wireless,bF.attr("id")))){bM.addClass("invalid-option");bM.data("why-invalid",bI.find(":selected").text());bM.data("why-invalid-el",bI)}}if(bM.attr("value")==="WEP"&&bJ.indexOf("Wide")!==-1){bM.addClass("invalid-option");bM.data("why-invalid",bG.find(":selected").text());bM.data("why-invalid-el",bG)}if(bM.attr("value")==="WEP"&&symmetryUtil.wireless.isPrimaryBandSteeredRadio({bandSteeringMode:bE},bH)){bM.addClass("invalid-option");if(bE==="TriBand"){bM.data("why-invalid",RAINIER.ui.shared.strings.bandSteering.TriBand["short"]);bM.data("why-invalid-el",aw.find("#triBandSteeringEnabled"))}else{bM.data("why-invalid",RAINIER.ui.shared.strings.bandSteering.Basic["short"]);bM.data("why-invalid-el",aw.find("#basicBandSteeringEnabled"))}}bC(bM)})},"settings.mode":function(){var bI=$(this),bE=bI.parents(be),bG=bE.find(".w-security"),bJ=bG.val(),bF=bE.find(".w-channel-width"),bH=bF.val();$.each(bI.find("option"),function(){var bK=$(this);bK.removeClass();bK.removeData("why-invalid");bK.removeData("why-invalid-el");if(symmetryUtil.wireless.isMixedMode(bK.attr("value"),RAINIER.applets.wireless.getRadioFromSet(ah.wireless,bE.attr("id")))){return}if((bK.attr("value").indexOf("n")>-1||bK.attr("value").indexOf("ac")>-1)&&$.inArray(bJ,["WEP","WPA-Mixed-Personal","WPA-Mixed-Enterprise"])>-1){bK.addClass("invalid-option");bK.data("why-invalid",bG.find(":selected").text());bK.data("why-invalid-el",bG)}if(bK.attr("value").indexOf("ac")===-1&&(bH==="Wide80"||bH.indexOf("Wide160")!==-1)){bK.addClass("invalid-option");bK.data("why-invalid",bF.find(":selected").text());bK.data("why-invalid-el",bF)}if(bK.attr("value")==="802.11a"&&bH.indexOf("Wide")!==-1){bK.addClass("invalid-option");bK.data("why-invalid",bF.find(":selected").text());bK.data("why-invalid-el",bF)}bC(bK)})},"settings.channelWidth":function(){var bI=$(this),bE=bI.parents(be),bK=bE.find(".w-security"),bG=bK.val(),bM=bE.find(".w-network-mode"),bH=bM.val(),bJ=bE.find(".w-channel"),bL=+bJ.val(),bF=RAINIER.applets.wireless.getRadioFromSet(ah.wireless,bE.attr("id"));$.each(bI.find("option"),function(){var bO=$(this),bN;bO.removeClass();bO.removeData("why-invalid");bO.removeData("why-invalid-el");if(bO.attr("value").indexOf("Wide")!==-1&&(bH==="802.11a"||bG==="WEP")){bO.addClass("invalid-option");if(bH==="802.11a"){bO.data("why-invalid",bM.find(":selected").text());bO.data("why-invalid-el",bM)}else{bO.data("why-invalid",bK.find(":selected").text());bO.data("why-invalid-el",bK)}}if(bF.band!=="6GHz"&&((bO.attr("value")==="Wide80"||bO.attr("value").indexOf("Wide160")!==-1)&&bH.indexOf("ac")===-1)){bO.addClass("invalid-option");bO.data("why-invalid",bM.find(":selected").text());bO.data("why-invalid-el",bM)}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){bN=$.inArray(bL,$.grep(bF.supportedChannelsForChannelWidths,function(bP){return bP.channelWidth===bO.attr("value")})[0].channels);if(bN===-1){bO.addClass("invalid-option");bO.data("why-invalid",bJ.find(":selected").text());bO.data("why-invalid-el",bJ)}}else{if(bO.attr("value")==="Auto"&&$.inArray(bL,RAINIER.applets.wireless.getCommonChannels(bF.supportedChannels,bF.supportedWideChannels))===-1){bO.addClass("invalid-option");bO.data("why-invalid",bJ.find(":selected").text());bO.data("why-invalid-el",bJ)}else{if(bO.attr("value")==="Standard"&&$.inArray(bL,bF.supportedChannels)===-1){bO.addClass("invalid-option");bO.data("why-invalid",bJ.find(":selected").text());bO.data("why-invalid-el",bJ)}else{if(bO.attr("value").indexOf("Wide")>-1&&$.inArray(bL,bF.supportedWideChannels)===-1){bO.addClass("invalid-option");bO.data("why-invalid",bJ.find(":selected").text());bO.data("why-invalid-el",bJ)}}}}bC(bO)})},"settings.channel":function(){var bI=$(this),bE=bI.parents(be),bF=bE.find(".w-channel-width"),bH=bF.val(),bG=RAINIER.applets.wireless.getRadioFromSet(ah.wireless,bE.attr("id"));$.each(bI.find("option"),function(){var bK=$(this),bL=Number(bK.attr("value")),bJ;bK.removeClass();bK.removeData("why-invalid");bK.removeData("why-invalid-el");if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){bJ=$.inArray(bL,$.grep(bG.supportedChannelsForChannelWidths,function(bM){return bM.channelWidth===bH})[0].channels);if(bJ===-1){bK.addClass("invalid-option");bK.data("why-invalid",bF.find(":selected").text());bK.data("why-invalid-el",bF)}}else{if(bH==="Auto"&&$.inArray(bL,RAINIER.applets.wireless.getCommonChannels(bG.supportedChannels,bG.supportedWideChannels))===-1){bK.addClass("invalid-option");bK.data("why-invalid",bF.find(":selected").text());bK.data("why-invalid-el",bF)}else{if(bH==="Standard"&&$.inArray(bL,bG.supportedChannels)===-1){bK.addClass("invalid-option");bK.data("why-invalid",bF.find(":selected").text());bK.data("why-invalid-el",bF)}else{if(bH.indexOf("Wide")>-1&&$.inArray(bL,bG.supportedWideChannels)===-1){bK.addClass("invalid-option");bK.data("why-invalid",bF.find(":selected").text());bK.data("why-invalid-el",bF)}}}}bC(bK)})}},bD=$(this),bA=bD.attr("name");function bC(bE){var bF=RAINIER.browser.ieVersion>0&&RAINIER.browser.ieVersion<=9;if(bF){bE.prop("label",bE.text())}bE.text(bE.text().replace(/[\[\]]/g,""));if(bF){bE.prop("label",bE.prop("label").replace(/[\[\]]/g,""))}if(bE.hasClass("invalid-option")){bE.text("["+bE.text()+"]");if(bF){bE.prop("label","["+bE.prop("label")+"]")}}}if(bA){$.each(bz[bA],function(bF,bE){bB[bE].call(bD.parents(be).find('[name="'+bE+'"]'))})}else{$.each(bz,function(bE){bB[bE].call(bD.find('[name="'+bE+'"]'))})}}function aX(bJ){var bI=bJ.data("jnap").radioID;var bG={validationType:"utf8LengthTooLong",maxLen:32,whiteSpace:false,isRequired:true},bD={minLen:8,maxLen:64,validCharSet:"ascii",whiteSpace:false,isRequired:true},bE={validCharSet:"numeric",maxLen:3,validationType:"ipAddress",isComposite:true,isRequired:true},bC={validCharSet:"numeric",maxLen:5,isRequired:true,whiteSpace:false},bB={validCharSet:"ascii",maxLen:64,isRequired:true},bF={maxLen:16,isRequired:false},bA={maxLen:26,validCharSet:"hex",whiteSpace:false};an.wireless=an.wireless||{};an.wireless[bI]={};an.wireless[bI].ssid=C($.extend(true,{},bG,{els:bJ.find(".w-ssid")}));an.wireless[bI].wepPassphrase=C($.extend(true,{},bF,{els:bJ.find(".w-wep-pass")}));an.wireless[bI].wepkey1=C($.extend(true,{},bA,{els:bJ.find(".w-wep-k1"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bJ.find(".w-wep-encrypt"),1,bJ.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));an.wireless[bI].wepkey2=C($.extend(true,{},bA,{els:bJ.find(".w-wep-k2"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bJ.find(".w-wep-encrypt"),2,bJ.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));an.wireless[bI].wepkey3=C($.extend(true,{},bA,{els:bJ.find(".w-wep-k3"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bJ.find(".w-wep-encrypt"),3,bJ.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));an.wireless[bI].wepkey4=C($.extend(true,{},bA,{els:bJ.find(".w-wep-k4"),errors:[{test:RAINIER.ui.validation.tests.isWepKey.curry(bJ.find(".w-wep-encrypt"),4,bJ.find(".w-wep-tx-k")),when:false,message:RAINIER.ui.validation.strings.invalidWepKey}]}));an.wireless[bI].wpaPassword=C($.extend(true,{},bD,{els:bJ.find('[type="password"].w-personal-pass'),errors:[{test:RAINIER.ui.validation.tests.isWpaPassword,when:false,message:RAINIER.ui.validation.strings.invalidWpaPassword}]}));an.wireless[bI].wpaPasswordText=C($.extend(true,{},bD,{els:bJ.find('[type="text"].w-personal-pass'),errors:[{test:RAINIER.ui.validation.tests.isWpaPassword,when:false,message:RAINIER.ui.validation.strings.invalidWpaPassword}]}));an.wireless[bI].sharedKey=C($.extend(true,{},bB,{els:bJ.find(".w-wpa-enterpr-key")}));an.wireless[bI].radiusServer=C($.extend(true,{},bE,{elContainer:bJ.find('span:[name="settings.wpaEnterpriseSettings.radiusServer"]')}));an.wireless[bI].radiusPort=C($.extend(true,{},bC,{els:bJ.find(".w-wpa-enterpr-port"),errors:[{test:function(bK){return RAINIER.ui.validation.tests.isInRange(1,65536,true,bK)},when:false,message:RAINIER.ui.validation.strings.invalidPort}]}));var bH=false,bz=[{test:function(bL,bK){function bM(bP){var bQ=bK.find(":selected").text(),bO=bK.find(":selected").data("why-invalid-el").data("fieldname"),bN=bK.find(":selected").data("why-invalid");return bP.replace("<option>",bQ).replace("<other_option_name>",bO).replace("<other_option_value>",bN)}s.call(bK);if(!bH){bH=true;bJ.find("select.invalid").not(bK).each(function(){$(this).change()});bH=false}if(bK.find(":selected").data("why-invalid")&&bK.is(":visible")){this.message=bM(RAINIER.ui.validation.strings.invalidWirelessOption);bJ.find("select.invalid").not(bK).removeClass("invalid");return false}return true},when:false,immediateError:true}];an.wireless[bI].securityType=C({els:bJ.find(".w-security"),errors:bz});an.wireless[bI].networkMode=C({els:bJ.find(".w-network-mode"),errors:bz});an.wireless[bI].channelWidth=C({els:bJ.find(".w-channel-width"),errors:bz});an.wireless[bI].channel=C({els:bJ.find(".w-channel"),errors:bz})}function ay(){var bz=true;$.each(ah.wireless.radios,function(){var bA=d.find("#"+RAINIER.ui.escapeId(this.radioID)),bB=bA.data("jnap").radioID;if(bz&&RAINIER.applets.wireless.shouldFilterRadio(this,bd.wireless)){bz=an.wireless[bB].ssid.isValid(true);bz=bz&&an.wireless[bB].securityType.isValid(true);bz=bz&&an.wireless[bB].networkMode.isValid(true);bz=bz&&an.wireless[bB].channelWidth.isValid(true);bz=bz&&an.wireless[bB].channel.isValid(true);if(bz){var bC=bA.find(".w-security").val();if(RAINIER.util.isSecurityTypeWep(bC)){bz=an.wireless[bB].wepkey1.isValid(true);if(bz){bz=an.wireless[bB].wepkey2.isValid(true)}if(bz){bz=an.wireless[bB].wepkey3.isValid(true)}if(bz){bz=an.wireless[bB].wepkey4.isValid(true)}}else{if(RAINIER.util.isSecurityTypeWpaPersonal(bC)){if(bA.find('[name="settings.wpaPersonalSettings.passphraseText"]').is(":visible")){bz=an.wireless[bB].wpaPasswordText.isValid(true)}else{bz=an.wireless[bB].wpaPassword.isValid(true)}}else{if(RAINIER.util.isSecurityTypeWpaEnterprise(bC)){bz=an.wireless[bB].radiusServer.isValid(true);if(bz){bz=an.wireless[bB].radiusPort.isValid(true)}if(bz){bz=an.wireless[bB].sharedKey.isValid(true)}}}}}}});if(bz&&RAINIER.applets.guestNetwork.isGuestSSIDConflict(ah.guestSettings,bd.wireless.radios)){r.show();bz=false}return bz}function f(){W();bp();RAINIER.ui.fixIeForm(d);d.find("select").on("change",function(){RAINIER.ui.fixIeForm(d)});d.find("#band-steering-selection .steering-help a").click(function(){RAINIER.ui.helpMenu.show();return false})}function G(bA,bz){var bC=bA.find(".w-network-mode"),bB=bA.find(".w-security"),bD=bB.val();if(bD==="WEP"||bD==="WPA-Personal"||bD==="WPA-Enterprise"){if(!bz){RAINIER.ui.dialogWarning({msg:aw.find("#confirm-wep-or-wpa").text(),onSubmit:function(){G(bA,true);bB.change()},onCancel:function(){bB.val(bB.data("current-value"));bB.change()}});return false}}if(RAINIER.util.isSecurityTypeWep(bD)){bA.removeClass("w-personal w-wpa-enterpr w-no-sec").addClass("w-wep")}else{if(RAINIER.util.isSecurityTypeWpaPersonal(bD)){bA.removeClass("w-wep w-wpa-enterpr w-no-sec").addClass("w-personal")}else{if(RAINIER.util.isSecurityTypeWpaEnterprise(bD)){bA.removeClass("w-wep w-personal w-no-sec").addClass("w-wpa-enterpr")}else{if(RAINIER.util.isSecurityTypeOpen(bD)){bA.removeClass("w-wep w-personal w-wpa-enterpr").addClass("w-no-sec")}}}}RAINIER.ui.inputBalloon.hide();bB.data("current-value",bB.val())}function z(){var bA=$(this).parent(),bC=bA.find(".w-wep-pass").val(),bz=bA.find(".w-wep-encrypt").val(),bB=RAINIER.applets.wireless.generateWepKeys(bC,bz);bA.find(".w-wep-k1").val(bB[0].toUpperCase()).change();bA.find(".w-wep-k2").val(bB[1].toUpperCase()).change();bA.find(".w-wep-k3").val(bB[2].toUpperCase()).change();bA.find(".w-wep-k4").val(bB[3].toUpperCase()).change()}function aG(bC,bB){function bA(bG){if(bG=="0"){return aw.find("#wireless-channel-auto").text()}else{var bE=symmetryUtil.wireless.lookupChannelDataByChannel(bG,bB.band);if(bE){var bF=bE.channel+" - "+bE.frequency+" GHz";if(bE.dfs){bF+=" (DFS)"}return bF}else{return""}}}function bD(){var bE=[];$.each(bB.supportedChannelsForChannelWidths,function(){bE=_.union(bE,this.channels)});bE.sort(function(bG,bF){return bG-bF});return bE}function bz(bE,bF){bC.append('<option value="'+bF+'">'+bA(bF)+"</option>")}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WirelessAP4"])){$.each(bD(),bz)}else{$.each([].concat(bB.supportedChannels).concat(bB.supportedWideChannels).filter(function(bF,bE,bG){return bE===bG.indexOf(bF)}),bz)}}function J(bz,bA){var bB=bz.find(".w-security").val();if(!RAINIER.util.isSecurityTypeWep(bB)){delete bA.settings.wepSettings}else{delete bA.settings.wepSettings.passphrase}if(!RAINIER.util.isSecurityTypeWpaPersonal(bB)){delete bA.settings.wpaPersonalSettings}if(!RAINIER.util.isSecurityTypeWpaEnterprise(bB)){delete bA.settings.wpaEnterpriseSettings}}function aU(){var bA=RAINIER.binder.fromDom(d,by),bz;bd.wireless=$.extend(true,{},ah.wireless);bd.wireless.radios=[];if(ah.wireless.supportedBandSteeringModes){bd.wireless.isBandSteeringEnabled=ah.wireless.supportedBandSteeringModes.indexOf(bA.wireless.bandSteeringMode)>-1;bd.wireless.bandSteeringMode=bA.wireless.bandSteeringMode}$.each(ah.wireless.radios,function(bE,bD){var bC=d.find("#"+RAINIER.ui.escapeId(bD.radioID)),bB=$.extend(true,{},bD,RAINIER.binder.fromDom(bC,by));if(RAINIER.util.isSecurityTypeWpaPersonal(bB.settings.security)){if(bC.find('[name="settings.wpaPersonalSettings.passphraseText"]').is(":visible")){bB.settings.wpaPersonalSettings.passphrase=bB.settings.wpaPersonalSettings.passphraseText}$.delAttr(bB.settings.wpaPersonalSettings,"passphraseText")}if(ab&&bB.settings.mode==="802.11mixed"&&bB.defaultMixedMode){bB.settings.mode=bB.defaultMixedMode}if(bB.band==="2.4GHz"){bz=bB}if(bz&&bB.band==="5GHz"&&bd.wireless.bandSteeringMode==="TriBand"){bB.settings.isEnabled=bz.settings.isEnabled}J(bC,bB);bd.wireless.radios.push(bB)});if(_.isBoolean(bA.wireless.combineNetworks)){bd.wireless.combineNetworks=bA.wireless.combineNetworks}}function a7(){var bA=false;aU();if(bd.wireless.bandSteeringMode!==ah.wireless.bandSteeringMode){bA=true}var bz=$.extend(true,{},bd.wireless);bz.radios=_.filter(bz.radios,function(bB){return RAINIER.applets.wireless.shouldFilterRadio(bB,bz)});if(RAINIER.applets.wireless.radiosHaveChanges(bz,ah.wireless)){bA=true}if(!bA&&ab&&bd.wireless.combineNetworks&&ah.wireless.combineNetworks!==bd.wireless.combineNetworks){bA=true}return bA}function aW(bB){var bz=false,bD=false,bA=false,bC=RAINIER.applets.wireless.getRadioFromSet(bd.wireless,"RADIO_2.4GHz");bB=bB||[];$.each(bd.wireless.radios,function(){var bE=this.settings.security;if(ab&&(this.radioID==="RADIO_5GHz_2"||(bd.wireless.combineNetworks&&this.band!=="2.4GHz"))){return true}if(["WPA3-Personal","WPA2/WPA3-Mixed-Personal","Enhanced-Open+None","Enhanced-Open-Only"].indexOf(bE)>-1){bD=true}if(this.band!=="2.4GHz"&&bC.settings.ssid!==this.settings.ssid){bz=RAINIER.applets.wireless.hasAttributeChanged(bd.wireless,ah.wireless,"ssid",this.radioID)}if(symmetryUtil.wireless.isWeakEncryptionType(bE)){bA=true}});if(bA&&bB.indexOf("weak-encryption")===-1){RAINIER.ui.dialog($("#confirm-to-change-weak-encryption"),{onSubmit:function(){bB.push("weak-encryption");aW(bB)}}).show();return false}if(ab&&bD&&!bj&&bB.indexOf("wpa3-enhanced")===-1){RAINIER.ui.dialog($("#confirm-to-change-security-type"),{onSubmit:function(){bB.push("wpa3-enhanced");aW(bB)}}).show();return false}if(bB.indexOf("wiFiNames")===-1&&ab&&bz){RAINIER.ui.dialogWarning({msg:aw.find("#confirm-different-wifi-names").html(),submit:RAINIER.ui.strings.wireless.differentWiFiNames,cancel:RAINIER.ui.strings.wireless.keepOneName,onSubmit:function(){bB.push("wiFiNames");aW(bB)},onCancel:function(){var bG=lodash.remove(_.clone(bd.wireless.radios),function(bH){return bH.radioID==="RADIO_2.4GHz"||bH.radioID==="RADIO_5GHz"||bH.radioID==="RADIO_6GHz"}),bE,bF;console.warn("[onCancel - radios]",RAINIER.applets.wireless.areRadioSettingsIdentical(bG,["ssid","isEnabled","mode","broadcastSSID","channelWidth","channel"]),bG);if(RAINIER.applets.wireless.areRadioSettingsIdentical(bG,["ssid","isEnabled","mode","broadcastSSID","channelWidth","channel"])){bd.wireless.combineNetworks=true;bE=RAINIER.applets.wireless.getRadioFromSet(ah.wireless,"RADIO_5GHz");d.find("#make-all-the-same").click()}else{bE=RAINIER.applets.wireless.getRadioFromSet(bd.wireless,"RADIO_5GHz");bE.settings.ssid=bC.settings.ssid;bF=RAINIER.applets.wireless.getRadioFromSet(bd.wireless,"RADIO_6GHz");if(bF){bF.settings.ssid=bC.settings.ssid}}RAINIER.binder.toDom(bE,d.find("#RADIO_5GHz"),by);if(bF){console.warn("[radio60]",bF);RAINIER.binder.toDom(bF,d.find("#RADIO_6GHz"),by)}bB.push("wiFiNames");aW(bB)}});return false}V();return true}function aZ(bz){bz.add({action:"/jnap/macfilter/GetMACFilterSettings",data:{},cb:function(bA){if(bA.result==="OK"){ah.filtering=$.extend(true,{},bA.output||{});if(ah.filtering.maxMACAddresses){u=ah.filtering.maxMACAddresses}bd.filtering=$.extend(true,{},ah.filtering)}}})}function a2(){var bz=ah.filtering.macFilterMode;if(bz!=="Disabled"){aw.find("#filter-enabled").attr("checked","checked");if(bz==="Allow"){aw.find("#allow-filters").attr("checked","checked")}else{aw.find("#deny-filters").attr("checked","checked")}}else{aw.find("#filter-enabled").removeAttr("checked")}aw.find("#filter-enabled").change();bd.filterList=[];RAINIER.ui.clearTbl(bv);$.each(ah.filtering.macAddresses,function(){var bA={macAddress:this.toString()};bd.filterList.push(bA.macAddress);aV(bA,false)})}function bs(){var bz=aw.find("#add-address");if(bv.find("tr").length>=u){bz.attr("disabled","disabled")}else{bz.removeAttr("disabled")}}function br(){aw.find("#add-address").click(function(){bd.filterList.unshift(bh.macAddress);aV(bh,true);if(bv.find("tr").length===u){RAINIER.ui.alert(aw.find("#max-mac-addresses-reached").text())}});aw.find("#filter-enabled").change(function(){X()})}function X(){var bz=aw.find("#filter-enabled");if(bz.is(":checked")&&(ah.filtering.macFilterMode==="Disabled")){RAINIER.ui.dialogWarning({msg:aw.find("#confirm-mac-filter-enabled").text(),onCancel:function(){bz.removeAttr("checked");bz.change()}})}}function aN(){var bA=true;var bz=bv.find('tr[class="edit"]');for(var bB=0;bB<bz.length;bB++){if(!i($(bz[bB]))){bA=false;break}else{$(bz[bB]).find("#save-filter").click()}}return bA}function L(){a2();br()}function a4(bz){bz.find(".text-mac").change(function(){var bA=$.trim(bz.find(".text-mac").val());bA=bA.replace(/-/g,":");bz.find(".text-mac").val(bA)});K(bz)}function K(bC){var bA;function bB(bF){bA=bv.find('span[class="spStatic mac"]');for(var bE=0;bE<bA.length;bE++){if($(bA[bE]).is(":visible")&&bF===$(bA[bE]).text()){return false}}return true}var bz={},bD={minLen:17,maxLen:17,validationType:"macAddress",blankIsOkOnblur:false,isRequired:true};bz.macAddress=C($.extend(true,{},bD,{els:bC.find('input[class="text-mac"]:text'),elContainer:bC.find('input[class="text-mac"]:text'),errors:[{test:bB,when:false,message:RAINIER.ui.validation.strings.connectivity.duplicatedMacAddress}]}));bC.data(bz)}function i(bA){var bz=bA.data();return bz.macAddress.isValid(true)}function aV(bA,bz){var bB=RAINIER.ui.template.createBlock(af,bA);if(bz){bB.addClass("edit");a4(bB)}bB.find("td").hover(function(){var bC=$(this).parent();if(!bC.hasClass("edit")){bC.addClass("hover")}},function(){$(this).parent().removeClass("hover")});bB.find("#edit-filter").click(Q.onEditFilter.curry(bB));bB.find("#delete-filter").click(Q.onDelFilter.curry(bB));bB.find("#save-filter").click(Q.onUpdFilter.curry(bB));bB.find("#cancel-filter").click(Q.onCancelFilter.curry(bB));if($.compare(bA,bh)){bv.find("tr:first-child").after(bB)}else{bv.append(bB)}bs();RAINIER.util.trapEnter(bB.find("input[type=text]"))}function bk(){var bz=RAINIER.binder.fromDom(aw.find("#filter-options"),by);$.extend(true,bd,bz);bd.filtering=$.extend(true,{},ah.filtering);bd.filtering.macAddresses=bd.filterList.filter(function(bA){return($.trim(bA)!=="")});if(aw.find("#filter-enabled").is(":checked")){bd.filtering.macFilterMode=bz["filter-addresses"]}else{bd.filtering.macFilterMode="Disabled"}}function am(){var bz=false;if(aN()){bk()}if(aw.find("#filter-list").find("#save-filter:visible").length>0||!$.compare(bd.filtering,ah.filtering)){bz=true}return bz}function bw(bz){if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WPSServer3"])){RAINIER.jnap.send({action:"/jnap/wirelessap/IsWPSServerAvailable",data:{},cb:function(bA){if(bA.result==="OK"){aC.serverAvailable=bA.output.available;ak()}if(typeof bz==="function"){bz()}}});return true}return false}function bg(){if(!$.compare(ah.filtering,bd.filtering)){RAINIER.ui.showWaiting();delete bd.filtering.maxMACAddresses;RAINIER.jnap.send({action:"/jnap/macfilter/SetMACFilterSettings",data:bd.filtering,cb:function(bz){if(bz.result==="OK"){$.extend(true,ah.filtering,bd.filtering);ah.filtering.macAddresses=bd.filtering.macAddresses.clone();if(!bw(function(){Q.onSaveComplete()})){Q.onSaveComplete()}}else{v=false;Q.onSaveComplete()}}})}return true}function ap(bz){bz.add({action:"/jnap/wirelessap/GetWPSServerSessionStatus",data:{},cb:function(bA){if(bA.result==="OK"){ah.serverPIN=bA.output.serverPIN}}});if(ac){bz.add({action:"/jnap/wirelessap/GetWPSServerSettings",data:{},cb:function(bA){if(bA.result==="OK"){ah.wps.enabled=bA.output.enabled}}})}if(RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WPSServer3"])){bz.add({action:"/jnap/wirelessap/IsWPSServerAvailable",data:{},cb:function(bA){if(bA.result==="OK"){aC.serverAvailable=bA.output.available}}})}}function bb(){if(!aC.serverAvailable||(!ah.wps.enabled&&ac)||!symmetryUtil.wps.isWPSAvailable(ah.filtering.macFilterMode,ah.wireless)){S.addClass("disabled")}else{S.removeClass("disabled")}if(!RAINIER.applets.wireless.canEnableWPS(ah.wireless,bd.wireless,true)){S.addClass("cannotEnable");S.addClass("disabled")}else{if(aC.serverAvailable){S.removeClass("serverNotAvailable")}else{S.addClass("serverNotAvailable")}}if(S.hasClass("disabled")){if(S.hasClass("serverNotAvailable")||S.hasClass("cannotEnable")){S.find("#wps-enabled").attr("disabled","disabled")}else{S.find("#wps-enabled").removeAttr("disabled")}aw.find("#wps #wps-router-pin").text("");S.find("#wps-button").addClass("focus");S.find("#wps-device-pin").attr("disabled","disabled");S.find("#wps-register").attr("disabled","disabled")}else{aw.find("#wps #wps-router-pin").text(ah.serverPIN);S.find("#wps-button").removeClass("focus");S.find("#wps-enabled").removeAttr("disabled");S.find("#wps-device-pin").removeAttr("disabled");S.find("#wps-register").removeAttr("disabled")}RAINIER.binder.toDom(ah,aw.find("#wps"),by)}function aQ(){var bz=RAINIER.binder.fromDom(aw.find("#wps"),by);$.extend(true,bd,bz)}function t(){Y.find(".close-button").unbind("click");Y.find(".close-button").click(function(){RAINIER.ui.spinner.stop("#spinner-section");bo.close()});Y.find("#cancel-button").unbind("click");Y.find("#cancel-button").click(function(){Y.find("#cancel-button").attr("disabled","disabled");clearInterval(bx);b();o(false)});var bA=aw.find("#wps #wps-button");bA.unbind();if(!aw.find("#wps").hasClass("disabled")){bA.bind({click:function(){R(false)},keypress:function(bB){if(bB.keyCode===13){R(false)}},mousedown:function(){bA.addClass("active")},mouseup:function(){bA.removeClass("active")},mouseenter:function(){bA.addClass("hover");bA.removeClass("active")},mouseleave:function(){bA.removeClass("hover");bA.removeClass("active")}})}function bz(){if(an.wps.pin.isValid(true)){R(true)}}aw.find("#wps #wps-register").unbind();aw.find("#wps #wps-register").click(bz);RAINIER.util.trapEnter("#wps-device-pin",bz)}function aq(){var bz={minLen:4,maxLen:9,whiteSpace:false,isRequired:false};an.wps={};an.wps.pin=C($.extend(true,{},bz,{els:aw.find("#wps-device-pin"),errors:[{test:RAINIER.ui.validation.tests.isWpsPin,when:false,message:RAINIER.ui.validation.strings.invalidWpsPin}]}))}function ak(){bb();t();aq()}function o(bz){if(bz){Y.find("#success").show();Y.find("#close-button").show();Y.find("#searching").hide();Y.find("#failure").hide();Y.find("#cancel-button").hide()}else{Y.find("#failure").show();Y.find("#close-button").show();Y.find("#searching").hide();Y.find("#success").hide();Y.find("#cancel-button").hide()}}function b(){RAINIER.jnap.send({action:"/jnap/wirelessap/GetWPSServerSessionStatus",data:{},cb:function(bz){if(bz.output.isWPSSessionInProgress){RAINIER.jnap.send({action:"/jnap/wirelessap/StopWPSServerSession",data:{},cb:function(bA){}})}}})}function R(bC){aw.find("#wps #wps-register").attr("disabled","disabled");var bB={};if(bC){bB.clientPIN=RAINIER.binder.fromDom("#wps #wps-device-pin").clientPIN;if(bB.clientPIN.length===9){bB.clientPIN=bB.clientPIN.substring(0,4)+bB.clientPIN.substring(5,9)}}var bA="/jnap/wirelessap/StartWPSServerSession";RAINIER.jnap.send({action:bA,data:bB,cb:function(bD){if(bD&&bD.result&&(bD.result==="OK"||bD.result==="ErrorWPSSessionAlreadyInProgress")){Y.find("#searching").show();Y.find("#cancel-button").removeAttr("disabled");Y.find("#cancel-button").show();Y.find("#failure").hide();Y.find("#success").hide();Y.find("#close-button").hide();aw.find("#wps #wps-register").removeAttr("disabled");RAINIER.ui.spinner.build("#spinner-section").spin("#spinner-section");bo.show();bx=setInterval(bz,5000)}else{if(bD&&bD.result&&bD.result==="ErrorInvalidClientPIN"){RAINIER.ui.alert(aw.find("#wps-pin-invalid-text").html())}else{RAINIER.ajax().executeDefaultJnapErrorHandler(bD,bA)}}aw.find("#wps #wps-register").removeAttr("disabled")},disableDefaultJnapErrHandler:true});function bz(){RAINIER.jnap.send({action:"/jnap/wirelessap/GetWPSServerSessionStatus",data:{},cb:function(bD){if(!bD.output.isWPSSessionInProgress){clearInterval(bx);o(bD.output.lastResult==="Succeeded"?true:false)}}})}}function O(){aQ();if(!ac){delete bd.wps.enabled}var bz=$.compare(bd.wps,ah.wps);return !bz}function e(bB){var bD={action:"/jnap/wirelessap/SetWPSServerSettings",data:bd.wps,cb:function(bE){if(bE.result==="OK"){$.extend(true,ah.wps,bd.wps);ak()}else{v=false}Q.onSaveComplete()}},bC=function(bE){if(bE.result==="OK"){$.extend(true,ah.wps,bd.wps);ak();Q.onSaveComplete(false)}};if(bB){bD.cb=bC;bB.add(bD)}else{var bz=RAINIER.applets.wireless.ssidBroadcastWPSWarning(ah.wireless,bd,bu,D);if(bz){var bA=RAINIER.ui.dialog(bz,{onSubmit:function(){RAINIER.ui.showWaiting();if(bz===bu){bD.cb=bC;ao(bD)}else{RAINIER.jnap.send(bD)}},onCancel:function(){v=false;Q.onSaveComplete()}});bA.show()}else{RAINIER.ui.showWaiting();RAINIER.jnap.send(bD)}}}function ao(bA){var bz;if(!RAINIER.applets.wireless.isWirelessAP2Supported()){bz=RAINIER.jnap.Transaction({disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true})}else{bz=RAINIER.jnap.Transaction()}RAINIER.applets.wireless.scrubForSave(bd.wireless);$.each(bd.wireless.radios,function(bC,bB){bB.settings.broadcastSSID=true});bz.add({action:RAINIER.jnapActions.setRadioSettings(),data:bd.wireless,cb:function(bB){if(bB.result==="OK"){ad();W();RAINIER.event.fire("wireless.updated")}}});bz.add(bA);bz.send()}function ar(){RAINIER.binder.toDom(ah,aw.find("#simpletap"),by)}function I(){var bz=RAINIER.binder.fromDom(aw.find("#simpletap"),by);$.extend(true,bd.simpletap,bz.simpletap);return bd.simpletap.isSetupVAPEnabled!==ah.simpletap.isSetupVAPEnabled}function aR(){return true}function aB(){RAINIER.ui.showWaiting();RAINIER.jnap.send({action:"/jnap/wirelesssetup/SetStaticNFCSettings",data:{isSetupVAPEnabled:bd.simpletap.isSetupVAPEnabled},cb:function(bz){if(bz.result==="OK"){$.extend(true,ah.simpletap,bd.simpletap)}else{v=false}Q.onSaveComplete()}})}function aO(bz){bz.add({action:"/jnap/wirelesssetup/GetStaticNFCSettings",data:{},cb:function(bA){if(bA.result==="OK"){ah.simpletap.isSetupVAPEnabled=bA.output.isSetupVAPEnabled}}})}function ba(){ar()}function a3(){x.find(".editRouterTime").click(function(){var bz=RAINIER.connect.AppletManager.getAppletById("BDBC8297-8982-4BCF-84EC-91783FF9013C");if(bz){RAINIER.ui.MainMenu.launchApplet(bz,"")}else{console.warn("Wireless Scheduler: cannot locate Connectivity applet")}});x.find(".help-icon").click(function(){$("#help-menu").click()})}function h(){a3();RAINIER.blockScheduler.populateBlockAccessTable(function(){if(a9==="scheduler"){aw.find("#scheduler-tab > span").click()}})}function aM(){RAINIER.binder.toDom(ah,aw.find("#scheduler"),by);RAINIER.blockScheduler.setCheckedCellsPol(ah.scheduler.wirelessSchedule)}function ax(){if(ai){var bz=new Date(Date.now()-bc);aK.html(RAINIER.util.getTimeFromRouterDateString(bz));q=setTimeout(ax,a0)}}function aE(){RAINIER.blockScheduler.init();RAINIER.network.getRouterCurrentTime(function(bz){ai=RAINIER.util.routerTimeToDate(bz);bc=Date.now()-ai;ax()});aM()}function a(){bd.scheduler.isWirelessSchedulerEnabled=RAINIER.blockScheduler.hasSelectedCells()?true:false;bd.scheduler.wirelessSchedule=RAINIER.blockScheduler.getAccessSchedule();if(bd.scheduler.isWirelessSchedulerEnabled){bd.scheduler.configuredRadios=ah.scheduler.configurableRadios}else{bd.scheduler.configuredRadios=ah.scheduler.configuredRadios}}function aj(){var bz=false;a();if(!$.compare(bd.scheduler,ah.scheduler)){bz=true}return bz}function aY(){RAINIER.ui.showWaiting();var bz=$.extend(true,{},bd.scheduler);delete bz.configurableRadios;RAINIER.jnap.send({action:"/jnap/wirelessscheduler/SetWirelessSchedulerSettings",data:bz,cb:function(bA){if(bA.result==="OK"){$.extend(true,ah.scheduler,bd.scheduler);RAINIER.network.setWirelessSchedulerSettings(bd.scheduler);RAINIER.event.fire("wireless.updated",ah.wireless)}else{v=false}Q.onSaveComplete()}})}function a8(){RAINIER.network.updateWirelessSchedulerSettings(function(){ah.scheduler=$.extend(true,{},RAINIER.network.getWirelessSchedulerSettings());bd.scheduler=$.extend(true,{},ah.scheduler);RAINIER.event.fire("wireless.updated")})}function aL(){RAINIER.binder.toDom(ah,aF,by)}function B(){if(aP){bd.atf={isAirtimeFairnessEnabled:aF.find("#atf-enabled").is(":checked")}}if(av){bd.dfs={isDFSEnabled:aF.find("#dfs-enabled").is(":checked")}}if(au){bd.topologyOptimization.isClientSteeringEnabled=aF.find("#clientSteering-enabled").is(":checked")}if(m){bd.topologyOptimization.isNodeSteeringEnabled=aF.find("#nodeSteering-enabled").is(":checked")}if(bl){bd.iptv.isEnabled=aF.find("#iptv-enabled").is(":checked")}}function p(){return av&&ah.dfs.isDFSEnabled!==bd.dfs.isDFSEnabled}function j(){var bz=false;B();if(aP&&bd.atf.isAirtimeFairnessEnabled!==ah.atf.isAirtimeFairnessEnabled){bz=true}if(au&&bd.topologyOptimization.isClientSteeringEnabled!==ah.topologyOptimization.isClientSteeringEnabled){bz=true}if(m&&bd.topologyOptimization.isNodeSteeringEnabled!==ah.topologyOptimization.isNodeSteeringEnabled){bz=true}if(p()){bz=true}if(bl&&bd.iptv.isEnabled!==ah.iptv.isEnabled){bz=true}return bz}function bf(){return true}function aJ(){var bz=p();var bA=RAINIER.jnap.Transaction({onComplete:function(bD){if(bz&&bD.sideEffects){var bC=function(){var bE=RAINIER.jnap.Transaction({onComplete:function(){ad();W();Q.onSaveComplete()}});RAINIER.event.disconnect("router.interruptionCompleted",bC);at(bE);bE.send()};RAINIER.event.connect("router.interruptionCompleted",bC)}else{Q.onSaveComplete()}}});RAINIER.ui.showWaiting();if(aP){bA.add({action:"/jnap/wirelessap/SetAirtimeFairnessSettings",data:{isAirtimeFairnessEnabled:bd.atf.isAirtimeFairnessEnabled},cb:function(bC){if(bC.result==="OK"){$.extend(true,ah.atf,bd.atf)}else{v=false}}})}if(RAINIER.network.isTopologyOptimizationPresent()){var bB={isClientSteeringEnabled:bd.topologyOptimization.isClientSteeringEnabled};if(m){bB.isNodeSteeringEnabled=bd.topologyOptimization.isNodeSteeringEnabled}bA.add({action:RAINIER.jnapActions.setTopologyOptimizationSettings(),data:bB,cb:function(bC){if(bC.result==="OK"){$.extend(true,ah.topologyOptimization,bd.topologyOptimization)}else{v=false}}})}if(av){bA.add({action:"/jnap/wirelessap/SetDFSSettings",data:{isDFSEnabled:bd.dfs.isDFSEnabled},cb:function(bC){if(bC.result==="OK"){$.extend(true,ah.dfs,bd.dfs)}else{v=false}}})}if(bl){bA.add({action:"/jnap/iptv/SetIPTVSettings",data:{isEnabled:bd.iptv.isEnabled},cb:function(bC){if(bC.result==="OK"){$.extend(true,ah.iptv,bd.iptv)}else{v=false}}})}bA.send()}function bt(bz){if(RAINIER.network.isAirtimeFairnessPresent()){bz.add({action:"/jnap/wirelessap/GetAirtimeFairnessSettings",data:{},cb:function(bA){if(bA.result==="OK"){aP=bA.output.isAirtimeFairnessSupported;if(aP){ah.atf.isAirtimeFairnessEnabled=bA.output.isAirtimeFairnessEnabled}}}})}if(RAINIER.network.isTopologyOptimizationPresent()){au=true;bz.add({action:RAINIER.jnapActions.getTopologyOptimizationSettings(),data:{},cb:function(bA){if(bA.result==="OK"){ah.topologyOptimization.isClientSteeringEnabled=bA.output.isClientSteeringEnabled;if(RAINIER.shared.util.areServicesSupported(["/jnap/nodes/topologyoptimization/TopologyOptimization2"])){m=true;ah.topologyOptimization.isNodeSteeringEnabled=bA.output.isNodeSteeringEnabled}}}})}if(RAINIER.network.isDynamicFrequencySelectionPresent()){bz.add({action:"/jnap/wirelessap/GetDFSSettings",data:{},cb:function(bA){if(bA.result==="OK"){av=bA.output.isDFSSupported;if(av){ah.dfs.isDFSEnabled=bA.output.isDFSEnabled}}}})}if(RAINIER.network.isIPTVPresent()){bl=true;bz.add({action:"/jnap/iptv/GetIPTVSettings",data:{},cb:function(bA){if(bA.result==="OK"){ah.iptv.isEnabled=bA.output.isEnabled}}})}}function a6(){aw.find("#iptv-wrapper input").on("change",function(){var bz=$(this);if(bz.is(":checked")){RAINIER.ui.dialog("#confirm-enable-iptv",{onCancel:function(){bz.prop("checked",false)}}).show()}else{RAINIER.ui.dialog("#confirm-disable-iptv",{onCancel:function(){bz.prop("checked",true)}}).show()}})}function bn(){if(!aP&&!au){aw.find("#advanced-tab").remove();aF.remove()}else{if(!av){aw.find("#dfs-wrapper").hide()}if(!aP){aw.find("#atf-wrapper").hide()}if(!au){aw.find("#clientSteering-wrapper").hide()}if(!m){aw.find("#nodeSteering-wrapper").hide()}if(!bl){aw.find("#iptv-wrapper").hide()}aL()}a6()}function n(bz){at(bz);if(w.macfiltering){aZ(bz)}ap(bz);if(w.simpletap){aO(bz)}if(w.scheduler){a8(bz)}if(w.advanced){bt(bz)}}function a5(){f();if(w.macfiltering){L()}ak();if(w.simpletap){ba()}if(w.scheduler){h()}if(w.advanced){bn()}RAINIER.event.fire("applet.loaded")}function ae(){if(w.macfiltering){aD.macfiltering.insertAfter(aw.find("#wireless-tab"));aI.macfiltering.insertAfter(d)}if(w.advanced){aw.find("#wps-tab").after(aD.advanced);aw.find("#wps").after(aI.advanced)}if(w.scheduler){aw.find("#wps-tab").after(aD.scheduler);aw.find("#wps").after(aI.scheduler)}if(w.simpletap){aw.find("#wps-tab").after(aD.simpletap);aw.find("#wps").after(aI.simpletap)}}function bq(){w.macfiltering=RAINIER.shared.util.areServicesSupported(["/jnap/macfilter/MACFilter"]);w.simpletap=RAINIER.shared.util.areServicesSupported(["/jnap/wirelesssetup/StaticNFCSetup"]);w.scheduler=RAINIER.network.isWirelessSchedulerSupported();w.advanced=RAINIER.network.isAirtimeFairnessPresent()||RAINIER.network.isTopologyOptimizationPresent();ae()}function a1(bA){var bz=$.extend({},ah.guestSettings),bC=false,bB=$.grep(ah.wireless.radios,function(bF){return bF.radioID==="RADIO_2.4GHz"})[0],bD=$.grep(ah.wireless.radios,function(bF){return bF.radioID==="RADIO_5GHz"})[0],bE=$.grep(ah.wireless.radios,function(bF){return bF.radioID==="RADIO_6GHz"})[0];if(RAINIER.network.isGuestNetwork3Supported()){$.each(bd.wireless.radios,function(){if(this.radioID==="RADIO_2.4GHz"){if(this.settings.isEnabled!==bB.settings.isEnabled){bC=true;if(this.settings.isEnabled===false){bz.radio.band24.isEnabled=false;bz.radio.band24.canEnableRadio=false}else{bz.radio.band24.canEnableRadio=true}}}else{if(this.radioID==="RADIO_5GHz"){if(this.settings.isEnabled!==bD.settings.isEnabled){bC=true;if(this.settings.isEnabled===false){bz.radio.band50.isEnabled=false;bz.radio.band50.canEnableRadio=false}else{bz.radio.band50.canEnableRadio=true}}}else{if(this.radioID==="RADIO_6GHz"){if(this.settings.isEnabled!==bE.settings.isEnabled){bC=true;if(this.settings.isEnabled===false){bz.radio.band60.isEnabled=false;bz.radio.band60.canEnableRadio=false}else{bz.radio.band60.canEnableRadio=true}}}}}})}else{$.each(bd.wireless.radios,function(){if(this.radioID==="RADIO_2.4GHz"){if(this.settings.isEnabled!==bB.settings.isEnabled){bC=true;if(this.settings.isEnabled===false){bz.isGuestNetworkEnabled=false}}}})}RAINIER.applets.guestNetwork.updateCanEnableGuestNetwork(bz);if(bC){console.warn(["Updating Guest Network:",bz]);RAINIER.applets.guestNetwork.setSettings(bz,function(){ah.guestSettings=bz},bA,true)}}function ad(){$.each(bd.wireless.radios,function(bA,bC){var bz=d.find("#"+RAINIER.ui.escapeId(bC.radioID)),bB=RAINIER.applets.wireless.getRadioFromSet(ah.wireless,bC.radioID);bB=$.extend(true,bB,bC);J(bz,bB)})}function V(){var bC,bB=true;function bD(){a1(bC);bC.send()}if(RAINIER.applets.wireless.isSSIDBroadcastChanging(ah.wireless,bd.wireless)&&!RAINIER.applets.wireless.isWirelessAP2Supported()){bC=RAINIER.jnap.Transaction({disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true});bB=false}else{bC=RAINIER.jnap.Transaction()}RAINIER.ui.showWaiting();var bA=RAINIER.applets.wireless.isSSIDBroadcastChanging(ah.wireless,bd.wireless)&&!RAINIER.applets.wireless.isWirelessAP2Supported();if(!RAINIER.applets.wireless.canEnableWPS(ah.wireless,bd.wireless)&&ah.wps.enabled){bd.wps=bd.wps||{};bd.wps.enabled=false;e(bC)}RAINIER.applets.wireless.commitSettings(bC,bd.wireless,ah.wireless,by,bD,bz);function bz(bG,bE){function bF(){RAINIER.connect.checkRouterConnectionForRestoration(true,false)}if(bG.result==="OK"){$.each(bd.wireless.radios,function(){var bH=_.find(bE.radios,{radioID:this.radioID});_.extend(this,bH)});ah.wireless=$.extend(true,{},ah.wireless,bd.wireless);W();ad();RAINIER.event.fire("wireless.updated",ah.wireless);bb();if(bA){setTimeout(function(){RAINIER.jnap.send({action:"/jnap/core/Reboot",data:{},cb:function(bH){if(bH.result==="OK"){RAINIER.event.fire("router.interruptionStarted");RAINIER.ui.showWaiting();setTimeout(function(){bF()},4000)}else{}},disableDefaultAjaxErrHandler:true,disableDefaultRebootErrHandler:true})},ag)}if(!bw(function(){Q.onSaveComplete(bB)})){Q.onSaveComplete(bB)}}else{v=false;Q.onSaveComplete(true)}}}function y(){ai=null;RAINIER.event.disconnect("applet.unloaded",y);if(RAINIER.network.isWirelessSchedulerSupported()){clearTimeout(q);q=null}}function aS(){a9=$.cookie("initial-tab");ac=RAINIER.shared.util.areServicesSupported(["/jnap/wirelessap/WPSServer2"]);if(!ac){aw.find("div#wps-enabled-switch").hide()}aw.find("#cbAddWidget").attr("checked",RAINIER.connect.AppletManager.getWidgetShowState("7B1F462B-1A78-4AF6-8FBB-0C221703BEA4","7C8E2909-A0EF-48E7-A7BD-F615059F510C"));aw.find("#cbAddWidget").click(Q.onToggleWidget);r=RAINIER.ui.dialog("#guest-ssid-conflict");bm=RAINIER.ui.dialog($("#dialog-tabchange"),{onSubmit:function(){l=true;U(false)}});$("#dialog-tabchange #no-save").unbind("click");$("#dialog-tabchange #no-save").click(function(){bm.close();A();az.click()});bo=RAINIER.ui.dialog(Y);bq();var bz=RAINIER.jnap.Transaction({onComplete:a5});n(bz);bz.send();if(a9!=="scheduler"){N=RAINIER.ui.tabs.init({fireEvents:true,initialTab:a9})}else{N=RAINIER.ui.tabs.init({fireEvents:true})}N.connect(function(bB,bA){if(bA.type==="tab"){M=bA.srcTabId;aA=bA.destTabId;if(bA.srcIdx>-1){az=bA.destTab;if(aH()){bB.cancelEvent=true}else{if(ab&&M==="wireless"){W()}}}else{M=aA}}else{k=bA.srcTabId}});N.fireInit();RAINIER.event.connect("tab.changed",function(bB,bA){var bC=bA.destTabId;if(bC==="scheduler"){clearTimeout(q);aE()}});RAINIER.event.connect("applet.unloaded",y);aw.find("footer .cancel").click(Q.onClose);aw.find("footer .submit").click(Q.onSave);aw.find("footer .apply").click(Q.onApply);if(RAINIER.network.isBridgeMode()){aw.find("#simpletap-tab").remove();aw.find("#wps-tab").remove();aw.find("#mac-filtering-tab").remove();aw.find("#scheduler-tab").remove();if(!aT){aw.find("#advanced-tab").remove()}}else{aw.find(".widget-config").css("display","")}}aS()}());